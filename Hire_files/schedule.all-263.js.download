// (c) 2014 TrackJS LLC ALL RIGHTS RESERVED
(function(h,p,k){"use awesome";if(h.trackJs)h.console&&h.console.warn&&h.console.warn("TrackJS global conflict");else{var l=function(a,b,c,d,e){this.util=a;this.onError=b;this.onFault=c;this.options=e;e.enabled&&this.initialize(d)};l.prototype={initialize:function(a){a.addEventListener&&(this.wrapAndCatch(a.Element.prototype,"addEventListener",1),this.wrapAndCatch(a.XMLHttpRequest.prototype,"addEventListener",1),this.wrapRemoveEventListener(a.Element.prototype),this.wrapRemoveEventListener(a.XMLHttpRequest.prototype));
this.wrapAndCatch(a,"setTimeout",0);this.wrapAndCatch(a,"setInterval",0)},wrapAndCatch:function(a,b,c){var d=this,e=a[b];d.util.hasFunction(e,"apply")&&(a[b]=function(){try{var f=Array.prototype.slice.call(arguments),g=f[c],u,h;if(d.options.bindStack)try{throw Error();}catch(k){h=k.stack,u=d.util.isoNow()}if("addEventListener"===b&&(this._trackJsEvt||(this._trackJsEvt=new m),this._trackJsEvt.getWrapped(f[0],g,f[2])))return;g&&d.util.hasFunction(g,"apply")&&(f[c]=function(){try{return g.apply(this,
arguments)}catch(a){throw d.onError("catch",a,{bindTime:u,bindStack:h}),d.util.wrapError(a);}},"addEventListener"===b&&this._trackJsEvt.add(f[0],g,f[2],f[c]));return e.apply(this,f)}catch(l){a[b]=e,d.onFault(l)}})},wrapRemoveEventListener:function(a){if(a&&a.removeEventListener&&this.util.hasFunction(a.removeEventListener,"call")){var b=a.removeEventListener;a.removeEventListener=function(a,d,e){if(this._trackJsEvt){var f=this._trackJsEvt.getWrapped(a,d,e);f&&this._trackJsEvt.remove(a,d,e);return b.call(this,
a,f,e)}return b.call(this,a,d,e)}}}};var m=function(){this.events=[]};m.prototype={add:function(a,b,c,d){-1>=this.indexOf(a,b,c)&&this.events.push([a,b,!!c,d])},remove:function(a,b,c){a=this.indexOf(a,b,!!c);0<=a&&this.events.splice(a,1)},getWrapped:function(a,b,c){a=this.indexOf(a,b,!!c);return 0<=a?this.events[a][3]:k},indexOf:function(a,b,c){for(var d=0;d<this.events.length;d++)if(this.events[d][0]===a&&this.events[d][1]===b&&this.events[d][2]===!!c)return d;return-1}};var t=function(a,b){this.util=
a;this.initCurrent(b)};t.prototype={current:{},initOnly:{application:"",enabled:!0,token:!0,callback:{enabled:!0},console:{enabled:!0},network:{enabled:!0},visitor:{enabled:!0},window:{enabled:!0}},defaults:{application:"",enabled:!0,onError:function(){return!0},serialize:function(a){return a===k?"undefined":null===a?"null":"number"===typeof a&&isNaN(a)?"NaN":""===a?"Empty String":0===a?"0":!1===a?"false":a&&a.toString?a.toString():"unknown"},sessionId:"",token:"",userId:"",version:"",callback:{enabled:!0,
bindStack:!1},console:{enabled:!0,display:!0,error:!0,watch:["log","debug","info","warn","error"]},network:{enabled:!0,error:!0},visitor:{enabled:!0},window:{enabled:!0}},initCurrent:function(a){if(this.validate(a,this.defaults,"config",{}))return this.current=this.util.extend(this.current,this.defaults,a),!0;this.current=this.util.extend(this.current,this.defaults);return!1},setCurrent:function(a){return this.validate(a,this.defaults,"config",this.initOnly)?(this.current=this.util.extend(this.current,
a),!0):!1},validate:function(a,b,c,d){var e=!0;c=c||"";d=d||{};for(var f in a)if(a.hasOwnProperty(f))if(b.hasOwnProperty(f)){var g=typeof b[f];g!==typeof a[f]?(console.warn(c+"."+f+": property must be type "+g+"."),e=!1):"[object Array]"!==Object.prototype.toString.call(a[f])||this.validateArray(a[f],b[f],c+"."+f)?"[object Object]"===Object.prototype.toString.call(a[f])?e=this.validate(a[f],b[f],c+"."+f,d[f]):d.hasOwnProperty(f)&&(console.warn(c+"."+f+": property cannot be set after load."),e=!1):
e=!1}else console.warn(c+"."+f+": property not supported."),e=!1;return e},validateArray:function(a,b,c){var d=!0;c=c||"";for(var e=0;e<a.length;e++)this.util.contains(b,a[e])||(console.warn(c+"["+e+"]: invalid value: "+a[e]+"."),d=!1);return d}};var q=function(a,b,c,d,e,f,g){this.util=a;this.log=b;this.onError=c;this.onFault=d;this.serialize=e;g.enabled&&(f.console=this.wrapConsoleObject(f.console,g))};q.prototype={wrapConsoleObject:function(a,b){a=a||{};var c=a.log||function(){},d=this,e;for(e=
0;e<b.watch.length;e++)(function(e){var g=a[e]||c;a[e]=function(){try{var a=Array.prototype.slice.call(arguments);d.log.add("c",{timestamp:d.util.isoNow(),severity:e,message:d.serialize(a)});if(b.error&&"error"===e)try{throw Error(a[0]);}catch(c){d.onError("console",c)}b.display&&(d.util.hasFunction(g,"apply")?g.apply(this,a):g(a[0],a[1],a[2]))}catch(h){d.onFault(h)}}})(b.watch[e]);return a},report:function(){return this.log.all("c")}};var r=function(a,b,c,d,e){this.config=a;this.util=b;this.log=
c;this.window=d;this.document=e;this.correlationId=this.token=null;this.initialize()};r.prototype={initialize:function(){this.token=this.getCustomerToken();this.correlationId=this.getCorrelationId()},getCustomerToken:function(){if(this.config.current.token)return this.config.current.token;var a=this.document.getElementsByTagName("script");return a[a.length-1].getAttribute("data-token")},getCorrelationId:function(){var a;try{a=this.document.cookie.replace(/(?:(?:^|.*;\s*)TrackJS\s*\=\s*([^;]*).*$)|^.*$/,
"$1"),a||(a=this.util.uuid(),this.document.cookie="TrackJS="+a+"; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/")}catch(b){a=this.util.uuid()}return a},report:function(){return{application:this.config.current.application,correlationId:this.correlationId,sessionId:this.config.current.sessionId,token:this.token,userId:this.config.current.userId,version:this.config.current.version}}};var s=function(a){this.loadedOn=(new Date).getTime();this.window=a};s.prototype={discoverDependencies:function(){var a,
b={};this.window.jQuery&&(this.window.jQuery.fn&&this.window.jQuery.fn.jquery)&&(b.jQuery=this.window.jQuery.fn.jquery);this.window.jQuery&&(this.window.jQuery.ui&&this.window.jQuery.ui.version)&&(b.jQueryUI=this.window.jQuery.ui.version);this.window.angular&&(this.window.angular.version&&this.window.angular.version.full)&&(b.angular=this.window.angular.version.full);for(a in this.window)if("_trackJs"!==a&&"_trackJS"!==a&&"_trackjs"!==a&&"webkitStorageInfo"!==a)try{if(this.window[a]){var c=this.window[a].version||
this.window[a].Version||this.window[a].VERSION;"string"===typeof c&&(b[a]=c)}}catch(d){}return b},report:function(){return{age:(new Date).getTime()-this.loadedOn,dependencies:this.discoverDependencies(),userAgent:this.window.navigator.userAgent,viewportHeight:this.window.document.documentElement.clientHeight,viewportWidth:this.window.document.documentElement.clientWidth}}};var v=function(a){this.util=a;this.appender=[];this.maxLength=30};v.prototype={all:function(a){var b=[],c,d;for(d=0;d<this.appender.length;d++)(c=
this.appender[d])&&c.category===a&&b.push(c.value);return b},clear:function(){this.appender.length=0},truncate:function(){this.appender.length>this.maxLength&&(this.appender=this.appender.slice(Math.max(this.appender.length-this.maxLength,0)))},add:function(a,b){var c=this.util.uuid();this.appender.push({key:c,category:a,value:b});this.truncate();return c},get:function(a,b){var c,d;for(d=0;d<this.appender.length;d++)if(c=this.appender[d],c.category===a&&c.key===b)return c.value;return!1}};var w=function(a,
b,c,d,e,f){this.util=a;this.log=b;this.onError=c;this.onFault=d;this.window=e;this.options=f;f.enabled&&this.initialize(e)};w.prototype={initialize:function(a){a.XMLHttpRequest&&this.util.hasFunction(a.XMLHttpRequest.prototype.open,"apply")&&this.watchNetworkObject(a.XMLHttpRequest);a.XDomainRequest&&this.util.hasFunction(a.XDomainRequest.prototype.open,"apply")&&this.watchNetworkObject(a.XDomainRequest)},watchNetworkObject:function(a){var b=this,c=a.prototype.open,d=a.prototype.send;a.prototype.open=
function(a,b){this._trackJs={method:a,url:b};return c.apply(this,arguments)};a.prototype.send=function(){try{if(!this._trackJs)return d.apply(this,arguments);this._trackJs.logId=b.log.add("n",{startedOn:b.util.isoNow(),method:this._trackJs.method,url:this._trackJs.url});b.listenForNetworkComplete(this)}catch(a){b.onFault(a)}return d.apply(this,arguments)};return a},listenForNetworkComplete:function(a){var b=this;b.window.ProgressEvent&&a.addEventListener&&a.addEventListener("readystatechange",function(){4===
a.readyState&&b.finalizeNetworkEvent(a)},!0);a.addEventListener?a.addEventListener("load",function(){b.finalizeNetworkEvent(a);b.checkNetworkFault(a)},!0):setTimeout(function(){try{var c=a.onload;a.onload=function(){b.finalizeNetworkEvent(a);b.checkNetworkFault(a);"function"===typeof c&&b.util.hasFunction(c,"apply")&&c.apply(a,arguments)};var d=a.onerror;a.onerror=function(){b.finalizeNetworkEvent(a);b.checkNetworkFault(a);"function"===typeof oldOnError&&d.apply(a,arguments)}}catch(e){b.onFault(e)}},
0)},finalizeNetworkEvent:function(a){if(a._trackJs){var b=this.log.get("n",a._trackJs.logId);b&&(b.completedOn=this.util.isoNow(),b.statusCode=1223==a.status?204:a.status,b.statusText=1223==a.status?"No Content":a.statusText,a._trackJs=k)}},checkNetworkFault:function(a){if(this.options.error&&400<=a.status&&1223!=a.status)this.onError("ajax",a.status+" "+a.statusText)},report:function(){return this.log.all("n")}};var n=function(a){this.util=a;this.disabled=!1;this.throttleStats={attemptCount:0,throttledCount:0,
lastAttempt:(new Date).getTime()};h.JSON&&h.JSON.stringify||(this.disabled=!0)};n.prototype={errorEndpoint:function(a,b){b=(b||"https://capture.trackjs.com/capture")+("?token="+a);return this.util.isBrowserIE()?"//"+b.split("://")[1]:b},usageEndpoint:function(a){return this.appendObjectAsQuery(a,"https://usage.trackjs.com/usage.gif")},trackerFaultEndpoint:function(a){return this.appendObjectAsQuery(a,"https://usage.trackjs.com/fault.gif")},appendObjectAsQuery:function(a,b){b+="?";for(var c in a)a.hasOwnProperty(c)&&
(b+=encodeURIComponent(c)+"="+encodeURIComponent(a[c])+"&");return b},getCORSRequest:function(a,b){var c=new h.XMLHttpRequest;"withCredentials"in c?(c.open(a,b),c.setRequestHeader("Content-Type","text/plain")):"undefined"!==typeof h.XDomainRequest?(c=new h.XDomainRequest,c.open(a,b)):c=null;return c},sendTrackerFault:function(a){this.throttle(a)||((new Image).src=this.trackerFaultEndpoint(a))},sendUsage:function(a){(new Image).src=this.usageEndpoint(a)},sendError:function(a,b){var c=this;if(!this.disabled&&
!this.throttle(a))try{var d=this.getCORSRequest("POST",this.errorEndpoint(b));d.onreadystatechange=function(){4===d.readyState&&200!==d.status&&(c.disabled=!0)};d._trackJs=k;d.send(h.JSON.stringify(a))}catch(e){throw this.disabled=!0,e;}},throttle:function(a){var b=(new Date).getTime();this.throttleStats.attemptCount++;if(this.throttleStats.lastAttempt+1E3>=b){if(this.throttleStats.lastAttempt=b,10<this.throttleStats.attemptCount)return this.throttleStats.throttledCount++,!0}else a.throttled=this.throttleStats.throttledCount,
this.throttleStats.attemptCount=0,this.throttleStats.lastAttempt=b,this.throttleStats.throttledCount=0;return!1}};var x=function(a){this.window=a};x.prototype={bind:function(a,b){return function(){return a.apply(b,Array.prototype.slice.call(arguments))}},contains:function(a,b){var c;for(c=0;c<a.length;c++)if(a[c]===b)return!0;return!1},defer:function(a,b){setTimeout(function(){a.apply(b)})},extend:function(a){for(var b,c=Array.prototype.slice.call(arguments,1),d=0;d<c.length;d++)for(b in c[d])null===
c[d][b]||c[d][b]===k?a[b]=c[d][b]:"[object Object]"===Object.prototype.toString.call(c[d][b])?(a[b]=a[b]||{},this.extend(a[b],c[d][b])):a[b]=c[d][b];return a},hasFunction:function(a,b){try{return!!a[b]}catch(c){return!1}},isBrowserIE:function(){var a=this.window.navigator.userAgent,b=a.match(/Trident\/([\d.]+)/);return b&&"7.0"===b[1]?11:(a=a.match(/MSIE ([\d.]+)/))?parseInt(a[1],10):!1},isBrowserSupported:function(){var a=this.isBrowserIE();return!a||8<=a},isoNow:function(){var a=new Date;return a.toISOString?
a.toISOString():a.getUTCFullYear()+"-"+this.pad(a.getUTCMonth()+1)+"-"+this.pad(a.getUTCDate())+"T"+this.pad(a.getUTCHours())+":"+this.pad(a.getUTCMinutes())+":"+this.pad(a.getUTCSeconds())+"."+String((a.getUTCMilliseconds()/1E3).toFixed(3)).slice(2,5)+"Z"},pad:function(a){a=String(a);1===a.length&&(a="0"+a);return a},uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})},wrapError:function(a){if(a.innerError)return a;
var b=Error("TrackJS Caught: "+(a.message||a));b.description="TrackJS Caught: "+a.description;b.file=a.file;b.line=a.line||a.lineNumber;b.column=a.column||a.columnNumber;b.stack=a.stack;b.innerError=a;return b}};var y=function(a,b,c,d,e,f){this.util=a;this.log=b;this.onError=c;this.onFault=d;this.options=f;this.document=e;f.enabled&&this.initialize(e)};y.prototype={initialize:function(a){var b=this.util.bind(this.onDocumentClicked,this),c=this.util.bind(this.onInputChanged,this);a.addEventListener?
(a.addEventListener("click",b,!0),a.addEventListener("blur",c,!0)):a.attachEvent&&(a.attachEvent("onclick",b),a.attachEvent("onfocusout",c))},onDocumentClicked:function(a){try{var b=this.getElementFromEvent(a);b&&b.tagName&&(this.isDescribedElement(b,"a")||this.isDescribedElement(b,"button")||this.isDescribedElement(b,"input",["button","submit"])?this.writeVisitorEvent(b,"click"):this.isDescribedElement(b,"input",["checkbox","radio"])&&this.writeVisitorEvent(b,"input",b.value,b.checked))}catch(c){this.onFault(c)}},
onInputChanged:function(a){try{var b=this.getElementFromEvent(a);if(b&&b.tagName)if(this.isDescribedElement(b,"textarea"))this.writeVisitorEvent(b,"input",b.value);else if(this.isDescribedElement(b,"select")&&b.options&&b.options.length)this.onSelectInputChanged(b);else this.isDescribedElement(b,"input")&&!this.isDescribedElement(b,"input",["button","submit","hidden","checkbox","radio"])&&this.writeVisitorEvent(b,"input",b.value)}catch(c){this.onFault(c)}},onSelectInputChanged:function(a){if(a.multiple)for(var b=
0;b<a.options.length;b++)a.options[b].selected&&this.writeVisitorEvent(a,"input",a.options[b].value);else 0<=a.selectedIndex&&a.options[a.selectedIndex]&&this.writeVisitorEvent(a,"input",a.options[a.selectedIndex].value)},writeVisitorEvent:function(a,b,c,d){"password"===this.getElementType(a)&&(c=k);this.log.add("v",{timestamp:this.util.isoNow(),action:b,element:{tag:a.tagName.toLowerCase(),attributes:this.getElementAttributes(a),value:this.getMetaValue(c,d)}})},getElementFromEvent:function(a){return a.target||
p.elementFromPoint(a.clientX,a.clientY)},isDescribedElement:function(a,b,c){if(a.tagName.toLowerCase()!==b.toLowerCase())return!1;if(!c)return!0;a=this.getElementType(a);for(b=0;b<c.length;b++)if(c[b]===a)return!0;return!1},getElementType:function(a){return(a.getAttribute("type")||"").toLowerCase()},getElementAttributes:function(a){for(var b={},c=0;c<a.attributes.length;c++)"value"!==a.attributes[c].name.toLowerCase()&&(b[a.attributes[c].name]=a.attributes[c].value);return b},getMetaValue:function(a,
b){return a===k?k:{length:a.length,pattern:this.matchInputPattern(a),checked:b}},matchInputPattern:function(a){return""===a?"empty":/^[a-z0-9!#$%&'*+=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/.test(a)?"email":/^(0?[1-9]|[12][0-9]|3[01])[\/\-](0?[1-9]|1[012])[\/\-]\d{4}$/.test(a)||/^(\d{4}[\/\-](0?[1-9]|1[012])[\/\-]0?[1-9]|[12][0-9]|3[01])$/.test(a)?"date":/^(?:(?:\+?1\s*(?:[.-]\s*)?)?(?:\(\s*([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9])\s*\)|([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]))\s*(?:[.-]\s*)?)?([2-9]1[02-9]|[2-9][02-9]1|[2-9][02-9]{2})\s*(?:[.-]\s*)?([0-9]{4})(?:\s*(?:#|x\.?|ext\.?|extension)\s*(\d+))?$/.test(a)?
"usphone":/^\s*$/.test(a)?"whitespace":/^\d*$/.test(a)?"numeric":/^[a-zA-Z]*$/.test(a)?"alpha":/^[a-zA-Z0-9]*$/.test(a)?"alphanumeric":"characters"},report:function(){return this.log.all("v")}};var z=function(a,b,c,d,e){this.onError=a;this.onFault=b;this.serialize=c;e.enabled&&this.watchWindowErrors(d)};z.prototype={watchWindowErrors:function(a){var b=this;a.onerror=function(a,d,e,f,g){try{g=g||{},g.message=g.message||b.serialize(a),g.file=g.file||b.serialize(d),g.line=g.line||parseInt(e,10)||null,
g.column=g.column||parseInt(f,10)||null,b.onError("window",g)}catch(h){b.onFault(h)}}}};var A=function(a,b,c,d,e,f,g,h,k,l,m,n,p,t,q,r){try{this.window=q,this.document=r,this.util=new m(this.window),this.onError=this.util.bind(this.onError,this),this.onFault=this.util.bind(this.onFault,this),this.serialize=this.util.bind(this.serialize,this),this.transmitter=new l(this.util),this.config=new d(this.util,a),this.log=new h(this.util),this.api=new b(this.config,this.util,this.onError),this.environment=
new g(this.window),this.customer=new f(this.config,this.util,this.log,this.window,this.document),this.customer.token&&(this.transmitter.sendUsage({token:this.customer.token,correlationId:this.customer.correlationId,application:this.config.current.application,x:this.util.uuid()}),this.apiConsoleWatcher=new e(this.util,this.log,this.onError,this.onFault,this.serialize,this.api,this.config.defaults.console),this.windowConsoleWatcher=new e(this.util,this.log,this.onError,this.onFault,this.serialize,this.window,
this.config.current.console),this.util.isBrowserSupported()&&this.config.current.enabled&&(this.callbackWatcher=new c(this.util,this.onError,this.onFault,this.window,this.config.current.callback),this.visitorWatcher=new n(this.util,this.log,this.onError,this.onFault,this.document,this.config.current.visitor),this.networkWatcher=new k(this.util,this.log,this.onError,this.onFault,this.window,this.config.current.network),this.windowWatcher=new p(this.onError,this.onFault,this.serialize,this.window,this.config.current.window)))}catch(s){this.onFault(s)}};
A.prototype={reveal:function(){if(this.customer.token)return this.api;this.window.console&&this.window.console.warn&&this.window.console.warn("TrackJS could not find a token");return k},onError:function(a,b,c){if(this.util.isBrowserSupported()&&this.config.current.enabled)try{b=b||{};c=c||{bindStack:null,bindTime:null,force:!1};var d=b.message||b;if(!d||!d.indexOf||-1===d.indexOf("TrackJS Caught")){var e=this.util.extend({},{bindStack:c.bindStack,bindTime:c.bindTime,column:b.column||b.columnNumber,
console:this.windowConsoleWatcher.report(),customer:this.customer.report(),entry:a,environment:this.environment.report(),file:b.file||b.fileName,line:b.line||b.lineNumber,message:c.force?d:this.serialize(d),network:this.networkWatcher.report(),url:(h.location||"").toString(),stack:b.stack,timestamp:this.util.isoNow(),visitor:this.visitorWatcher.report(),version:"2.1.6"});if(!c.force)try{if(!this.config.current.onError(e,b))return}catch(f){e.console.push({timestamp:this.util.isoNow(),severity:"error",
message:f.message});var g=this;setTimeout(function(){g.onError("catch",f,{force:!0})},0)}this.log.clear();this.transmitter.sendError(e,this.customer.token)}}catch(k){console.log(k),this.onFault(k)}},onFault:function(a){var b=this.transmitter||new n;a=a||{};a={token:this.customer.token,file:a.file||a.fileName,msg:a.message||"unknown",stack:(a.stack||"unknown").substr(0,500),url:this.window.location,v:"2.1.6",x:this.util.uuid()};b.sendTrackerFault(a)},serialize:function(a){if(this.config&&this.config.current&&
this.config.current.serialize)try{return this.config.current.serialize(a)}catch(b){return this.onError("catch",b,{force:!0}),this.util&&this.util.hasFunction(a,"toString")?a.toString():"unknown"}}};l=new A(h._trackJs||h._trackJS||h._trackjs||{},function(a,b,c){return{attempt:function(a,e){try{var f=Array.prototype.slice.call(arguments,2);return a.apply(e||this,f)}catch(g){throw c("catch",g),b.wrapError(g);}},configure:function(b){return a.setCurrent(b)},track:function(a){a=a||{};if(!a.stack)try{throw Error(a);
}catch(b){a=b}c("direct",a)},watch:function(a,e){return function(){try{var f=Array.prototype.slice.call(arguments,0);return a.apply(e||this,f)}catch(g){throw c("catch",g),b.wrapError(g);}}},watchAll:function(a){var e=Array.prototype.slice.call(arguments,1),f;for(f in a)"function"===typeof a[f]&&(b.contains(e,f)||function(){var e=a[f];a[f]=function(){try{var a=Array.prototype.slice.call(arguments,0);return e.apply(this,a)}catch(d){throw c("catch",d),b.wrapError(d);}}}());return a},version:"2.1.6"}},
l,t,q,r,s,v,w,n,x,y,z,m,h,p);h.trackJs=l.reveal()}})(window,document);

/*! jQuery v1.9.1 | (c) 2005, 2012 jQuery Foundation, Inc. | jquery.org/license
//@ sourceMappingURL=jquery.min.map
*/(function(e,t){var n,r,i=typeof t,o=e.document,a=e.location,s=e.jQuery,u=e.$,l={},c=[],p="1.9.1",f=c.concat,d=c.push,h=c.slice,g=c.indexOf,m=l.toString,y=l.hasOwnProperty,v=p.trim,b=function(e,t){return new b.fn.init(e,t,r)},x=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,w=/\S+/g,T=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,N=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,C=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,k=/^[\],:{}\s]*$/,E=/(?:^|:|,)(?:\s*\[)+/g,S=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,A=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,j=/^-ms-/,D=/-([\da-z])/gi,L=function(e,t){return t.toUpperCase()},H=function(e){(o.addEventListener||"load"===e.type||"complete"===o.readyState)&&(q(),b.ready())},q=function(){o.addEventListener?(o.removeEventListener("DOMContentLoaded",H,!1),e.removeEventListener("load",H,!1)):(o.detachEvent("onreadystatechange",H),e.detachEvent("onload",H))};b.fn=b.prototype={jquery:p,constructor:b,init:function(e,n,r){var i,a;if(!e)return this;if("string"==typeof e){if(i="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:N.exec(e),!i||!i[1]&&n)return!n||n.jquery?(n||r).find(e):this.constructor(n).find(e);if(i[1]){if(n=n instanceof b?n[0]:n,b.merge(this,b.parseHTML(i[1],n&&n.nodeType?n.ownerDocument||n:o,!0)),C.test(i[1])&&b.isPlainObject(n))for(i in n)b.isFunction(this[i])?this[i](n[i]):this.attr(i,n[i]);return this}if(a=o.getElementById(i[2]),a&&a.parentNode){if(a.id!==i[2])return r.find(e);this.length=1,this[0]=a}return this.context=o,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):b.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),b.makeArray(e,this))},selector:"",length:0,size:function(){return this.length},toArray:function(){return h.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e){var t=b.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return b.each(this,e,t)},ready:function(e){return b.ready.promise().done(e),this},slice:function(){return this.pushStack(h.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},map:function(e){return this.pushStack(b.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:d,sort:[].sort,splice:[].splice},b.fn.init.prototype=b.fn,b.extend=b.fn.extend=function(){var e,n,r,i,o,a,s=arguments[0]||{},u=1,l=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[1]||{},u=2),"object"==typeof s||b.isFunction(s)||(s={}),l===u&&(s=this,--u);l>u;u++)if(null!=(o=arguments[u]))for(i in o)e=s[i],r=o[i],s!==r&&(c&&r&&(b.isPlainObject(r)||(n=b.isArray(r)))?(n?(n=!1,a=e&&b.isArray(e)?e:[]):a=e&&b.isPlainObject(e)?e:{},s[i]=b.extend(c,a,r)):r!==t&&(s[i]=r));return s},b.extend({noConflict:function(t){return e.$===b&&(e.$=u),t&&e.jQuery===b&&(e.jQuery=s),b},isReady:!1,readyWait:1,holdReady:function(e){e?b.readyWait++:b.ready(!0)},ready:function(e){if(e===!0?!--b.readyWait:!b.isReady){if(!o.body)return setTimeout(b.ready);b.isReady=!0,e!==!0&&--b.readyWait>0||(n.resolveWith(o,[b]),b.fn.trigger&&b(o).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===b.type(e)},isArray:Array.isArray||function(e){return"array"===b.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?l[m.call(e)]||"object":typeof e},isPlainObject:function(e){if(!e||"object"!==b.type(e)||e.nodeType||b.isWindow(e))return!1;try{if(e.constructor&&!y.call(e,"constructor")&&!y.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var r;for(r in e);return r===t||y.call(e,r)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw Error(e)},parseHTML:function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||o;var r=C.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=b.buildFragment([e],t,i),i&&b(i).remove(),b.merge([],r.childNodes))},parseJSON:function(n){return e.JSON&&e.JSON.parse?e.JSON.parse(n):null===n?n:"string"==typeof n&&(n=b.trim(n),n&&k.test(n.replace(S,"@").replace(A,"]").replace(E,"")))?Function("return "+n)():(b.error("Invalid JSON: "+n),t)},parseXML:function(n){var r,i;if(!n||"string"!=typeof n)return null;try{e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(o){r=t}return r&&r.documentElement&&!r.getElementsByTagName("parsererror").length||b.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&b.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(j,"ms-").replace(D,L)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,o=e.length,a=M(e);if(n){if(a){for(;o>i;i++)if(r=t.apply(e[i],n),r===!1)break}else for(i in e)if(r=t.apply(e[i],n),r===!1)break}else if(a){for(;o>i;i++)if(r=t.call(e[i],i,e[i]),r===!1)break}else for(i in e)if(r=t.call(e[i],i,e[i]),r===!1)break;return e},trim:v&&!v.call("\ufeff\u00a0")?function(e){return null==e?"":v.call(e)}:function(e){return null==e?"":(e+"").replace(T,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(M(Object(e))?b.merge(n,"string"==typeof e?[e]:e):d.call(n,e)),n},inArray:function(e,t,n){var r;if(t){if(g)return g.call(t,e,n);for(r=t.length,n=n?0>n?Math.max(0,r+n):n:0;r>n;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=n.length,i=e.length,o=0;if("number"==typeof r)for(;r>o;o++)e[i++]=n[o];else while(n[o]!==t)e[i++]=n[o++];return e.length=i,e},grep:function(e,t,n){var r,i=[],o=0,a=e.length;for(n=!!n;a>o;o++)r=!!t(e[o],o),n!==r&&i.push(e[o]);return i},map:function(e,t,n){var r,i=0,o=e.length,a=M(e),s=[];if(a)for(;o>i;i++)r=t(e[i],i,n),null!=r&&(s[s.length]=r);else for(i in e)r=t(e[i],i,n),null!=r&&(s[s.length]=r);return f.apply([],s)},guid:1,proxy:function(e,n){var r,i,o;return"string"==typeof n&&(o=e[n],n=e,e=o),b.isFunction(e)?(r=h.call(arguments,2),i=function(){return e.apply(n||this,r.concat(h.call(arguments)))},i.guid=e.guid=e.guid||b.guid++,i):t},access:function(e,n,r,i,o,a,s){var u=0,l=e.length,c=null==r;if("object"===b.type(r)){o=!0;for(u in r)b.access(e,n,u,r[u],!0,a,s)}else if(i!==t&&(o=!0,b.isFunction(i)||(s=!0),c&&(s?(n.call(e,i),n=null):(c=n,n=function(e,t,n){return c.call(b(e),n)})),n))for(;l>u;u++)n(e[u],r,s?i:i.call(e[u],u,n(e[u],r)));return o?e:c?n.call(e):l?n(e[0],r):a},now:function(){return(new Date).getTime()}}),b.ready.promise=function(t){if(!n)if(n=b.Deferred(),"complete"===o.readyState)setTimeout(b.ready);else if(o.addEventListener)o.addEventListener("DOMContentLoaded",H,!1),e.addEventListener("load",H,!1);else{o.attachEvent("onreadystatechange",H),e.attachEvent("onload",H);var r=!1;try{r=null==e.frameElement&&o.documentElement}catch(i){}r&&r.doScroll&&function a(){if(!b.isReady){try{r.doScroll("left")}catch(e){return setTimeout(a,50)}q(),b.ready()}}()}return n.promise(t)},b.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){l["[object "+t+"]"]=t.toLowerCase()});function M(e){var t=e.length,n=b.type(e);return b.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||"function"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e)}r=b(o);var _={};function F(e){var t=_[e]={};return b.each(e.match(w)||[],function(e,n){t[n]=!0}),t}b.Callbacks=function(e){e="string"==typeof e?_[e]||F(e):b.extend({},e);var n,r,i,o,a,s,u=[],l=!e.once&&[],c=function(t){for(r=e.memory&&t,i=!0,a=s||0,s=0,o=u.length,n=!0;u&&o>a;a++)if(u[a].apply(t[0],t[1])===!1&&e.stopOnFalse){r=!1;break}n=!1,u&&(l?l.length&&c(l.shift()):r?u=[]:p.disable())},p={add:function(){if(u){var t=u.length;(function i(t){b.each(t,function(t,n){var r=b.type(n);"function"===r?e.unique&&p.has(n)||u.push(n):n&&n.length&&"string"!==r&&i(n)})})(arguments),n?o=u.length:r&&(s=t,c(r))}return this},remove:function(){return u&&b.each(arguments,function(e,t){var r;while((r=b.inArray(t,u,r))>-1)u.splice(r,1),n&&(o>=r&&o--,a>=r&&a--)}),this},has:function(e){return e?b.inArray(e,u)>-1:!(!u||!u.length)},empty:function(){return u=[],this},disable:function(){return u=l=r=t,this},disabled:function(){return!u},lock:function(){return l=t,r||p.disable(),this},locked:function(){return!l},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],!u||i&&!l||(n?l.push(t):c(t)),this},fire:function(){return p.fireWith(this,arguments),this},fired:function(){return!!i}};return p},b.extend({Deferred:function(e){var t=[["resolve","done",b.Callbacks("once memory"),"resolved"],["reject","fail",b.Callbacks("once memory"),"rejected"],["notify","progress",b.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return b.Deferred(function(n){b.each(t,function(t,o){var a=o[0],s=b.isFunction(e[t])&&e[t];i[o[1]](function(){var e=s&&s.apply(this,arguments);e&&b.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[a+"With"](this===r?n.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?b.extend(e,r):r}},i={};return r.pipe=r.then,b.each(t,function(e,o){var a=o[2],s=o[3];r[o[1]]=a.add,s&&a.add(function(){n=s},t[1^e][2].disable,t[2][2].lock),i[o[0]]=function(){return i[o[0]+"With"](this===i?r:this,arguments),this},i[o[0]+"With"]=a.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=h.call(arguments),r=n.length,i=1!==r||e&&b.isFunction(e.promise)?r:0,o=1===i?e:b.Deferred(),a=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?h.call(arguments):r,n===s?o.notifyWith(t,n):--i||o.resolveWith(t,n)}},s,u,l;if(r>1)for(s=Array(r),u=Array(r),l=Array(r);r>t;t++)n[t]&&b.isFunction(n[t].promise)?n[t].promise().done(a(t,l,n)).fail(o.reject).progress(a(t,u,s)):--i;return i||o.resolveWith(l,n),o.promise()}}),b.support=function(){var t,n,r,a,s,u,l,c,p,f,d=o.createElement("div");if(d.setAttribute("className","t"),d.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=d.getElementsByTagName("*"),r=d.getElementsByTagName("a")[0],!n||!r||!n.length)return{};s=o.createElement("select"),l=s.appendChild(o.createElement("option")),a=d.getElementsByTagName("input")[0],r.style.cssText="top:1px;float:left;opacity:.5",t={getSetAttribute:"t"!==d.className,leadingWhitespace:3===d.firstChild.nodeType,tbody:!d.getElementsByTagName("tbody").length,htmlSerialize:!!d.getElementsByTagName("link").length,style:/top/.test(r.getAttribute("style")),hrefNormalized:"/a"===r.getAttribute("href"),opacity:/^0.5/.test(r.style.opacity),cssFloat:!!r.style.cssFloat,checkOn:!!a.value,optSelected:l.selected,enctype:!!o.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==o.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===o.compatMode,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},a.checked=!0,t.noCloneChecked=a.cloneNode(!0).checked,s.disabled=!0,t.optDisabled=!l.disabled;try{delete d.test}catch(h){t.deleteExpando=!1}a=o.createElement("input"),a.setAttribute("value",""),t.input=""===a.getAttribute("value"),a.value="t",a.setAttribute("type","radio"),t.radioValue="t"===a.value,a.setAttribute("checked","t"),a.setAttribute("name","t"),u=o.createDocumentFragment(),u.appendChild(a),t.appendChecked=a.checked,t.checkClone=u.cloneNode(!0).cloneNode(!0).lastChild.checked,d.attachEvent&&(d.attachEvent("onclick",function(){t.noCloneEvent=!1}),d.cloneNode(!0).click());for(f in{submit:!0,change:!0,focusin:!0})d.setAttribute(c="on"+f,"t"),t[f+"Bubbles"]=c in e||d.attributes[c].expando===!1;return d.style.backgroundClip="content-box",d.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle="content-box"===d.style.backgroundClip,b(function(){var n,r,a,s="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",u=o.getElementsByTagName("body")[0];u&&(n=o.createElement("div"),n.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",u.appendChild(n).appendChild(d),d.innerHTML="<table><tr><td></td><td>t</td></tr></table>",a=d.getElementsByTagName("td"),a[0].style.cssText="padding:0;margin:0;border:0;display:none",p=0===a[0].offsetHeight,a[0].style.display="",a[1].style.display="none",t.reliableHiddenOffsets=p&&0===a[0].offsetHeight,d.innerHTML="",d.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=4===d.offsetWidth,t.doesNotIncludeMarginInBodyOffset=1!==u.offsetTop,e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(d,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(d,null)||{width:"4px"}).width,r=d.appendChild(o.createElement("div")),r.style.cssText=d.style.cssText=s,r.style.marginRight=r.style.width="0",d.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(r,null)||{}).marginRight)),typeof d.style.zoom!==i&&(d.innerHTML="",d.style.cssText=s+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=3===d.offsetWidth,d.style.display="block",d.innerHTML="<div></div>",d.firstChild.style.width="5px",t.shrinkWrapBlocks=3!==d.offsetWidth,t.inlineBlockNeedsLayout&&(u.style.zoom=1)),u.removeChild(n),n=d=a=r=null)}),n=s=u=l=r=a=null,t}();var O=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,B=/([A-Z])/g;function P(e,n,r,i){if(b.acceptData(e)){var o,a,s=b.expando,u="string"==typeof n,l=e.nodeType,p=l?b.cache:e,f=l?e[s]:e[s]&&s;if(f&&p[f]&&(i||p[f].data)||!u||r!==t)return f||(l?e[s]=f=c.pop()||b.guid++:f=s),p[f]||(p[f]={},l||(p[f].toJSON=b.noop)),("object"==typeof n||"function"==typeof n)&&(i?p[f]=b.extend(p[f],n):p[f].data=b.extend(p[f].data,n)),o=p[f],i||(o.data||(o.data={}),o=o.data),r!==t&&(o[b.camelCase(n)]=r),u?(a=o[n],null==a&&(a=o[b.camelCase(n)])):a=o,a}}function R(e,t,n){if(b.acceptData(e)){var r,i,o,a=e.nodeType,s=a?b.cache:e,u=a?e[b.expando]:b.expando;if(s[u]){if(t&&(o=n?s[u]:s[u].data)){b.isArray(t)?t=t.concat(b.map(t,b.camelCase)):t in o?t=[t]:(t=b.camelCase(t),t=t in o?[t]:t.split(" "));for(r=0,i=t.length;i>r;r++)delete o[t[r]];if(!(n?$:b.isEmptyObject)(o))return}(n||(delete s[u].data,$(s[u])))&&(a?b.cleanData([e],!0):b.support.deleteExpando||s!=s.window?delete s[u]:s[u]=null)}}}b.extend({cache:{},expando:"jQuery"+(p+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?b.cache[e[b.expando]]:e[b.expando],!!e&&!$(e)},data:function(e,t,n){return P(e,t,n)},removeData:function(e,t){return R(e,t)},_data:function(e,t,n){return P(e,t,n,!0)},_removeData:function(e,t){return R(e,t,!0)},acceptData:function(e){if(e.nodeType&&1!==e.nodeType&&9!==e.nodeType)return!1;var t=e.nodeName&&b.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}}),b.fn.extend({data:function(e,n){var r,i,o=this[0],a=0,s=null;if(e===t){if(this.length&&(s=b.data(o),1===o.nodeType&&!b._data(o,"parsedAttrs"))){for(r=o.attributes;r.length>a;a++)i=r[a].name,i.indexOf("data-")||(i=b.camelCase(i.slice(5)),W(o,i,s[i]));b._data(o,"parsedAttrs",!0)}return s}return"object"==typeof e?this.each(function(){b.data(this,e)}):b.access(this,function(n){return n===t?o?W(o,e,b.data(o,e)):null:(this.each(function(){b.data(this,e,n)}),t)},null,n,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){b.removeData(this,e)})}});function W(e,n,r){if(r===t&&1===e.nodeType){var i="data-"+n.replace(B,"-$1").toLowerCase();if(r=e.getAttribute(i),"string"==typeof r){try{r="true"===r?!0:"false"===r?!1:"null"===r?null:+r+""===r?+r:O.test(r)?b.parseJSON(r):r}catch(o){}b.data(e,n,r)}else r=t}return r}function $(e){var t;for(t in e)if(("data"!==t||!b.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}b.extend({queue:function(e,n,r){var i;return e?(n=(n||"fx")+"queue",i=b._data(e,n),r&&(!i||b.isArray(r)?i=b._data(e,n,b.makeArray(r)):i.push(r)),i||[]):t},dequeue:function(e,t){t=t||"fx";var n=b.queue(e,t),r=n.length,i=n.shift(),o=b._queueHooks(e,t),a=function(){b.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),r--),o.cur=i,i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,a,o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return b._data(e,n)||b._data(e,n,{empty:b.Callbacks("once memory").add(function(){b._removeData(e,t+"queue"),b._removeData(e,n)})})}}),b.fn.extend({queue:function(e,n){var r=2;return"string"!=typeof e&&(n=e,e="fx",r--),r>arguments.length?b.queue(this[0],e):n===t?this:this.each(function(){var t=b.queue(this,e,n);b._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&b.dequeue(this,e)})},dequeue:function(e){return this.each(function(){b.dequeue(this,e)})},delay:function(e,t){return e=b.fx?b.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,o=b.Deferred(),a=this,s=this.length,u=function(){--i||o.resolveWith(a,[a])};"string"!=typeof e&&(n=e,e=t),e=e||"fx";while(s--)r=b._data(a[s],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(u));return u(),o.promise(n)}});var I,z,X=/[\t\r\n]/g,U=/\r/g,V=/^(?:input|select|textarea|button|object)$/i,Y=/^(?:a|area)$/i,J=/^(?:checked|selected|autofocus|autoplay|async|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped)$/i,G=/^(?:checked|selected)$/i,Q=b.support.getSetAttribute,K=b.support.input;b.fn.extend({attr:function(e,t){return b.access(this,b.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){b.removeAttr(this,e)})},prop:function(e,t){return b.access(this,b.prop,e,t,arguments.length>1)},removeProp:function(e){return e=b.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,o,a=0,s=this.length,u="string"==typeof e&&e;if(b.isFunction(e))return this.each(function(t){b(this).addClass(e.call(this,t,this.className))});if(u)for(t=(e||"").match(w)||[];s>a;a++)if(n=this[a],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(X," "):" ")){o=0;while(i=t[o++])0>r.indexOf(" "+i+" ")&&(r+=i+" ");n.className=b.trim(r)}return this},removeClass:function(e){var t,n,r,i,o,a=0,s=this.length,u=0===arguments.length||"string"==typeof e&&e;if(b.isFunction(e))return this.each(function(t){b(this).removeClass(e.call(this,t,this.className))});if(u)for(t=(e||"").match(w)||[];s>a;a++)if(n=this[a],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(X," "):"")){o=0;while(i=t[o++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");n.className=e?b.trim(r):""}return this},toggleClass:function(e,t){var n=typeof e,r="boolean"==typeof t;return b.isFunction(e)?this.each(function(n){b(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if("string"===n){var o,a=0,s=b(this),u=t,l=e.match(w)||[];while(o=l[a++])u=r?u:!s.hasClass(o),s[u?"addClass":"removeClass"](o)}else(n===i||"boolean"===n)&&(this.className&&b._data(this,"__className__",this.className),this.className=this.className||e===!1?"":b._data(this,"__className__")||"")})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;r>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(X," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,r,i,o=this[0];{if(arguments.length)return i=b.isFunction(e),this.each(function(n){var o,a=b(this);1===this.nodeType&&(o=i?e.call(this,n,a.val()):e,null==o?o="":"number"==typeof o?o+="":b.isArray(o)&&(o=b.map(o,function(e){return null==e?"":e+""})),r=b.valHooks[this.type]||b.valHooks[this.nodeName.toLowerCase()],r&&"set"in r&&r.set(this,o,"value")!==t||(this.value=o))});if(o)return r=b.valHooks[o.type]||b.valHooks[o.nodeName.toLowerCase()],r&&"get"in r&&(n=r.get(o,"value"))!==t?n:(n=o.value,"string"==typeof n?n.replace(U,""):null==n?"":n)}}}),b.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,o="select-one"===e.type||0>i,a=o?null:[],s=o?i+1:r.length,u=0>i?s:o?i:0;for(;s>u;u++)if(n=r[u],!(!n.selected&&u!==i||(b.support.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&b.nodeName(n.parentNode,"optgroup"))){if(t=b(n).val(),o)return t;a.push(t)}return a},set:function(e,t){var n=b.makeArray(t);return b(e).find("option").each(function(){this.selected=b.inArray(b(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attr:function(e,n,r){var o,a,s,u=e.nodeType;if(e&&3!==u&&8!==u&&2!==u)return typeof e.getAttribute===i?b.prop(e,n,r):(a=1!==u||!b.isXMLDoc(e),a&&(n=n.toLowerCase(),o=b.attrHooks[n]||(J.test(n)?z:I)),r===t?o&&a&&"get"in o&&null!==(s=o.get(e,n))?s:(typeof e.getAttribute!==i&&(s=e.getAttribute(n)),null==s?t:s):null!==r?o&&a&&"set"in o&&(s=o.set(e,r,n))!==t?s:(e.setAttribute(n,r+""),r):(b.removeAttr(e,n),t))},removeAttr:function(e,t){var n,r,i=0,o=t&&t.match(w);if(o&&1===e.nodeType)while(n=o[i++])r=b.propFix[n]||n,J.test(n)?!Q&&G.test(n)?e[b.camelCase("default-"+n)]=e[r]=!1:e[r]=!1:b.attr(e,n,""),e.removeAttribute(Q?n:r)},attrHooks:{type:{set:function(e,t){if(!b.support.radioValue&&"radio"===t&&b.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,o,a,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return a=1!==s||!b.isXMLDoc(e),a&&(n=b.propFix[n]||n,o=b.propHooks[n]),r!==t?o&&"set"in o&&(i=o.set(e,r,n))!==t?i:e[n]=r:o&&"get"in o&&null!==(i=o.get(e,n))?i:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):V.test(e.nodeName)||Y.test(e.nodeName)&&e.href?0:t}}}}),z={get:function(e,n){var r=b.prop(e,n),i="boolean"==typeof r&&e.getAttribute(n),o="boolean"==typeof r?K&&Q?null!=i:G.test(n)?e[b.camelCase("default-"+n)]:!!i:e.getAttributeNode(n);return o&&o.value!==!1?n.toLowerCase():t},set:function(e,t,n){return t===!1?b.removeAttr(e,n):K&&Q||!G.test(n)?e.setAttribute(!Q&&b.propFix[n]||n,n):e[b.camelCase("default-"+n)]=e[n]=!0,n}},K&&Q||(b.attrHooks.value={get:function(e,n){var r=e.getAttributeNode(n);return b.nodeName(e,"input")?e.defaultValue:r&&r.specified?r.value:t},set:function(e,n,r){return b.nodeName(e,"input")?(e.defaultValue=n,t):I&&I.set(e,n,r)}}),Q||(I=b.valHooks.button={get:function(e,n){var r=e.getAttributeNode(n);return r&&("id"===n||"name"===n||"coords"===n?""!==r.value:r.specified)?r.value:t},set:function(e,n,r){var i=e.getAttributeNode(r);return i||e.setAttributeNode(i=e.ownerDocument.createAttribute(r)),i.value=n+="","value"===r||n===e.getAttribute(r)?n:t}},b.attrHooks.contenteditable={get:I.get,set:function(e,t,n){I.set(e,""===t?!1:t,n)}},b.each(["width","height"],function(e,n){b.attrHooks[n]=b.extend(b.attrHooks[n],{set:function(e,r){return""===r?(e.setAttribute(n,"auto"),r):t}})})),b.support.hrefNormalized||(b.each(["href","src","width","height"],function(e,n){b.attrHooks[n]=b.extend(b.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return null==r?t:r}})}),b.each(["href","src"],function(e,t){b.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}})),b.support.style||(b.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}}),b.support.optSelected||(b.propHooks.selected=b.extend(b.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),b.support.enctype||(b.propFix.enctype="encoding"),b.support.checkOn||b.each(["radio","checkbox"],function(){b.valHooks[this]={get:function(e){return null===e.getAttribute("value")?"on":e.value}}}),b.each(["radio","checkbox"],function(){b.valHooks[this]=b.extend(b.valHooks[this],{set:function(e,n){return b.isArray(n)?e.checked=b.inArray(b(e).val(),n)>=0:t}})});var Z=/^(?:input|select|textarea)$/i,et=/^key/,tt=/^(?:mouse|contextmenu)|click/,nt=/^(?:focusinfocus|focusoutblur)$/,rt=/^([^.]*)(?:\.(.+)|)$/;function it(){return!0}function ot(){return!1}b.event={global:{},add:function(e,n,r,o,a){var s,u,l,c,p,f,d,h,g,m,y,v=b._data(e);if(v){r.handler&&(c=r,r=c.handler,a=c.selector),r.guid||(r.guid=b.guid++),(u=v.events)||(u=v.events={}),(f=v.handle)||(f=v.handle=function(e){return typeof b===i||e&&b.event.triggered===e.type?t:b.event.dispatch.apply(f.elem,arguments)},f.elem=e),n=(n||"").match(w)||[""],l=n.length;while(l--)s=rt.exec(n[l])||[],g=y=s[1],m=(s[2]||"").split(".").sort(),p=b.event.special[g]||{},g=(a?p.delegateType:p.bindType)||g,p=b.event.special[g]||{},d=b.extend({type:g,origType:y,data:o,handler:r,guid:r.guid,selector:a,needsContext:a&&b.expr.match.needsContext.test(a),namespace:m.join(".")},c),(h=u[g])||(h=u[g]=[],h.delegateCount=0,p.setup&&p.setup.call(e,o,m,f)!==!1||(e.addEventListener?e.addEventListener(g,f,!1):e.attachEvent&&e.attachEvent("on"+g,f))),p.add&&(p.add.call(e,d),d.handler.guid||(d.handler.guid=r.guid)),a?h.splice(h.delegateCount++,0,d):h.push(d),b.event.global[g]=!0;e=null}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,p,f,d,h,g,m=b.hasData(e)&&b._data(e);if(m&&(c=m.events)){t=(t||"").match(w)||[""],l=t.length;while(l--)if(s=rt.exec(t[l])||[],d=g=s[1],h=(s[2]||"").split(".").sort(),d){p=b.event.special[d]||{},d=(r?p.delegateType:p.bindType)||d,f=c[d]||[],s=s[2]&&RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),u=o=f.length;while(o--)a=f[o],!i&&g!==a.origType||n&&n.guid!==a.guid||s&&!s.test(a.namespace)||r&&r!==a.selector&&("**"!==r||!a.selector)||(f.splice(o,1),a.selector&&f.delegateCount--,p.remove&&p.remove.call(e,a));u&&!f.length&&(p.teardown&&p.teardown.call(e,h,m.handle)!==!1||b.removeEvent(e,d,m.handle),delete c[d])}else for(d in c)b.event.remove(e,d+t[l],n,r,!0);b.isEmptyObject(c)&&(delete m.handle,b._removeData(e,"events"))}},trigger:function(n,r,i,a){var s,u,l,c,p,f,d,h=[i||o],g=y.call(n,"type")?n.type:n,m=y.call(n,"namespace")?n.namespace.split("."):[];if(l=f=i=i||o,3!==i.nodeType&&8!==i.nodeType&&!nt.test(g+b.event.triggered)&&(g.indexOf(".")>=0&&(m=g.split("."),g=m.shift(),m.sort()),u=0>g.indexOf(":")&&"on"+g,n=n[b.expando]?n:new b.Event(g,"object"==typeof n&&n),n.isTrigger=!0,n.namespace=m.join("."),n.namespace_re=n.namespace?RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=t,n.target||(n.target=i),r=null==r?[n]:b.makeArray(r,[n]),p=b.event.special[g]||{},a||!p.trigger||p.trigger.apply(i,r)!==!1)){if(!a&&!p.noBubble&&!b.isWindow(i)){for(c=p.delegateType||g,nt.test(c+g)||(l=l.parentNode);l;l=l.parentNode)h.push(l),f=l;f===(i.ownerDocument||o)&&h.push(f.defaultView||f.parentWindow||e)}d=0;while((l=h[d++])&&!n.isPropagationStopped())n.type=d>1?c:p.bindType||g,s=(b._data(l,"events")||{})[n.type]&&b._data(l,"handle"),s&&s.apply(l,r),s=u&&l[u],s&&b.acceptData(l)&&s.apply&&s.apply(l,r)===!1&&n.preventDefault();if(n.type=g,!(a||n.isDefaultPrevented()||p._default&&p._default.apply(i.ownerDocument,r)!==!1||"click"===g&&b.nodeName(i,"a")||!b.acceptData(i)||!u||!i[g]||b.isWindow(i))){f=i[u],f&&(i[u]=null),b.event.triggered=g;try{i[g]()}catch(v){}b.event.triggered=t,f&&(i[u]=f)}return n.result}},dispatch:function(e){e=b.event.fix(e);var n,r,i,o,a,s=[],u=h.call(arguments),l=(b._data(this,"events")||{})[e.type]||[],c=b.event.special[e.type]||{};if(u[0]=e,e.delegateTarget=this,!c.preDispatch||c.preDispatch.call(this,e)!==!1){s=b.event.handlers.call(this,e,l),n=0;while((o=s[n++])&&!e.isPropagationStopped()){e.currentTarget=o.elem,a=0;while((i=o.handlers[a++])&&!e.isImmediatePropagationStopped())(!e.namespace_re||e.namespace_re.test(i.namespace))&&(e.handleObj=i,e.data=i.data,r=((b.event.special[i.origType]||{}).handle||i.handler).apply(o.elem,u),r!==t&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,e),e.result}},handlers:function(e,n){var r,i,o,a,s=[],u=n.delegateCount,l=e.target;if(u&&l.nodeType&&(!e.button||"click"!==e.type))for(;l!=this;l=l.parentNode||this)if(1===l.nodeType&&(l.disabled!==!0||"click"!==e.type)){for(o=[],a=0;u>a;a++)i=n[a],r=i.selector+" ",o[r]===t&&(o[r]=i.needsContext?b(r,this).index(l)>=0:b.find(r,this,null,[l]).length),o[r]&&o.push(i);o.length&&s.push({elem:l,handlers:o})}return n.length>u&&s.push({elem:this,handlers:n.slice(u)}),s},fix:function(e){if(e[b.expando])return e;var t,n,r,i=e.type,a=e,s=this.fixHooks[i];s||(this.fixHooks[i]=s=tt.test(i)?this.mouseHooks:et.test(i)?this.keyHooks:{}),r=s.props?this.props.concat(s.props):this.props,e=new b.Event(a),t=r.length;while(t--)n=r[t],e[n]=a[n];return e.target||(e.target=a.srcElement||o),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,a):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,i,a,s=n.button,u=n.fromElement;return null==e.pageX&&null!=n.clientX&&(i=e.target.ownerDocument||o,a=i.documentElement,r=i.body,e.pageX=n.clientX+(a&&a.scrollLeft||r&&r.scrollLeft||0)-(a&&a.clientLeft||r&&r.clientLeft||0),e.pageY=n.clientY+(a&&a.scrollTop||r&&r.scrollTop||0)-(a&&a.clientTop||r&&r.clientTop||0)),!e.relatedTarget&&u&&(e.relatedTarget=u===e.target?n.toElement:u),e.which||s===t||(e.which=1&s?1:2&s?3:4&s?2:0),e}},special:{load:{noBubble:!0},click:{trigger:function(){return b.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):t}},focus:{trigger:function(){if(this!==o.activeElement&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===o.activeElement&&this.blur?(this.blur(),!1):t},delegateType:"focusout"},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=b.extend(new b.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?b.event.trigger(i,null,t):b.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},b.removeEvent=o.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]===i&&(e[r]=null),e.detachEvent(r,n))},b.Event=function(e,n){return this instanceof b.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?it:ot):this.type=e,n&&b.extend(this,n),this.timeStamp=e&&e.timeStamp||b.now(),this[b.expando]=!0,t):new b.Event(e,n)},b.Event.prototype={isDefaultPrevented:ot,isPropagationStopped:ot,isImmediatePropagationStopped:ot,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=it,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=it,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=it,this.stopPropagation()}},b.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){b.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,o=e.handleObj;
return(!i||i!==r&&!b.contains(r,i))&&(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}}),b.support.submitBubbles||(b.event.special.submit={setup:function(){return b.nodeName(this,"form")?!1:(b.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=b.nodeName(n,"input")||b.nodeName(n,"button")?n.form:t;r&&!b._data(r,"submitBubbles")&&(b.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),b._data(r,"submitBubbles",!0))}),t)},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&b.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return b.nodeName(this,"form")?!1:(b.event.remove(this,"._submit"),t)}}),b.support.changeBubbles||(b.event.special.change={setup:function(){return Z.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(b.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),b.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),b.event.simulate("change",this,e,!0)})),!1):(b.event.add(this,"beforeactivate._change",function(e){var t=e.target;Z.test(t.nodeName)&&!b._data(t,"changeBubbles")&&(b.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||b.event.simulate("change",this.parentNode,e,!0)}),b._data(t,"changeBubbles",!0))}),t)},handle:function(e){var n=e.target;return this!==n||e.isSimulated||e.isTrigger||"radio"!==n.type&&"checkbox"!==n.type?e.handleObj.handler.apply(this,arguments):t},teardown:function(){return b.event.remove(this,"._change"),!Z.test(this.nodeName)}}),b.support.focusinBubbles||b.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){b.event.simulate(t,e.target,b.event.fix(e),!0)};b.event.special[t]={setup:function(){0===n++&&o.addEventListener(e,r,!0)},teardown:function(){0===--n&&o.removeEventListener(e,r,!0)}}}),b.fn.extend({on:function(e,n,r,i,o){var a,s;if("object"==typeof e){"string"!=typeof n&&(r=r||n,n=t);for(a in e)this.on(a,n,r,e[a],o);return this}if(null==r&&null==i?(i=n,r=n=t):null==i&&("string"==typeof n?(i=r,r=t):(i=r,r=n,n=t)),i===!1)i=ot;else if(!i)return this;return 1===o&&(s=i,i=function(e){return b().off(e),s.apply(this,arguments)},i.guid=s.guid||(s.guid=b.guid++)),this.each(function(){b.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,o;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,b(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(o in e)this.off(o,n,e[o]);return this}return(n===!1||"function"==typeof n)&&(r=n,n=t),r===!1&&(r=ot),this.each(function(){b.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},trigger:function(e,t){return this.each(function(){b.event.trigger(e,t,this)})},triggerHandler:function(e,n){var r=this[0];return r?b.event.trigger(e,n,r,!0):t}}),function(e,t){var n,r,i,o,a,s,u,l,c,p,f,d,h,g,m,y,v,x="sizzle"+-new Date,w=e.document,T={},N=0,C=0,k=it(),E=it(),S=it(),A=typeof t,j=1<<31,D=[],L=D.pop,H=D.push,q=D.slice,M=D.indexOf||function(e){var t=0,n=this.length;for(;n>t;t++)if(this[t]===e)return t;return-1},_="[\\x20\\t\\r\\n\\f]",F="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",O=F.replace("w","w#"),B="([*^$|!~]?=)",P="\\["+_+"*("+F+")"+_+"*(?:"+B+_+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+O+")|)|)"+_+"*\\]",R=":("+F+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+P.replace(3,8)+")*)|.*)\\)|)",W=RegExp("^"+_+"+|((?:^|[^\\\\])(?:\\\\.)*)"+_+"+$","g"),$=RegExp("^"+_+"*,"+_+"*"),I=RegExp("^"+_+"*([\\x20\\t\\r\\n\\f>+~])"+_+"*"),z=RegExp(R),X=RegExp("^"+O+"$"),U={ID:RegExp("^#("+F+")"),CLASS:RegExp("^\\.("+F+")"),NAME:RegExp("^\\[name=['\"]?("+F+")['\"]?\\]"),TAG:RegExp("^("+F.replace("w","w*")+")"),ATTR:RegExp("^"+P),PSEUDO:RegExp("^"+R),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+_+"*(even|odd|(([+-]|)(\\d*)n|)"+_+"*(?:([+-]|)"+_+"*(\\d+)|))"+_+"*\\)|)","i"),needsContext:RegExp("^"+_+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+_+"*((?:-\\d)?\\d*)"+_+"*\\)|)(?=[^-]|$)","i")},V=/[\x20\t\r\n\f]*[+~]/,Y=/^[^{]+\{\s*\[native code/,J=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,G=/^(?:input|select|textarea|button)$/i,Q=/^h\d$/i,K=/'|\\/g,Z=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,et=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,tt=function(e,t){var n="0x"+t-65536;return n!==n?t:0>n?String.fromCharCode(n+65536):String.fromCharCode(55296|n>>10,56320|1023&n)};try{q.call(w.documentElement.childNodes,0)[0].nodeType}catch(nt){q=function(e){var t,n=[];while(t=this[e++])n.push(t);return n}}function rt(e){return Y.test(e+"")}function it(){var e,t=[];return e=function(n,r){return t.push(n+=" ")>i.cacheLength&&delete e[t.shift()],e[n]=r}}function ot(e){return e[x]=!0,e}function at(e){var t=p.createElement("div");try{return e(t)}catch(n){return!1}finally{t=null}}function st(e,t,n,r){var i,o,a,s,u,l,f,g,m,v;if((t?t.ownerDocument||t:w)!==p&&c(t),t=t||p,n=n||[],!e||"string"!=typeof e)return n;if(1!==(s=t.nodeType)&&9!==s)return[];if(!d&&!r){if(i=J.exec(e))if(a=i[1]){if(9===s){if(o=t.getElementById(a),!o||!o.parentNode)return n;if(o.id===a)return n.push(o),n}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(a))&&y(t,o)&&o.id===a)return n.push(o),n}else{if(i[2])return H.apply(n,q.call(t.getElementsByTagName(e),0)),n;if((a=i[3])&&T.getByClassName&&t.getElementsByClassName)return H.apply(n,q.call(t.getElementsByClassName(a),0)),n}if(T.qsa&&!h.test(e)){if(f=!0,g=x,m=t,v=9===s&&e,1===s&&"object"!==t.nodeName.toLowerCase()){l=ft(e),(f=t.getAttribute("id"))?g=f.replace(K,"\\$&"):t.setAttribute("id",g),g="[id='"+g+"'] ",u=l.length;while(u--)l[u]=g+dt(l[u]);m=V.test(e)&&t.parentNode||t,v=l.join(",")}if(v)try{return H.apply(n,q.call(m.querySelectorAll(v),0)),n}catch(b){}finally{f||t.removeAttribute("id")}}}return wt(e.replace(W,"$1"),t,n,r)}a=st.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},c=st.setDocument=function(e){var n=e?e.ownerDocument||e:w;return n!==p&&9===n.nodeType&&n.documentElement?(p=n,f=n.documentElement,d=a(n),T.tagNameNoComments=at(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName("*").length}),T.attributes=at(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return"boolean"!==t&&"string"!==t}),T.getByClassName=at(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",e.getElementsByClassName&&e.getElementsByClassName("e").length?(e.lastChild.className="e",2===e.getElementsByClassName("e").length):!1}),T.getByName=at(function(e){e.id=x+0,e.innerHTML="<a name='"+x+"'></a><div name='"+x+"'></div>",f.insertBefore(e,f.firstChild);var t=n.getElementsByName&&n.getElementsByName(x).length===2+n.getElementsByName(x+0).length;return T.getIdNotName=!n.getElementById(x),f.removeChild(e),t}),i.attrHandle=at(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==A&&"#"===e.firstChild.getAttribute("href")})?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},T.getIdNotName?(i.find.ID=function(e,t){if(typeof t.getElementById!==A&&!d){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},i.filter.ID=function(e){var t=e.replace(et,tt);return function(e){return e.getAttribute("id")===t}}):(i.find.ID=function(e,n){if(typeof n.getElementById!==A&&!d){var r=n.getElementById(e);return r?r.id===e||typeof r.getAttributeNode!==A&&r.getAttributeNode("id").value===e?[r]:t:[]}},i.filter.ID=function(e){var t=e.replace(et,tt);return function(e){var n=typeof e.getAttributeNode!==A&&e.getAttributeNode("id");return n&&n.value===t}}),i.find.TAG=T.tagNameNoComments?function(e,n){return typeof n.getElementsByTagName!==A?n.getElementsByTagName(e):t}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){while(n=o[i++])1===n.nodeType&&r.push(n);return r}return o},i.find.NAME=T.getByName&&function(e,n){return typeof n.getElementsByName!==A?n.getElementsByName(name):t},i.find.CLASS=T.getByClassName&&function(e,n){return typeof n.getElementsByClassName===A||d?t:n.getElementsByClassName(e)},g=[],h=[":focus"],(T.qsa=rt(n.querySelectorAll))&&(at(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||h.push("\\["+_+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||h.push(":checked")}),at(function(e){e.innerHTML="<input type='hidden' i=''/>",e.querySelectorAll("[i^='']").length&&h.push("[*^$]="+_+"*(?:\"\"|'')"),e.querySelectorAll(":enabled").length||h.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),h.push(",.*:")})),(T.matchesSelector=rt(m=f.matchesSelector||f.mozMatchesSelector||f.webkitMatchesSelector||f.oMatchesSelector||f.msMatchesSelector))&&at(function(e){T.disconnectedMatch=m.call(e,"div"),m.call(e,"[s!='']:x"),g.push("!=",R)}),h=RegExp(h.join("|")),g=RegExp(g.join("|")),y=rt(f.contains)||f.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},v=f.compareDocumentPosition?function(e,t){var r;return e===t?(u=!0,0):(r=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t))?1&r||e.parentNode&&11===e.parentNode.nodeType?e===n||y(w,e)?-1:t===n||y(w,t)?1:0:4&r?-1:1:e.compareDocumentPosition?-1:1}:function(e,t){var r,i=0,o=e.parentNode,a=t.parentNode,s=[e],l=[t];if(e===t)return u=!0,0;if(!o||!a)return e===n?-1:t===n?1:o?-1:a?1:0;if(o===a)return ut(e,t);r=e;while(r=r.parentNode)s.unshift(r);r=t;while(r=r.parentNode)l.unshift(r);while(s[i]===l[i])i++;return i?ut(s[i],l[i]):s[i]===w?-1:l[i]===w?1:0},u=!1,[0,0].sort(v),T.detectDuplicates=u,p):p},st.matches=function(e,t){return st(e,null,null,t)},st.matchesSelector=function(e,t){if((e.ownerDocument||e)!==p&&c(e),t=t.replace(Z,"='$1']"),!(!T.matchesSelector||d||g&&g.test(t)||h.test(t)))try{var n=m.call(e,t);if(n||T.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(r){}return st(t,p,null,[e]).length>0},st.contains=function(e,t){return(e.ownerDocument||e)!==p&&c(e),y(e,t)},st.attr=function(e,t){var n;return(e.ownerDocument||e)!==p&&c(e),d||(t=t.toLowerCase()),(n=i.attrHandle[t])?n(e):d||T.attributes?e.getAttribute(t):((n=e.getAttributeNode(t))||e.getAttribute(t))&&e[t]===!0?t:n&&n.specified?n.value:null},st.error=function(e){throw Error("Syntax error, unrecognized expression: "+e)},st.uniqueSort=function(e){var t,n=[],r=1,i=0;if(u=!T.detectDuplicates,e.sort(v),u){for(;t=e[r];r++)t===e[r-1]&&(i=n.push(r));while(i--)e.splice(n[i],1)}return e};function ut(e,t){var n=t&&e,r=n&&(~t.sourceIndex||j)-(~e.sourceIndex||j);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function lt(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function ct(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function pt(e){return ot(function(t){return t=+t,ot(function(n,r){var i,o=e([],n.length,t),a=o.length;while(a--)n[i=o[a]]&&(n[i]=!(r[i]=n[i]))})})}o=st.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r];r++)n+=o(t);return n},i=st.selectors={cacheLength:50,createPseudo:ot,match:U,find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(et,tt),e[3]=(e[4]||e[5]||"").replace(et,tt),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||st.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&st.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return U.CHILD.test(e[0])?null:(e[4]?e[2]=e[4]:n&&z.test(n)&&(t=ft(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){return"*"===e?function(){return!0}:(e=e.replace(et,tt).toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=k[e+" "];return t||(t=RegExp("(^|"+_+")"+e+"("+_+"|$)"))&&k(e,function(e){return t.test(e.className||typeof e.getAttribute!==A&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=st.attr(r,e);return null==i?"!="===t:t?(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,u){var l,c,p,f,d,h,g=o!==a?"nextSibling":"previousSibling",m=t.parentNode,y=s&&t.nodeName.toLowerCase(),v=!u&&!s;if(m){if(o){while(g){p=t;while(p=p[g])if(s?p.nodeName.toLowerCase()===y:1===p.nodeType)return!1;h=g="only"===e&&!h&&"nextSibling"}return!0}if(h=[a?m.firstChild:m.lastChild],a&&v){c=m[x]||(m[x]={}),l=c[e]||[],d=l[0]===N&&l[1],f=l[0]===N&&l[2],p=d&&m.childNodes[d];while(p=++d&&p&&p[g]||(f=d=0)||h.pop())if(1===p.nodeType&&++f&&p===t){c[e]=[N,d,f];break}}else if(v&&(l=(t[x]||(t[x]={}))[e])&&l[0]===N)f=l[1];else while(p=++d&&p&&p[g]||(f=d=0)||h.pop())if((s?p.nodeName.toLowerCase()===y:1===p.nodeType)&&++f&&(v&&((p[x]||(p[x]={}))[e]=[N,f]),p===t))break;return f-=i,f===r||0===f%r&&f/r>=0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||st.error("unsupported pseudo: "+e);return r[x]?r(t):r.length>1?(n=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?ot(function(e,n){var i,o=r(e,t),a=o.length;while(a--)i=M.call(e,o[a]),e[i]=!(n[i]=o[a])}):function(e){return r(e,0,n)}):r}},pseudos:{not:ot(function(e){var t=[],n=[],r=s(e.replace(W,"$1"));return r[x]?ot(function(e,t,n,i){var o,a=r(e,null,i,[]),s=e.length;while(s--)(o=a[s])&&(e[s]=!(t[s]=o))}):function(e,i,o){return t[0]=e,r(t,null,o,n),!n.pop()}}),has:ot(function(e){return function(t){return st(e,t).length>0}}),contains:ot(function(e){return function(t){return(t.textContent||t.innerText||o(t)).indexOf(e)>-1}}),lang:ot(function(e){return X.test(e||"")||st.error("unsupported lang: "+e),e=e.replace(et,tt).toLowerCase(),function(t){var n;do if(n=d?t.getAttribute("xml:lang")||t.getAttribute("lang"):t.lang)return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===f},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){if (!e.nodeName||typeof e.nodeName=='function') return false; var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!i.pseudos.empty(e)},header:function(e){return Q.test(e.nodeName)},input:function(e){return G.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:pt(function(){return[0]}),last:pt(function(e,t){return[t-1]}),eq:pt(function(e,t,n){return[0>n?n+t:n]}),even:pt(function(e,t){var n=0;for(;t>n;n+=2)e.push(n);return e}),odd:pt(function(e,t){var n=1;for(;t>n;n+=2)e.push(n);return e}),lt:pt(function(e,t,n){var r=0>n?n+t:n;for(;--r>=0;)e.push(r);return e}),gt:pt(function(e,t,n){var r=0>n?n+t:n;for(;t>++r;)e.push(r);return e})}};for(n in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})i.pseudos[n]=lt(n);for(n in{submit:!0,reset:!0})i.pseudos[n]=ct(n);function ft(e,t){var n,r,o,a,s,u,l,c=E[e+" "];if(c)return t?0:c.slice(0);s=e,u=[],l=i.preFilter;while(s){(!n||(r=$.exec(s)))&&(r&&(s=s.slice(r[0].length)||s),u.push(o=[])),n=!1,(r=I.exec(s))&&(n=r.shift(),o.push({value:n,type:r[0].replace(W," ")}),s=s.slice(n.length));for(a in i.filter)!(r=U[a].exec(s))||l[a]&&!(r=l[a](r))||(n=r.shift(),o.push({value:n,type:a,matches:r}),s=s.slice(n.length));if(!n)break}return t?s.length:s?st.error(e):E(e,u).slice(0)}function dt(e){var t=0,n=e.length,r="";for(;n>t;t++)r+=e[t].value;return r}function ht(e,t,n){var i=t.dir,o=n&&"parentNode"===i,a=C++;return t.first?function(t,n,r){while(t=t[i])if(1===t.nodeType||o)return e(t,n,r)}:function(t,n,s){var u,l,c,p=N+" "+a;if(s){while(t=t[i])if((1===t.nodeType||o)&&e(t,n,s))return!0}else while(t=t[i])if(1===t.nodeType||o)if(c=t[x]||(t[x]={}),(l=c[i])&&l[0]===p){if((u=l[1])===!0||u===r)return u===!0}else if(l=c[i]=[p],l[1]=e(t,n,s)||r,l[1]===!0)return!0}}function gt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function mt(e,t,n,r,i){var o,a=[],s=0,u=e.length,l=null!=t;for(;u>s;s++)(o=e[s])&&(!n||n(o,r,i))&&(a.push(o),l&&t.push(s));return a}function yt(e,t,n,r,i,o){return r&&!r[x]&&(r=yt(r)),i&&!i[x]&&(i=yt(i,o)),ot(function(o,a,s,u){var l,c,p,f=[],d=[],h=a.length,g=o||xt(t||"*",s.nodeType?[s]:s,[]),m=!e||!o&&t?g:mt(g,f,e,s,u),y=n?i||(o?e:h||r)?[]:a:m;if(n&&n(m,y,s,u),r){l=mt(y,d),r(l,[],s,u),c=l.length;while(c--)(p=l[c])&&(y[d[c]]=!(m[d[c]]=p))}if(o){if(i||e){if(i){l=[],c=y.length;while(c--)(p=y[c])&&l.push(m[c]=p);i(null,y=[],l,u)}c=y.length;while(c--)(p=y[c])&&(l=i?M.call(o,p):f[c])>-1&&(o[l]=!(a[l]=p))}}else y=mt(y===a?y.splice(h,y.length):y),i?i(null,a,y,u):H.apply(a,y)})}function vt(e){var t,n,r,o=e.length,a=i.relative[e[0].type],s=a||i.relative[" "],u=a?1:0,c=ht(function(e){return e===t},s,!0),p=ht(function(e){return M.call(t,e)>-1},s,!0),f=[function(e,n,r){return!a&&(r||n!==l)||((t=n).nodeType?c(e,n,r):p(e,n,r))}];for(;o>u;u++)if(n=i.relative[e[u].type])f=[ht(gt(f),n)];else{if(n=i.filter[e[u].type].apply(null,e[u].matches),n[x]){for(r=++u;o>r;r++)if(i.relative[e[r].type])break;return yt(u>1&&gt(f),u>1&&dt(e.slice(0,u-1)).replace(W,"$1"),n,r>u&&vt(e.slice(u,r)),o>r&&vt(e=e.slice(r)),o>r&&dt(e))}f.push(n)}return gt(f)}function bt(e,t){var n=0,o=t.length>0,a=e.length>0,s=function(s,u,c,f,d){var h,g,m,y=[],v=0,b="0",x=s&&[],w=null!=d,T=l,C=s||a&&i.find.TAG("*",d&&u.parentNode||u),k=N+=null==T?1:Math.random()||.1;for(w&&(l=u!==p&&u,r=n);null!=(h=C[b]);b++){if(a&&h){g=0;while(m=e[g++])if(m(h,u,c)){f.push(h);break}w&&(N=k,r=++n)}o&&((h=!m&&h)&&v--,s&&x.push(h))}if(v+=b,o&&b!==v){g=0;while(m=t[g++])m(x,y,u,c);if(s){if(v>0)while(b--)x[b]||y[b]||(y[b]=L.call(f));y=mt(y)}H.apply(f,y),w&&!s&&y.length>0&&v+t.length>1&&st.uniqueSort(f)}return w&&(N=k,l=T),x};return o?ot(s):s}s=st.compile=function(e,t){var n,r=[],i=[],o=S[e+" "];if(!o){t||(t=ft(e)),n=t.length;while(n--)o=vt(t[n]),o[x]?r.push(o):i.push(o);o=S(e,bt(i,r))}return o};function xt(e,t,n){var r=0,i=t.length;for(;i>r;r++)st(e,t[r],n);return n}function wt(e,t,n,r){var o,a,u,l,c,p=ft(e);if(!r&&1===p.length){if(a=p[0]=p[0].slice(0),a.length>2&&"ID"===(u=a[0]).type&&9===t.nodeType&&!d&&i.relative[a[1].type]){if(t=i.find.ID(u.matches[0].replace(et,tt),t)[0],!t)return n;e=e.slice(a.shift().value.length)}o=U.needsContext.test(e)?0:a.length;while(o--){if(u=a[o],i.relative[l=u.type])break;if((c=i.find[l])&&(r=c(u.matches[0].replace(et,tt),V.test(a[0].type)&&t.parentNode||t))){if(a.splice(o,1),e=r.length&&dt(a),!e)return H.apply(n,q.call(r,0)),n;break}}}return s(e,p)(r,t,d,n,V.test(e)),n}i.pseudos.nth=i.pseudos.eq;function Tt(){}i.filters=Tt.prototype=i.pseudos,i.setFilters=new Tt,c(),st.attr=b.attr,b.find=st,b.expr=st.selectors,b.expr[":"]=b.expr.pseudos,b.unique=st.uniqueSort,b.text=st.getText,b.isXMLDoc=st.isXML,b.contains=st.contains}(e);var at=/Until$/,st=/^(?:parents|prev(?:Until|All))/,ut=/^.[^:#\[\.,]*$/,lt=b.expr.match.needsContext,ct={children:!0,contents:!0,next:!0,prev:!0};b.fn.extend({find:function(e){var t,n,r,i=this.length;if("string"!=typeof e)return r=this,this.pushStack(b(e).filter(function(){for(t=0;i>t;t++)if(b.contains(r[t],this))return!0}));for(n=[],t=0;i>t;t++)b.find(e,this[t],n);return n=this.pushStack(i>1?b.unique(n):n),n.selector=(this.selector?this.selector+" ":"")+e,n},has:function(e){var t,n=b(e,this),r=n.length;return this.filter(function(){for(t=0;r>t;t++)if(b.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(ft(this,e,!1))},filter:function(e){return this.pushStack(ft(this,e,!0))},is:function(e){return!!e&&("string"==typeof e?lt.test(e)?b(e,this.context).index(this[0])>=0:b.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var n,r=0,i=this.length,o=[],a=lt.test(e)||"string"!=typeof e?b(e,t||this.context):0;for(;i>r;r++){n=this[r];while(n&&n.ownerDocument&&n!==t&&11!==n.nodeType){if(a?a.index(n)>-1:b.find.matchesSelector(n,e)){o.push(n);break}n=n.parentNode}}return this.pushStack(o.length>1?b.unique(o):o)},index:function(e){return e?"string"==typeof e?b.inArray(this[0],b(e)):b.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n="string"==typeof e?b(e,t):b.makeArray(e&&e.nodeType?[e]:e),r=b.merge(this.get(),n);return this.pushStack(b.unique(r))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),b.fn.andSelf=b.fn.addBack;function pt(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}b.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return b.dir(e,"parentNode")},parentsUntil:function(e,t,n){return b.dir(e,"parentNode",n)},next:function(e){return pt(e,"nextSibling")},prev:function(e){return pt(e,"previousSibling")},nextAll:function(e){return b.dir(e,"nextSibling")},prevAll:function(e){return b.dir(e,"previousSibling")},nextUntil:function(e,t,n){return b.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return b.dir(e,"previousSibling",n)},siblings:function(e){return b.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return b.sibling(e.firstChild)},contents:function(e){return b.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:b.merge([],e.childNodes)}},function(e,t){b.fn[e]=function(n,r){var i=b.map(this,t,n);return at.test(e)||(r=n),r&&"string"==typeof r&&(i=b.filter(r,i)),i=this.length>1&&!ct[e]?b.unique(i):i,this.length>1&&st.test(e)&&(i=i.reverse()),this.pushStack(i)}}),b.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),1===t.length?b.find.matchesSelector(t[0],e)?[t[0]]:[]:b.find.matches(e,t)},dir:function(e,n,r){var i=[],o=e[n];while(o&&9!==o.nodeType&&(r===t||1!==o.nodeType||!b(o).is(r)))1===o.nodeType&&i.push(o),o=o[n];return i},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}});function ft(e,t,n){if(t=t||0,b.isFunction(t))return b.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n});if(t.nodeType)return b.grep(e,function(e){return e===t===n});if("string"==typeof t){var r=b.grep(e,function(e){return 1===e.nodeType});if(ut.test(t))return b.filter(t,r,!n);t=b.filter(t,r)}return b.grep(e,function(e){return b.inArray(e,t)>=0===n})}function dt(e){var t=ht.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}var ht="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",gt=/ jQuery\d+="(?:null|\d+)"/g,mt=RegExp("<(?:"+ht+")[\\s/>]","i"),yt=/^\s+/,vt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bt=/<([\w:]+)/,xt=/<tbody/i,wt=/<|&#?\w+;/,Tt=/<(?:script|style|link)/i,Nt=/^(?:checkbox|radio)$/i,Ct=/checked\s*(?:[^=]|=\s*.checked.)/i,kt=/^$|\/(?:java|ecma)script/i,Et=/^true\/(.*)/,St=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,At={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:b.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},jt=dt(o),Dt=jt.appendChild(o.createElement("div"));At.optgroup=At.option,At.tbody=At.tfoot=At.colgroup=At.caption=At.thead,At.th=At.td,b.fn.extend({text:function(e){return b.access(this,function(e){return e===t?b.text(this):this.empty().append((this[0]&&this[0].ownerDocument||o).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(b.isFunction(e))return this.each(function(t){b(this).wrapAll(e.call(this,t))});if(this[0]){var t=b(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&1===e.firstChild.nodeType)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return b.isFunction(e)?this.each(function(t){b(this).wrapInner(e.call(this,t))}):this.each(function(){var t=b(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=b.isFunction(e);return this.each(function(n){b(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){b.nodeName(this,"body")||b(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.insertBefore(e,this.firstChild)})},before:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){var n,r=0;for(;null!=(n=this[r]);r++)(!e||b.filter(e,[n]).length>0)&&(t||1!==n.nodeType||b.cleanData(Ot(n)),n.parentNode&&(t&&b.contains(n.ownerDocument,n)&&Mt(Ot(n,"script")),n.parentNode.removeChild(n)));return this},empty:function(){var e,t=0;for(;null!=(e=this[t]);t++){1===e.nodeType&&b.cleanData(Ot(e,!1));while(e.firstChild)e.removeChild(e.firstChild);e.options&&b.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return b.clone(this,e,t)})},html:function(e){return b.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return 1===n.nodeType?n.innerHTML.replace(gt,""):t;if(!("string"!=typeof e||Tt.test(e)||!b.support.htmlSerialize&&mt.test(e)||!b.support.leadingWhitespace&&yt.test(e)||At[(bt.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(vt,"<$1></$2>");try{for(;i>r;r++)n=this[r]||{},1===n.nodeType&&(b.cleanData(Ot(n,!1)),n.innerHTML=e);n=0}catch(o){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){var t=b.isFunction(e);return t||"string"==typeof e||(e=b(e).not(this).detach()),this.domManip([e],!0,function(e){var t=this.nextSibling,n=this.parentNode;n&&(b(this).remove(),n.insertBefore(e,t))})},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){e=f.apply([],e);var i,o,a,s,u,l,c=0,p=this.length,d=this,h=p-1,g=e[0],m=b.isFunction(g);if(m||!(1>=p||"string"!=typeof g||b.support.checkClone)&&Ct.test(g))return this.each(function(i){var o=d.eq(i);m&&(e[0]=g.call(this,i,n?o.html():t)),o.domManip(e,n,r)});if(p&&(l=b.buildFragment(e,this[0].ownerDocument,!1,this),i=l.firstChild,1===l.childNodes.length&&(l=i),i)){for(n=n&&b.nodeName(i,"tr"),s=b.map(Ot(l,"script"),Ht),a=s.length;p>c;c++)o=l,c!==h&&(o=b.clone(o,!0,!0),a&&b.merge(s,Ot(o,"script"))),r.call(n&&b.nodeName(this[c],"table")?Lt(this[c],"tbody"):this[c],o,c);if(a)for(u=s[s.length-1].ownerDocument,b.map(s,qt),c=0;a>c;c++)o=s[c],kt.test(o.type||"")&&!b._data(o,"globalEval")&&b.contains(u,o)&&(o.src?b.ajax({url:o.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):b.globalEval((o.text||o.textContent||o.innerHTML||"").replace(St,"")));l=i=null}return this}});function Lt(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function Ht(e){var t=e.getAttributeNode("type");return e.type=(t&&t.specified)+"/"+e.type,e}function qt(e){var t=Et.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function Mt(e,t){var n,r=0;for(;null!=(n=e[r]);r++)b._data(n,"globalEval",!t||b._data(t[r],"globalEval"))}function _t(e,t){if(1===t.nodeType&&b.hasData(e)){var n,r,i,o=b._data(e),a=b._data(t,o),s=o.events;if(s){delete a.handle,a.events={};for(n in s)for(r=0,i=s[n].length;i>r;r++)b.event.add(t,n,s[n][r])}a.data&&(a.data=b.extend({},a.data))}}function Ft(e,t){var n,r,i;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!b.support.noCloneEvent&&t[b.expando]){i=b._data(t);for(r in i.events)b.removeEvent(t,r,i.handle);t.removeAttribute(b.expando)}"script"===n&&t.text!==e.text?(Ht(t).text=e.text,qt(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),b.support.html5Clone&&e.innerHTML&&!b.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&Nt.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}b.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){b.fn[e]=function(e){var n,r=0,i=[],o=b(e),a=o.length-1;for(;a>=r;r++)n=r===a?this:this.clone(!0),b(o[r])[t](n),d.apply(i,n.get());return this.pushStack(i)}});function Ot(e,n){var r,o,a=0,s=typeof e.getElementsByTagName!==i?e.getElementsByTagName(n||"*"):typeof e.querySelectorAll!==i?e.querySelectorAll(n||"*"):t;if(!s)for(s=[],r=e.childNodes||e;null!=(o=r[a]);a++)!n||b.nodeName(o,n)?s.push(o):b.merge(s,Ot(o,n));return n===t||n&&b.nodeName(e,n)?b.merge([e],s):s}function Bt(e){Nt.test(e.type)&&(e.defaultChecked=e.checked)}b.extend({clone:function(e,t,n){var r,i,o,a,s,u=b.contains(e.ownerDocument,e);if(b.support.html5Clone||b.isXMLDoc(e)||!mt.test("<"+e.nodeName+">")?o=e.cloneNode(!0):(Dt.innerHTML=e.outerHTML,Dt.removeChild(o=Dt.firstChild)),!(b.support.noCloneEvent&&b.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||b.isXMLDoc(e)))for(r=Ot(o),s=Ot(e),a=0;null!=(i=s[a]);++a)r[a]&&Ft(i,r[a]);if(t)if(n)for(s=s||Ot(e),r=r||Ot(o),a=0;null!=(i=s[a]);a++)_t(i,r[a]);else _t(e,o);return r=Ot(o,"script"),r.length>0&&Mt(r,!u&&Ot(e,"script")),r=s=i=null,o},buildFragment:function(e,t,n,r){var i,o,a,s,u,l,c,p=e.length,f=dt(t),d=[],h=0;for(;p>h;h++)if(o=e[h],o||0===o)if("object"===b.type(o))b.merge(d,o.nodeType?[o]:o);else if(wt.test(o)){s=s||f.appendChild(t.createElement("div")),u=(bt.exec(o)||["",""])[1].toLowerCase(),c=At[u]||At._default,s.innerHTML=c[1]+o.replace(vt,"<$1></$2>")+c[2],i=c[0];while(i--)s=s.lastChild;if(!b.support.leadingWhitespace&&yt.test(o)&&d.push(t.createTextNode(yt.exec(o)[0])),!b.support.tbody){o="table"!==u||xt.test(o)?"<table>"!==c[1]||xt.test(o)?0:s:s.firstChild,i=o&&o.childNodes.length;while(i--)b.nodeName(l=o.childNodes[i],"tbody")&&!l.childNodes.length&&o.removeChild(l)
}b.merge(d,s.childNodes),s.textContent="";while(s.firstChild)s.removeChild(s.firstChild);s=f.lastChild}else d.push(t.createTextNode(o));s&&f.removeChild(s),b.support.appendChecked||b.grep(Ot(d,"input"),Bt),h=0;while(o=d[h++])if((!r||-1===b.inArray(o,r))&&(a=b.contains(o.ownerDocument,o),s=Ot(f.appendChild(o),"script"),a&&Mt(s),n)){i=0;while(o=s[i++])kt.test(o.type||"")&&n.push(o)}return s=null,f},cleanData:function(e,t){var n,r,o,a,s=0,u=b.expando,l=b.cache,p=b.support.deleteExpando,f=b.event.special;for(;null!=(n=e[s]);s++)if((t||b.acceptData(n))&&(o=n[u],a=o&&l[o])){if(a.events)for(r in a.events)f[r]?b.event.remove(n,r):b.removeEvent(n,r,a.handle);l[o]&&(delete l[o],p?delete n[u]:typeof n.removeAttribute!==i?n.removeAttribute(u):n[u]=null,c.push(o))}}});var Pt,Rt,Wt,$t=/alpha\([^)]*\)/i,It=/opacity\s*=\s*([^)]*)/,zt=/^(top|right|bottom|left)$/,Xt=/^(none|table(?!-c[ea]).+)/,Ut=/^margin/,Vt=RegExp("^("+x+")(.*)$","i"),Yt=RegExp("^("+x+")(?!px)[a-z%]+$","i"),Jt=RegExp("^([+-])=("+x+")","i"),Gt={BODY:"block"},Qt={position:"absolute",visibility:"hidden",display:"block"},Kt={letterSpacing:0,fontWeight:400},Zt=["Top","Right","Bottom","Left"],en=["Webkit","O","Moz","ms"];function tn(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=en.length;while(i--)if(t=en[i]+n,t in e)return t;return r}function nn(e,t){return e=t||e,"none"===b.css(e,"display")||!b.contains(e.ownerDocument,e)}function rn(e,t){var n,r,i,o=[],a=0,s=e.length;for(;s>a;a++)r=e[a],r.style&&(o[a]=b._data(r,"olddisplay"),n=r.style.display,t?(o[a]||"none"!==n||(r.style.display=""),""===r.style.display&&nn(r)&&(o[a]=b._data(r,"olddisplay",un(r.nodeName)))):o[a]||(i=nn(r),(n&&"none"!==n||!i)&&b._data(r,"olddisplay",i?n:b.css(r,"display"))));for(a=0;s>a;a++)r=e[a],r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?o[a]||"":"none"));return e}b.fn.extend({css:function(e,n){return b.access(this,function(e,n,r){var i,o,a={},s=0;if(b.isArray(n)){for(o=Rt(e),i=n.length;i>s;s++)a[n[s]]=b.css(e,n[s],!1,o);return a}return r!==t?b.style(e,n,r):b.css(e,n)},e,n,arguments.length>1)},show:function(){return rn(this,!0)},hide:function(){return rn(this)},toggle:function(e){var t="boolean"==typeof e;return this.each(function(){(t?e:nn(this))?b(this).show():b(this).hide()})}}),b.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Wt(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":b.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var o,a,s,u=b.camelCase(n),l=e.style;if(n=b.cssProps[u]||(b.cssProps[u]=tn(l,u)),s=b.cssHooks[n]||b.cssHooks[u],r===t)return s&&"get"in s&&(o=s.get(e,!1,i))!==t?o:l[n];if(a=typeof r,"string"===a&&(o=Jt.exec(r))&&(r=(o[1]+1)*o[2]+parseFloat(b.css(e,n)),a="number"),!(null==r||"number"===a&&isNaN(r)||("number"!==a||b.cssNumber[u]||(r+="px"),b.support.clearCloneStyle||""!==r||0!==n.indexOf("background")||(l[n]="inherit"),s&&"set"in s&&(r=s.set(e,r,i))===t)))try{l[n]=r}catch(c){}}},css:function(e,n,r,i){var o,a,s,u=b.camelCase(n);return n=b.cssProps[u]||(b.cssProps[u]=tn(e.style,u)),s=b.cssHooks[n]||b.cssHooks[u],s&&"get"in s&&(a=s.get(e,!0,r)),a===t&&(a=Wt(e,n,i)),"normal"===a&&n in Kt&&(a=Kt[n]),""===r||r?(o=parseFloat(a),r===!0||b.isNumeric(o)?o||0:a):a},swap:function(e,t,n,r){var i,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];i=n.apply(e,r||[]);for(o in t)e.style[o]=a[o];return i}}),e.getComputedStyle?(Rt=function(t){return e.getComputedStyle(t,null)},Wt=function(e,n,r){var i,o,a,s=r||Rt(e),u=s?s.getPropertyValue(n)||s[n]:t,l=e.style;return s&&(""!==u||b.contains(e.ownerDocument,e)||(u=b.style(e,n)),Yt.test(u)&&Ut.test(n)&&(i=l.width,o=l.minWidth,a=l.maxWidth,l.minWidth=l.maxWidth=l.width=u,u=s.width,l.width=i,l.minWidth=o,l.maxWidth=a)),u}):o.documentElement.currentStyle&&(Rt=function(e){return e.currentStyle},Wt=function(e,n,r){var i,o,a,s=r||Rt(e),u=s?s[n]:t,l=e.style;return null==u&&l&&l[n]&&(u=l[n]),Yt.test(u)&&!zt.test(n)&&(i=l.left,o=e.runtimeStyle,a=o&&o.left,a&&(o.left=e.currentStyle.left),l.left="fontSize"===n?"1em":u,u=l.pixelLeft+"px",l.left=i,a&&(o.left=a)),""===u?"auto":u});function on(e,t,n){var r=Vt.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function an(e,t,n,r,i){var o=n===(r?"border":"content")?4:"width"===t?1:0,a=0;for(;4>o;o+=2)"margin"===n&&(a+=b.css(e,n+Zt[o],!0,i)),r?("content"===n&&(a-=b.css(e,"padding"+Zt[o],!0,i)),"margin"!==n&&(a-=b.css(e,"border"+Zt[o]+"Width",!0,i))):(a+=b.css(e,"padding"+Zt[o],!0,i),"padding"!==n&&(a+=b.css(e,"border"+Zt[o]+"Width",!0,i)));return a}function sn(e,t,n){var r=!0,i="width"===t?e.offsetWidth:e.offsetHeight,o=Rt(e),a=b.support.boxSizing&&"border-box"===b.css(e,"boxSizing",!1,o);if(0>=i||null==i){if(i=Wt(e,t,o),(0>i||null==i)&&(i=e.style[t]),Yt.test(i))return i;r=a&&(b.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+an(e,t,n||(a?"border":"content"),r,o)+"px"}function un(e){var t=o,n=Gt[e];return n||(n=ln(e,t),"none"!==n&&n||(Pt=(Pt||b("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(Pt[0].contentWindow||Pt[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=ln(e,t),Pt.detach()),Gt[e]=n),n}function ln(e,t){var n=b(t.createElement(e)).appendTo(t.body),r=b.css(n[0],"display");return n.remove(),r}b.each(["height","width"],function(e,n){b.cssHooks[n]={get:function(e,r,i){return r?0===e.offsetWidth&&Xt.test(b.css(e,"display"))?b.swap(e,Qt,function(){return sn(e,n,i)}):sn(e,n,i):t},set:function(e,t,r){var i=r&&Rt(e);return on(e,t,r?an(e,n,r,b.support.boxSizing&&"border-box"===b.css(e,"boxSizing",!1,i),i):0)}}}),b.support.opacity||(b.cssHooks.opacity={get:function(e,t){return It.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=b.isNumeric(t)?"alpha(opacity="+100*t+")":"",o=r&&r.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===b.trim(o.replace($t,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||r&&!r.filter)||(n.filter=$t.test(o)?o.replace($t,i):o+" "+i)}}),b(function(){b.support.reliableMarginRight||(b.cssHooks.marginRight={get:function(e,n){return n?b.swap(e,{display:"inline-block"},Wt,[e,"marginRight"]):t}}),!b.support.pixelPosition&&b.fn.position&&b.each(["top","left"],function(e,n){b.cssHooks[n]={get:function(e,r){return r?(r=Wt(e,n),Yt.test(r)?b(e).position()[n]+"px":r):t}}})}),b.expr&&b.expr.filters&&(b.expr.filters.hidden=function(e){return 0>=e.offsetWidth&&0>=e.offsetHeight||!b.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||b.css(e,"display"))},b.expr.filters.visible=function(e){return!b.expr.filters.hidden(e)}),b.each({margin:"",padding:"",border:"Width"},function(e,t){b.cssHooks[e+t]={expand:function(n){var r=0,i={},o="string"==typeof n?n.split(" "):[n];for(;4>r;r++)i[e+Zt[r]+t]=o[r]||o[r-2]||o[0];return i}},Ut.test(e)||(b.cssHooks[e+t].set=on)});var cn=/%20/g,pn=/\[\]$/,fn=/\r?\n/g,dn=/^(?:submit|button|image|reset|file)$/i,hn=/^(?:input|select|textarea|keygen)/i;b.fn.extend({serialize:function(){return b.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=b.prop(this,"elements");return e?b.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!b(this).is(":disabled")&&hn.test(this.nodeName)&&!dn.test(e)&&(this.checked||!Nt.test(e))}).map(function(e,t){var n=b(this).val();return null==n?null:b.isArray(n)?b.map(n,function(e){return{name:t.name,value:e.replace(fn,"\r\n")}}):{name:t.name,value:n.replace(fn,"\r\n")}}).get()}}),b.param=function(e,n){var r,i=[],o=function(e,t){t=b.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(n===t&&(n=b.ajaxSettings&&b.ajaxSettings.traditional),b.isArray(e)||e.jquery&&!b.isPlainObject(e))b.each(e,function(){o(this.name,this.value)});else for(r in e)gn(r,e[r],n,o);return i.join("&").replace(cn,"+")};function gn(e,t,n,r){var i;if(b.isArray(t))b.each(t,function(t,i){n||pn.test(e)?r(e,i):gn(e+"["+("object"==typeof i?t:"")+"]",i,n,r)});else if(n||"object"!==b.type(t))r(e,t);else for(i in t)gn(e+"["+i+"]",t[i],n,r)}b.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){b.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),b.fn.hover=function(e,t){return this.mouseenter(e).mouseleave(t||e)};var mn,yn,vn=b.now(),bn=/\?/,xn=/#.*$/,wn=/([?&])_=[^&]*/,Tn=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Nn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Cn=/^(?:GET|HEAD)$/,kn=/^\/\//,En=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Sn=b.fn.load,An={},jn={},Dn="*/".concat("*");try{yn=a.href}catch(Ln){yn=o.createElement("a"),yn.href="",yn=yn.href}mn=En.exec(yn.toLowerCase())||[];function Hn(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,o=t.toLowerCase().match(w)||[];if(b.isFunction(n))while(r=o[i++])"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function qn(e,n,r,i){var o={},a=e===jn;function s(u){var l;return o[u]=!0,b.each(e[u]||[],function(e,u){var c=u(n,r,i);return"string"!=typeof c||a||o[c]?a?!(l=c):t:(n.dataTypes.unshift(c),s(c),!1)}),l}return s(n.dataTypes[0])||!o["*"]&&s("*")}function Mn(e,n){var r,i,o=b.ajaxSettings.flatOptions||{};for(i in n)n[i]!==t&&((o[i]?e:r||(r={}))[i]=n[i]);return r&&b.extend(!0,e,r),e}b.fn.load=function(e,n,r){if("string"!=typeof e&&Sn)return Sn.apply(this,arguments);var i,o,a,s=this,u=e.indexOf(" ");return u>=0&&(i=e.slice(u,e.length),e=e.slice(0,u)),b.isFunction(n)?(r=n,n=t):n&&"object"==typeof n&&(a="POST"),s.length>0&&b.ajax({url:e,type:a,dataType:"html",data:n}).done(function(e){o=arguments,s.html(i?b("<div>").append(b.parseHTML(e)).find(i):e)}).complete(r&&function(e,t){s.each(r,o||[e.responseText,t,e])}),this},b.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){b.fn[t]=function(e){return this.on(t,e)}}),b.each(["get","post"],function(e,n){b[n]=function(e,r,i,o){return b.isFunction(r)&&(o=o||i,i=r,r=t),b.ajax({url:e,type:n,dataType:o,data:r,success:i})}}),b.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:yn,type:"GET",isLocal:Nn.test(mn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Dn,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":b.parseJSON,"text xml":b.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Mn(Mn(e,b.ajaxSettings),t):Mn(b.ajaxSettings,e)},ajaxPrefilter:Hn(An),ajaxTransport:Hn(jn),ajax:function(e,n){"object"==typeof e&&(n=e,e=t),n=n||{};var r,i,o,a,s,u,l,c,p=b.ajaxSetup({},n),f=p.context||p,d=p.context&&(f.nodeType||f.jquery)?b(f):b.event,h=b.Deferred(),g=b.Callbacks("once memory"),m=p.statusCode||{},y={},v={},x=0,T="canceled",N={readyState:0,getResponseHeader:function(e){var t;if(2===x){if(!c){c={};while(t=Tn.exec(a))c[t[1].toLowerCase()]=t[2]}t=c[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===x?a:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return x||(e=v[n]=v[n]||e,y[e]=t),this},overrideMimeType:function(e){return x||(p.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>x)for(t in e)m[t]=[m[t],e[t]];else N.always(e[N.status]);return this},abort:function(e){var t=e||T;return l&&l.abort(t),k(0,t),this}};if(h.promise(N).complete=g.add,N.success=N.done,N.error=N.fail,p.url=((e||p.url||yn)+"").replace(xn,"").replace(kn,mn[1]+"//"),p.type=n.method||n.type||p.method||p.type,p.dataTypes=b.trim(p.dataType||"*").toLowerCase().match(w)||[""],null==p.crossDomain&&(r=En.exec(p.url.toLowerCase()),p.crossDomain=!(!r||r[1]===mn[1]&&r[2]===mn[2]&&(r[3]||("http:"===r[1]?80:443))==(mn[3]||("http:"===mn[1]?80:443)))),p.data&&p.processData&&"string"!=typeof p.data&&(p.data=b.param(p.data,p.traditional)),qn(An,p,n,N),2===x)return N;u=p.global,u&&0===b.active++&&b.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!Cn.test(p.type),o=p.url,p.hasContent||(p.data&&(o=p.url+=(bn.test(o)?"&":"?")+p.data,delete p.data),p.cache===!1&&(p.url=wn.test(o)?o.replace(wn,"$1_="+vn++):o+(bn.test(o)?"&":"?")+"_="+vn++)),p.ifModified&&(b.lastModified[o]&&N.setRequestHeader("If-Modified-Since",b.lastModified[o]),b.etag[o]&&N.setRequestHeader("If-None-Match",b.etag[o])),(p.data&&p.hasContent&&p.contentType!==!1||n.contentType)&&N.setRequestHeader("Content-Type",p.contentType),N.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Dn+"; q=0.01":""):p.accepts["*"]);for(i in p.headers)N.setRequestHeader(i,p.headers[i]);if(p.beforeSend&&(p.beforeSend.call(f,N,p)===!1||2===x))return N.abort();T="abort";for(i in{success:1,error:1,complete:1})N[i](p[i]);if(l=qn(jn,p,n,N)){N.readyState=1,u&&d.trigger("ajaxSend",[N,p]),p.async&&p.timeout>0&&(s=setTimeout(function(){N.abort("timeout")},p.timeout));try{x=1,l.send(y,k)}catch(C){if(!(2>x))throw C;k(-1,C)}}else k(-1,"No Transport");function k(e,n,r,i){var c,y,v,w,T,C=n;2!==x&&(x=2,s&&clearTimeout(s),l=t,a=i||"",N.readyState=e>0?4:0,r&&(w=_n(p,N,r)),e>=200&&300>e||304===e?(p.ifModified&&(T=N.getResponseHeader("Last-Modified"),T&&(b.lastModified[o]=T),T=N.getResponseHeader("etag"),T&&(b.etag[o]=T)),204===e?(c=!0,C="nocontent"):304===e?(c=!0,C="notmodified"):(c=Fn(p,w),C=c.state,y=c.data,v=c.error,c=!v)):(v=C,(e||!C)&&(C="error",0>e&&(e=0))),N.status=e,N.statusText=(n||C)+"",c?h.resolveWith(f,[y,C,N]):h.rejectWith(f,[N,C,v]),N.statusCode(m),m=t,u&&d.trigger(c?"ajaxSuccess":"ajaxError",[N,p,c?y:v]),g.fireWith(f,[N,C]),u&&(d.trigger("ajaxComplete",[N,p]),--b.active||b.event.trigger("ajaxStop")))}return N},getScript:function(e,n){return b.get(e,t,n,"script")},getJSON:function(e,t,n){return b.get(e,t,n,"json")}});function _n(e,n,r){var i,o,a,s,u=e.contents,l=e.dataTypes,c=e.responseFields;for(s in c)s in r&&(n[c[s]]=r[s]);while("*"===l[0])l.shift(),o===t&&(o=e.mimeType||n.getResponseHeader("Content-Type"));if(o)for(s in u)if(u[s]&&u[s].test(o)){l.unshift(s);break}if(l[0]in r)a=l[0];else{for(s in r){if(!l[0]||e.converters[s+" "+l[0]]){a=s;break}i||(i=s)}a=a||i}return a?(a!==l[0]&&l.unshift(a),r[a]):t}function Fn(e,t){var n,r,i,o,a={},s=0,u=e.dataTypes.slice(),l=u[0];if(e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u[1])for(i in e.converters)a[i.toLowerCase()]=e.converters[i];for(;r=u[++s];)if("*"!==r){if("*"!==l&&l!==r){if(i=a[l+" "+r]||a["* "+r],!i)for(n in a)if(o=n.split(" "),o[1]===r&&(i=a[l+" "+o[0]]||a["* "+o[0]])){i===!0?i=a[n]:a[n]!==!0&&(r=o[0],u.splice(s--,0,r));break}if(i!==!0)if(i&&e["throws"])t=i(t);else try{t=i(t)}catch(c){return{state:"parsererror",error:i?c:"No conversion from "+l+" to "+r}}}l=r}return{state:"success",data:t}}b.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return b.globalEval(e),e}}}),b.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),b.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=o.head||b("head")[0]||o.documentElement;return{send:function(t,i){n=o.createElement("script"),n.async=!0,e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,t){(t||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),n=null,t||i(200,"success"))},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(t,!0)}}}});var On=[],Bn=/(=)\?(?=&|$)|\?\?/;b.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=On.pop()||b.expando+"_"+vn++;return this[e]=!0,e}}),b.ajaxPrefilter("json jsonp",function(n,r,i){var o,a,s,u=n.jsonp!==!1&&(Bn.test(n.url)?"url":"string"==typeof n.data&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Bn.test(n.data)&&"data");return u||"jsonp"===n.dataTypes[0]?(o=n.jsonpCallback=b.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,u?n[u]=n[u].replace(Bn,"$1"+o):n.jsonp!==!1&&(n.url+=(bn.test(n.url)?"&":"?")+n.jsonp+"="+o),n.converters["script json"]=function(){return s||b.error(o+" was not called"),s[0]},n.dataTypes[0]="json",a=e[o],e[o]=function(){s=arguments},i.always(function(){e[o]=a,n[o]&&(n.jsonpCallback=r.jsonpCallback,On.push(o)),s&&b.isFunction(a)&&a(s[0]),s=a=t}),"script"):t});var Pn,Rn,Wn=0,$n=e.ActiveXObject&&function(){var e;for(e in Pn)Pn[e](t,!0)};function In(){try{return new e.XMLHttpRequest}catch(t){}}function zn(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}b.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&In()||zn()}:In,Rn=b.ajaxSettings.xhr(),b.support.cors=!!Rn&&"withCredentials"in Rn,Rn=b.support.ajax=!!Rn,Rn&&b.ajaxTransport(function(n){if(!n.crossDomain||b.support.cors){var r;return{send:function(i,o){var a,s,u=n.xhr();if(n.username?u.open(n.type,n.url,n.async,n.username,n.password):u.open(n.type,n.url,n.async),n.xhrFields)for(s in n.xhrFields)u[s]=n.xhrFields[s];n.mimeType&&u.overrideMimeType&&u.overrideMimeType(n.mimeType),n.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");try{for(s in i)u.setRequestHeader(s,i[s])}catch(l){}u.send(n.hasContent&&n.data||null),r=function(e,i){var s,l,c,p;try{if(r&&(i||4===u.readyState))if(r=t,a&&(u.onreadystatechange=b.noop,$n&&delete Pn[a]),i)4!==u.readyState&&u.abort();else{p={},s=u.status,l=u.getAllResponseHeaders(),"string"==typeof u.responseText&&(p.text=u.responseText);try{c=u.statusText}catch(f){c=""}s||!n.isLocal||n.crossDomain?1223===s&&(s=204):s=p.text?200:404}}catch(d){i||o(-1,d)}p&&o(s,c,p,l)},n.async?4===u.readyState?setTimeout(r):(a=++Wn,$n&&(Pn||(Pn={},b(e).unload($n)),Pn[a]=r),u.onreadystatechange=r):r()},abort:function(){r&&r(t,!0)}}}});var Xn,Un,Vn=/^(?:toggle|show|hide)$/,Yn=RegExp("^(?:([+-])=|)("+x+")([a-z%]*)$","i"),Jn=/queueHooks$/,Gn=[nr],Qn={"*":[function(e,t){var n,r,i=this.createTween(e,t),o=Yn.exec(t),a=i.cur(),s=+a||0,u=1,l=20;if(o){if(n=+o[2],r=o[3]||(b.cssNumber[e]?"":"px"),"px"!==r&&s){s=b.css(i.elem,e,!0)||n||1;do u=u||".5",s/=u,b.style(i.elem,e,s+r);while(u!==(u=i.cur()/a)&&1!==u&&--l)}i.unit=r,i.start=s,i.end=o[1]?s+(o[1]+1)*n:n}return i}]};function Kn(){return setTimeout(function(){Xn=t}),Xn=b.now()}function Zn(e,t){b.each(t,function(t,n){var r=(Qn[t]||[]).concat(Qn["*"]),i=0,o=r.length;for(;o>i;i++)if(r[i].call(e,t,n))return})}function er(e,t,n){var r,i,o=0,a=Gn.length,s=b.Deferred().always(function(){delete u.elem}),u=function(){if(i)return!1;var t=Xn||Kn(),n=Math.max(0,l.startTime+l.duration-t),r=n/l.duration||0,o=1-r,a=0,u=l.tweens.length;for(;u>a;a++)l.tweens[a].run(o);return s.notifyWith(e,[l,o,n]),1>o&&u?n:(s.resolveWith(e,[l]),!1)},l=s.promise({elem:e,props:b.extend({},t),opts:b.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Xn||Kn(),duration:n.duration,tweens:[],createTween:function(t,n){var r=b.Tween(e,l.opts,t,n,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(r),r},stop:function(t){var n=0,r=t?l.tweens.length:0;if(i)return this;for(i=!0;r>n;n++)l.tweens[n].run(1);return t?s.resolveWith(e,[l,t]):s.rejectWith(e,[l,t]),this}}),c=l.props;for(tr(c,l.opts.specialEasing);a>o;o++)if(r=Gn[o].call(l,e,c,l.opts))return r;return Zn(l,c),b.isFunction(l.opts.start)&&l.opts.start.call(e,l),b.fx.timer(b.extend(u,{elem:e,anim:l,queue:l.opts.queue})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}function tr(e,t){var n,r,i,o,a;for(i in e)if(r=b.camelCase(i),o=t[r],n=e[i],b.isArray(n)&&(o=n[1],n=e[i]=n[0]),i!==r&&(e[r]=n,delete e[i]),a=b.cssHooks[r],a&&"expand"in a){n=a.expand(n),delete e[r];for(i in n)i in e||(e[i]=n[i],t[i]=o)}else t[r]=o}b.Animation=b.extend(er,{tweener:function(e,t){b.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;i>r;r++)n=e[r],Qn[n]=Qn[n]||[],Qn[n].unshift(t)},prefilter:function(e,t){t?Gn.unshift(e):Gn.push(e)}});function nr(e,t,n){var r,i,o,a,s,u,l,c,p,f=this,d=e.style,h={},g=[],m=e.nodeType&&nn(e);n.queue||(c=b._queueHooks(e,"fx"),null==c.unqueued&&(c.unqueued=0,p=c.empty.fire,c.empty.fire=function(){c.unqueued||p()}),c.unqueued++,f.always(function(){f.always(function(){c.unqueued--,b.queue(e,"fx").length||c.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[d.overflow,d.overflowX,d.overflowY],"inline"===b.css(e,"display")&&"none"===b.css(e,"float")&&(b.support.inlineBlockNeedsLayout&&"inline"!==un(e.nodeName)?d.zoom=1:d.display="inline-block")),n.overflow&&(d.overflow="hidden",b.support.shrinkWrapBlocks||f.always(function(){d.overflow=n.overflow[0],d.overflowX=n.overflow[1],d.overflowY=n.overflow[2]}));for(i in t)if(a=t[i],Vn.exec(a)){if(delete t[i],u=u||"toggle"===a,a===(m?"hide":"show"))continue;g.push(i)}if(o=g.length){s=b._data(e,"fxshow")||b._data(e,"fxshow",{}),"hidden"in s&&(m=s.hidden),u&&(s.hidden=!m),m?b(e).show():f.done(function(){b(e).hide()}),f.done(function(){var t;b._removeData(e,"fxshow");for(t in h)b.style(e,t,h[t])});for(i=0;o>i;i++)r=g[i],l=f.createTween(r,m?s[r]:0),h[r]=s[r]||b.style(e,r),r in s||(s[r]=l.start,m&&(l.end=l.start,l.start="width"===r||"height"===r?1:0))}}function rr(e,t,n,r,i){return new rr.prototype.init(e,t,n,r,i)}b.Tween=rr,rr.prototype={constructor:rr,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(b.cssNumber[n]?"":"px")},cur:function(){var e=rr.propHooks[this.prop];return e&&e.get?e.get(this):rr.propHooks._default.get(this)},run:function(e){var t,n=rr.propHooks[this.prop];return this.pos=t=this.options.duration?b.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):rr.propHooks._default.set(this),this}},rr.prototype.init.prototype=rr.prototype,rr.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=b.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){b.fx.step[e.prop]?b.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[b.cssProps[e.prop]]||b.cssHooks[e.prop])?b.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},rr.propHooks.scrollTop=rr.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},b.each(["toggle","show","hide"],function(e,t){var n=b.fn[t];b.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(ir(t,!0),e,r,i)}}),b.fn.extend({fadeTo:function(e,t,n,r){return this.filter(nn).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=b.isEmptyObject(e),o=b.speed(t,n,r),a=function(){var t=er(this,b.extend({},e),o);a.finish=function(){t.stop(!0)},(i||b._data(this,"finish"))&&t.stop(!0)};return a.finish=a,i||o.queue===!1?this.each(a):this.queue(o.queue,a)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return"string"!=typeof e&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",o=b.timers,a=b._data(this);if(n)a[n]&&a[n].stop&&i(a[n]);else for(n in a)a[n]&&a[n].stop&&Jn.test(n)&&i(a[n]);for(n=o.length;n--;)o[n].elem!==this||null!=e&&o[n].queue!==e||(o[n].anim.stop(r),t=!1,o.splice(n,1));(t||!r)&&b.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=b._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],o=b.timers,a=r?r.length:0;for(n.finish=!0,b.queue(this,e,[]),i&&i.cur&&i.cur.finish&&i.cur.finish.call(this),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;a>t;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}});function ir(e,t){var n,r={height:e},i=0;for(t=t?1:0;4>i;i+=2-t)n=Zt[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}b.each({slideDown:ir("show"),slideUp:ir("hide"),slideToggle:ir("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){b.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),b.speed=function(e,t,n){var r=e&&"object"==typeof e?b.extend({},e):{complete:n||!n&&t||b.isFunction(e)&&e,duration:e,easing:n&&t||t&&!b.isFunction(t)&&t};return r.duration=b.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in b.fx.speeds?b.fx.speeds[r.duration]:b.fx.speeds._default,(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){b.isFunction(r.old)&&r.old.call(this),r.queue&&b.dequeue(this,r.queue)},r},b.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},b.timers=[],b.fx=rr.prototype.init,b.fx.tick=function(){var e,n=b.timers,r=0;for(Xn=b.now();n.length>r;r++)e=n[r],e()||n[r]!==e||n.splice(r--,1);n.length||b.fx.stop(),Xn=t},b.fx.timer=function(e){e()&&b.timers.push(e)&&b.fx.start()},b.fx.interval=13,b.fx.start=function(){Un||(Un=setInterval(b.fx.tick,b.fx.interval))},b.fx.stop=function(){clearInterval(Un),Un=null},b.fx.speeds={slow:600,fast:200,_default:400},b.fx.step={},b.expr&&b.expr.filters&&(b.expr.filters.animated=function(e){return b.grep(b.timers,function(t){return e===t.elem}).length}),b.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){b.offset.setOffset(this,e,t)});var n,r,o={top:0,left:0},a=this[0],s=a&&a.ownerDocument;if(s)return n=s.documentElement,b.contains(n,a)?(typeof a.getBoundingClientRect!==i&&(o=a.getBoundingClientRect()),r=or(s),{top:o.top+(r.pageYOffset||n.scrollTop)-(n.clientTop||0),left:o.left+(r.pageXOffset||n.scrollLeft)-(n.clientLeft||0)}):o},b.offset={setOffset:function(e,t,n){var r=b.css(e,"position");"static"===r&&(e.style.position="relative");var i=b(e),o=i.offset(),a=b.css(e,"top"),s=b.css(e,"left"),u=("absolute"===r||"fixed"===r)&&b.inArray("auto",[a,s])>-1,l={},c={},p,f;u?(c=i.position(),p=c.top,f=c.left):(p=parseFloat(a)||0,f=parseFloat(s)||0),b.isFunction(t)&&(t=t.call(e,n,o)),null!=t.top&&(l.top=t.top-o.top+p),null!=t.left&&(l.left=t.left-o.left+f),"using"in t?t.using.call(e,l):i.css(l)}},b.fn.extend({position:function(){if(this[0]){var e,t,n={top:0,left:0},r=this[0];return"fixed"===b.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),b.nodeName(e[0],"html")||(n=e.offset()),n.top+=b.css(e[0],"borderTopWidth",!0),n.left+=b.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-b.css(r,"marginTop",!0),left:t.left-n.left-b.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||o.documentElement;while(e&&!b.nodeName(e,"html")&&"static"===b.css(e,"position"))e=e.offsetParent;return e||o.documentElement})}}),b.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);b.fn[e]=function(i){return b.access(this,function(e,i,o){var a=or(e);return o===t?a?n in a?a[n]:a.document.documentElement[i]:e[i]:(a?a.scrollTo(r?b(a).scrollLeft():o,r?o:b(a).scrollTop()):e[i]=o,t)},e,i,arguments.length,null)}});function or(e){return b.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}b.each({Height:"height",Width:"width"},function(e,n){b.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){b.fn[i]=function(i,o){var a=arguments.length&&(r||"boolean"!=typeof i),s=r||(i===!0||o===!0?"margin":"border");return b.access(this,function(n,r,i){var o;return b.isWindow(n)?n.document.documentElement["client"+e]:9===n.nodeType?(o=n.documentElement,Math.max(n.body["scroll"+e],o["scroll"+e],n.body["offset"+e],o["offset"+e],o["client"+e])):i===t?b.css(n,r,s):b.style(n,r,i,s)},n,a?i:t,a,null)}})}),e.jQuery=e.$=b,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return b})})(window);

/* ========================================================================
 * Bootstrap: affix.js v3.2.0
 * http://getbootstrap.com/javascript/#affix
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // AFFIX CLASS DEFINITION
  // ======================

  var Affix = function (element, options) {
    this.options = $.extend({}, Affix.DEFAULTS, options)

    this.$target = $(this.options.target)
      .on('scroll.bs.affix.data-api', $.proxy(this.checkPosition, this))
      .on('click.bs.affix.data-api',  $.proxy(this.checkPositionWithEventLoop, this))

    this.$element     = $(element)
    this.affixed      =
    this.unpin        =
    this.pinnedOffset = null

    this.checkPosition()
  }

  Affix.VERSION  = '3.2.0'

  Affix.RESET    = 'affix affix-top affix-bottom'

  Affix.DEFAULTS = {
    offset: 0,
    target: window
  }

  Affix.prototype.getPinnedOffset = function () {
    if (this.pinnedOffset) return this.pinnedOffset
    this.$element.removeClass(Affix.RESET).addClass('affix')
    var scrollTop = this.$target.scrollTop()
    var position  = this.$element.offset()
    return (this.pinnedOffset = position.top - scrollTop)
  }

  Affix.prototype.checkPositionWithEventLoop = function () {
    setTimeout($.proxy(this.checkPosition, this), 1)
  }

  Affix.prototype.checkPosition = function () {
    if (!this.$element.is(':visible')) return

    var scrollHeight = $(document).height()
    var scrollTop    = this.$target.scrollTop()
    var position     = this.$element.offset()
    var offset       = this.options.offset
    var offsetTop    = offset.top
    var offsetBottom = offset.bottom

    if (typeof offset != 'object')         offsetBottom = offsetTop = offset
    if (typeof offsetTop == 'function')    offsetTop    = offset.top(this.$element)
    if (typeof offsetBottom == 'function') offsetBottom = offset.bottom(this.$element)

    var affix = this.unpin   != null && (scrollTop + this.unpin <= position.top) ? false :
                offsetBottom != null && (position.top + this.$element.height() >= scrollHeight - offsetBottom) ? 'bottom' :
                offsetTop    != null && (scrollTop <= offsetTop) ? 'top' : false

    if (this.affixed === affix) return
    if (this.unpin != null) this.$element.css('top', '')

    var affixType = 'affix' + (affix ? '-' + affix : '')
    var e         = $.Event(affixType + '.bs.affix')

    this.$element.trigger(e)

    if (e.isDefaultPrevented()) return

    this.affixed = affix
    this.unpin = affix == 'bottom' ? this.getPinnedOffset() : null

    this.$element
      .removeClass(Affix.RESET)
      .addClass(affixType)
      .trigger($.Event(affixType.replace('affix', 'affixed')))

    if (affix == 'bottom') {
      this.$element.offset({
        top: scrollHeight - this.$element.height() - offsetBottom
      })
    }
  }


  // AFFIX PLUGIN DEFINITION
  // =======================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.affix')
      var options = typeof option == 'object' && option

      if (!data) $this.data('bs.affix', (data = new Affix(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.affix

  $.fn.affix             = Plugin
  $.fn.affix.Constructor = Affix


  // AFFIX NO CONFLICT
  // =================

  $.fn.affix.noConflict = function () {
    $.fn.affix = old
    return this
  }


  // AFFIX DATA-API
  // ==============

  $(window).on('load', function () {
    $('[data-spy="affix"]').each(function () {
      var $spy = $(this)
      var data = $spy.data()

      data.offset = data.offset || {}

      if (data.offsetBottom) data.offset.bottom = data.offsetBottom
      if (data.offsetTop)    data.offset.top    = data.offsetTop

      Plugin.call($spy, data)
    })
  })

}(jQuery);

/*!
 * Bootstrap v3.2.0 (http://getbootstrap.com)
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 */

/*!
 * Generated using the Bootstrap Customizer (http://getbootstrap.com/customize/?id=71302de5c334d16fa768)
 * Config saved to config.json and https://gist.github.com/71302de5c334d16fa768
 */
if (typeof jQuery === "undefined") { throw new Error("Bootstrap's JavaScript requires jQuery") }

/* ========================================================================
 * Bootstrap: alert.js v3.2.0
 * http://getbootstrap.com/javascript/#alerts
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // ALERT CLASS DEFINITION
  // ======================

  var dismiss = '[data-dismiss="alert"]'
  var Alert   = function (el) {
    $(el).on('click', dismiss, this.close)
  }

  Alert.VERSION = '3.2.0'

  Alert.prototype.close = function (e) {
    var $this    = $(this)
    var selector = $this.attr('data-target')

    if (!selector) {
      selector = $this.attr('href')
      selector = selector && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
    }

    var $parent = $(selector)

    if (e) e.preventDefault()

    if (!$parent.length) {
      $parent = $this.hasClass('alert') ? $this : $this.parent()
    }

    $parent.trigger(e = $.Event('close.bs.alert'))

    if (e.isDefaultPrevented()) return

    $parent.removeClass('in')

    function removeElement() {
      // detach from parent, fire event then clean up data
      $parent.detach().trigger('closed.bs.alert').remove()
    }

    $.support.transition && $parent.hasClass('fade') ?
      $parent
        .one('bsTransitionEnd', removeElement)
        .emulateTransitionEnd(150) :
      removeElement()
  }


  // ALERT PLUGIN DEFINITION
  // =======================

  function Plugin(option) {
    return this.each(function () {
      var $this = $(this)
      var data  = $this.data('bs.alert')

      if (!data) $this.data('bs.alert', (data = new Alert(this)))
      if (typeof option == 'string') data[option].call($this)
    })
  }

  var old = $.fn.alert

  $.fn.alert             = Plugin
  $.fn.alert.Constructor = Alert


  // ALERT NO CONFLICT
  // =================

  $.fn.alert.noConflict = function () {
    $.fn.alert = old
    return this
  }


  // ALERT DATA-API
  // ==============

  $(document).on('click.bs.alert.data-api', dismiss, Alert.prototype.close)

}(jQuery);

/* ========================================================================
 * Bootstrap: button.js v3.2.0
 * http://getbootstrap.com/javascript/#buttons
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // BUTTON PUBLIC CLASS DEFINITION
  // ==============================

  var Button = function (element, options) {
    this.$element  = $(element)
    this.options   = $.extend({}, Button.DEFAULTS, options)
    this.isLoading = false
  }

  Button.VERSION  = '3.2.0'

  Button.DEFAULTS = {
    loadingText: 'loading...'
  }

  Button.prototype.setState = function (state) {
    var d    = 'disabled'
    var $el  = this.$element
    var val  = $el.is('input') ? 'val' : 'html'
    var data = $el.data()

    state = state + 'Text'

    if (data.resetText == null) $el.data('resetText', $el[val]())

    $el[val](data[state] == null ? this.options[state] : data[state])

    // push to event loop to allow forms to submit
    setTimeout($.proxy(function () {
      if (state == 'loadingText') {
        this.isLoading = true
        $el.addClass(d).attr(d, d)
      } else if (this.isLoading) {
        this.isLoading = false
        $el.removeClass(d).removeAttr(d)
      }
    }, this), 0)
  }

  Button.prototype.toggle = function () {
    var changed = true
    var $parent = this.$element.closest('[data-toggle="buttons"]')

    if ($parent.length) {
      var $input = this.$element.find('input')
      if ($input.prop('type') == 'radio') {
        if ($input.prop('checked') && this.$element.hasClass('active')) changed = false
        else $parent.find('.active').removeClass('active')
      }
      if (changed) $input.prop('checked', !this.$element.hasClass('active')).trigger('change')
    }

    if (changed) this.$element.toggleClass('active')
  }


  // BUTTON PLUGIN DEFINITION
  // ========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.button')
      var options = typeof option == 'object' && option

      if (!data) $this.data('bs.button', (data = new Button(this, options)))

      if (option == 'toggle') data.toggle()
      else if (option) data.setState(option)
    })
  }

  var old = $.fn.button

  $.fn.button             = Plugin
  $.fn.button.Constructor = Button


  // BUTTON NO CONFLICT
  // ==================

  $.fn.button.noConflict = function () {
    $.fn.button = old
    return this
  }


  // BUTTON DATA-API
  // ===============

  $(document).on('click.bs.button.data-api', '[data-toggle^="button"]', function (e) {
    var $btn = $(e.target)
    if (!$btn.hasClass('btn')) $btn = $btn.closest('.btn')
    Plugin.call($btn, 'toggle')
    e.preventDefault()
  })

}(jQuery);

/* ========================================================================
 * Bootstrap: tooltip.js v3.2.0
 * http://getbootstrap.com/javascript/#tooltip
 * Inspired by the original jQuery.tipsy by Jason Frame
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // TOOLTIP PUBLIC CLASS DEFINITION
  // ===============================

  var Tooltip = function (element, options) {
    this.type       =
    this.options    =
    this.enabled    =
    this.timeout    =
    this.hoverState =
    this.$element   = null

    this.init('tooltip', element, options)
  }

  Tooltip.VERSION  = '3.2.0'

  Tooltip.DEFAULTS = {
    animation: true,
    placement: 'top',
    selector: false,
    template: '<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',
    trigger: 'hover focus',
    title: '',
    delay: 0,
    html: false,
    container: false,
    viewport: {
      selector: 'body',
      padding: 0
    }
  }

  Tooltip.prototype.init = function (type, element, options) {
    this.enabled   = true
    this.type      = type
    this.$element  = $(element)
    this.options   = this.getOptions(options)
    this.$viewport = this.options.viewport && $(this.options.viewport.selector || this.options.viewport)

    var triggers = this.options.trigger.split(' ')

    for (var i = triggers.length; i--;) {
      var trigger = triggers[i]

      if (trigger == 'click') {
        this.$element.on('click.' + this.type, this.options.selector, $.proxy(this.toggle, this))
      } else if (trigger != 'manual') {
        var eventIn  = trigger == 'hover' ? 'mouseenter' : 'focusin'
        var eventOut = trigger == 'hover' ? 'mouseleave' : 'focusout'

        this.$element.on(eventIn  + '.' + this.type, this.options.selector, $.proxy(this.enter, this))
        this.$element.on(eventOut + '.' + this.type, this.options.selector, $.proxy(this.leave, this))
      }
    }

    this.options.selector ?
      (this._options = $.extend({}, this.options, { trigger: 'manual', selector: '' })) :
      this.fixTitle()
  }

  Tooltip.prototype.getDefaults = function () {
    return Tooltip.DEFAULTS
  }

  Tooltip.prototype.getOptions = function (options) {
    options = $.extend({}, this.getDefaults(), this.$element.data(), options)

    if (options.delay && typeof options.delay == 'number') {
      options.delay = {
        show: options.delay,
        hide: options.delay
      }
    }

    return options
  }

  Tooltip.prototype.getDelegateOptions = function () {
    var options  = {}
    var defaults = this.getDefaults()

    this._options && $.each(this._options, function (key, value) {
      if (defaults[key] != value) options[key] = value
    })

    return options
  }

  Tooltip.prototype.enter = function (obj) {
    var self = obj instanceof this.constructor ?
      obj : $(obj.currentTarget).data('bs.' + this.type)

    if (!self) {
      self = new this.constructor(obj.currentTarget, this.getDelegateOptions())
      $(obj.currentTarget).data('bs.' + this.type, self)
    }

    clearTimeout(self.timeout)

    self.hoverState = 'in'

    if (!self.options.delay || !self.options.delay.show) return self.show()

    self.timeout = setTimeout(function () {
      if (self.hoverState == 'in') self.show()
    }, self.options.delay.show)
  }

  Tooltip.prototype.leave = function (obj) {
    var self = obj instanceof this.constructor ?
      obj : $(obj.currentTarget).data('bs.' + this.type)

    if (!self) {
      self = new this.constructor(obj.currentTarget, this.getDelegateOptions())
      $(obj.currentTarget).data('bs.' + this.type, self)
    }

    clearTimeout(self.timeout)

    self.hoverState = 'out'

    if (!self.options.delay || !self.options.delay.hide) return self.hide()

    self.timeout = setTimeout(function () {
      if (self.hoverState == 'out') self.hide()
    }, self.options.delay.hide)
  }

  Tooltip.prototype.show = function () {
    var e = $.Event('show.bs.' + this.type)

    if (this.hasContent() && this.enabled) {
      this.$element.trigger(e)

      var inDom = $.contains(document.documentElement, this.$element[0])
      if (e.isDefaultPrevented() || !inDom) return
      var that = this

      var $tip = this.tip()

      var tipId = this.getUID(this.type)

      this.setContent()
      $tip.attr('id', tipId)
      this.$element.attr('aria-describedby', tipId)

      if (this.options.animation) $tip.addClass('fade')

      var placement = typeof this.options.placement == 'function' ?
        this.options.placement.call(this, $tip[0], this.$element[0]) :
        this.options.placement

      var autoToken = /\s?auto?\s?/i
      var autoPlace = autoToken.test(placement)
      if (autoPlace) placement = placement.replace(autoToken, '') || 'top'

      $tip
        .detach()
        .css({ top: 0, left: 0, display: 'block' })
        .addClass(placement)
        .data('bs.' + this.type, this)

      this.options.container ? $tip.appendTo(this.options.container) : $tip.insertAfter(this.$element)

      var pos          = this.getPosition()
      var actualWidth  = $tip[0].offsetWidth
      var actualHeight = $tip[0].offsetHeight

      if (autoPlace) {
        var orgPlacement = placement
        var $parent      = this.$element.parent()
        var parentDim    = this.getPosition($parent)

        placement = placement == 'bottom' && pos.top   + pos.height       + actualHeight - parentDim.scroll > parentDim.height ? 'top'    :
                    placement == 'top'    && pos.top   - parentDim.scroll - actualHeight < 0                                   ? 'bottom' :
                    placement == 'right'  && pos.right + actualWidth      > parentDim.width                                    ? 'left'   :
                    placement == 'left'   && pos.left  - actualWidth      < parentDim.left                                     ? 'right'  :
                    placement

        $tip
          .removeClass(orgPlacement)
          .addClass(placement)
      }

      var calculatedOffset = this.getCalculatedOffset(placement, pos, actualWidth, actualHeight)

      this.applyPlacement(calculatedOffset, placement)

      var complete = function () {
        that.$element.trigger('shown.bs.' + that.type)
        that.hoverState = null
      }

      $.support.transition && this.$tip.hasClass('fade') ?
        $tip
          .one('bsTransitionEnd', complete)
          .emulateTransitionEnd(150) :
        complete()
    }
  }

  Tooltip.prototype.applyPlacement = function (offset, placement) {
    var $tip   = this.tip()
    var width  = $tip[0].offsetWidth
    var height = $tip[0].offsetHeight

    // manually read margins because getBoundingClientRect includes difference
    var marginTop = parseInt($tip.css('margin-top'), 10)
    var marginLeft = parseInt($tip.css('margin-left'), 10)

    // we must check for NaN for ie 8/9
    if (isNaN(marginTop))  marginTop  = 0
    if (isNaN(marginLeft)) marginLeft = 0

    offset.top  = offset.top  + marginTop
    offset.left = offset.left + marginLeft

    // $.fn.offset doesn't round pixel values
    // so we use setOffset directly with our own function B-0
    $.offset.setOffset($tip[0], $.extend({
      using: function (props) {
        $tip.css({
          top: Math.round(props.top),
          left: Math.round(props.left)
        })
      }
    }, offset), 0)

    $tip.addClass('in')

    // check to see if placing tip in new offset caused the tip to resize itself
    var actualWidth  = $tip[0].offsetWidth
    var actualHeight = $tip[0].offsetHeight

    if (placement == 'top' && actualHeight != height) {
      offset.top = offset.top + height - actualHeight
    }

    var delta = this.getViewportAdjustedDelta(placement, offset, actualWidth, actualHeight)

    if (delta.left) offset.left += delta.left
    else offset.top += delta.top

    var arrowDelta          = delta.left ? delta.left * 2 - width + actualWidth : delta.top * 2 - height + actualHeight
    var arrowPosition       = delta.left ? 'left'        : 'top'
    var arrowOffsetPosition = delta.left ? 'offsetWidth' : 'offsetHeight'

    $tip.offset(offset)
    this.replaceArrow(arrowDelta, $tip[0][arrowOffsetPosition], arrowPosition)
  }

  Tooltip.prototype.replaceArrow = function (delta, dimension, position) {
    this.arrow().css(position, delta ? (50 * (1 - delta / dimension) + '%') : '')
  }

  Tooltip.prototype.setContent = function () {
    var $tip  = this.tip()
    var title = this.getTitle()

    $tip.find('.tooltip-inner')[this.options.html ? 'html' : 'text'](title)
    $tip.removeClass('fade in top bottom left right')
  }

  Tooltip.prototype.hide = function () {
    var that = this
    var $tip = this.tip()
    var e    = $.Event('hide.bs.' + this.type)

    this.$element.removeAttr('aria-describedby')

    function complete() {
      if (that.hoverState != 'in') $tip.detach()
      that.$element.trigger('hidden.bs.' + that.type)
    }

    this.$element.trigger(e)

    if (e.isDefaultPrevented()) return

    $tip.removeClass('in')

    $.support.transition && this.$tip.hasClass('fade') ?
      $tip
        .one('bsTransitionEnd', complete)
        .emulateTransitionEnd(150) :
      complete()

    this.hoverState = null

    return this
  }

  Tooltip.prototype.fixTitle = function () {
    var $e = this.$element
    if ($e.attr('title') || typeof ($e.attr('data-original-title')) != 'string') {
      $e.attr('data-original-title', $e.attr('title') || '').attr('title', '')
    }
  }

  Tooltip.prototype.hasContent = function () {
    return this.getTitle()
  }

  Tooltip.prototype.getPosition = function ($element) {
    $element   = $element || this.$element
    var el     = $element[0]
    var isBody = el.tagName == 'BODY'
    return $.extend({}, (typeof el.getBoundingClientRect == 'function') ? el.getBoundingClientRect() : null, {
      scroll: isBody ? document.documentElement.scrollTop || document.body.scrollTop : $element.scrollTop(),
      width:  isBody ? $(window).width()  : $element.outerWidth(),
      height: isBody ? $(window).height() : $element.outerHeight()
    }, isBody ? { top: 0, left: 0 } : $element.offset())
  }

  Tooltip.prototype.getCalculatedOffset = function (placement, pos, actualWidth, actualHeight) {
    return placement == 'bottom' ? { top: pos.top + pos.height,   left: pos.left + pos.width / 2 - actualWidth / 2  } :
           placement == 'top'    ? { top: pos.top - actualHeight, left: pos.left + pos.width / 2 - actualWidth / 2  } :
           placement == 'left'   ? { top: pos.top + pos.height / 2 - actualHeight / 2, left: pos.left - actualWidth } :
        /* placement == 'right' */ { top: pos.top + pos.height / 2 - actualHeight / 2, left: pos.left + pos.width   }

  }

  Tooltip.prototype.getViewportAdjustedDelta = function (placement, pos, actualWidth, actualHeight) {
    var delta = { top: 0, left: 0 }
    if (!this.$viewport) return delta

    var viewportPadding = this.options.viewport && this.options.viewport.padding || 0
    var viewportDimensions = this.getPosition(this.$viewport)

    if (/right|left/.test(placement)) {
      var topEdgeOffset    = pos.top - viewportPadding - viewportDimensions.scroll
      var bottomEdgeOffset = pos.top + viewportPadding - viewportDimensions.scroll + actualHeight
      if (topEdgeOffset < viewportDimensions.top) { // top overflow
        delta.top = viewportDimensions.top - topEdgeOffset
      } else if (bottomEdgeOffset > viewportDimensions.top + viewportDimensions.height) { // bottom overflow
        delta.top = viewportDimensions.top + viewportDimensions.height - bottomEdgeOffset
      }
    } else {
      var leftEdgeOffset  = pos.left - viewportPadding
      var rightEdgeOffset = pos.left + viewportPadding + actualWidth
      if (leftEdgeOffset < viewportDimensions.left) { // left overflow
        delta.left = viewportDimensions.left - leftEdgeOffset
      } else if (rightEdgeOffset > viewportDimensions.width) { // right overflow
        delta.left = viewportDimensions.left + viewportDimensions.width - rightEdgeOffset
      }
    }

    return delta
  }

  Tooltip.prototype.getTitle = function () {
    var title
    var $e = this.$element
    var o  = this.options

    title = $e.attr('data-original-title')
      || (typeof o.title == 'function' ? o.title.call($e[0]) :  o.title)

    return title
  }

  Tooltip.prototype.getUID = function (prefix) {
    do prefix += ~~(Math.random() * 1000000)
    while (document.getElementById(prefix))
    return prefix
  }

  Tooltip.prototype.tip = function () {
    return (this.$tip = this.$tip || $(this.options.template))
  }

  Tooltip.prototype.arrow = function () {
    return (this.$arrow = this.$arrow || this.tip().find('.tooltip-arrow'))
  }

  Tooltip.prototype.validate = function () {
    if (!this.$element[0].parentNode) {
      this.hide()
      this.$element = null
      this.options  = null
    }
  }

  Tooltip.prototype.enable = function () {
    this.enabled = true
  }

  Tooltip.prototype.disable = function () {
    this.enabled = false
  }

  Tooltip.prototype.toggleEnabled = function () {
    this.enabled = !this.enabled
  }

  Tooltip.prototype.toggle = function (e) {
    var self = this
    if (e) {
      self = $(e.currentTarget).data('bs.' + this.type)
      if (!self) {
        self = new this.constructor(e.currentTarget, this.getDelegateOptions())
        $(e.currentTarget).data('bs.' + this.type, self)
      }
    }

    self.tip().hasClass('in') ? self.leave(self) : self.enter(self)
  }

  Tooltip.prototype.destroy = function () {
    clearTimeout(this.timeout)
    this.hide().$element.off('.' + this.type).removeData('bs.' + this.type)
  }


  // TOOLTIP PLUGIN DEFINITION
  // =========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.tooltip')
      var options = typeof option == 'object' && option

      if (!data && option == 'destroy') return
      if (!data) $this.data('bs.tooltip', (data = new Tooltip(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.tooltip

  $.fn.tooltip             = Plugin
  $.fn.tooltip.Constructor = Tooltip


  // TOOLTIP NO CONFLICT
  // ===================

  $.fn.tooltip.noConflict = function () {
    $.fn.tooltip = old
    return this
  }

}(jQuery);

var Acuity = Acuity || {};

Acuity.Calendar = function (params) {
	var that = this;
	var _lastTimesRequest = null;

	function getAddons()
	{
		if (typeof params.getAddons == 'function') {
			return params.getAddons();
		} else {
			return [];
		}
	}

	function isMobile()
	{
		var width = (window.innerWidth > 0) ? window.innerWidth : screen.width;
		return width < 768;
	}

	/**
	 * Load calendar for given cal/type selection
	 */
	this.loadCalendar = function (month, opts) {
		var $calendar = params.$calendar;
		opts = opts || {};

		// Show loading...
		$calendar.html(Acuity.Config.loadingHtml).show();
		params.clearTimes();

		var loadCalendarRequestedAt = new Date();

		opts['numDays'] = (isMobile() ? 3 : 5); // Fewer columns on mobile, uses CSS to display column size

		var appointmentType = calendarID = '';
		try {
			appointmentType = JSON.parse($('[name="linkAppointmentType"]').val());
			calendarID = JSON.parse($('[name="linkCalendar"]').val());
		} catch (ex) {
			// ...
		}

		var owner = $('#owner').val();
		$.post('/schedule.php?action=showCalendar&fulldate=1&owner='+owner+(typeof TEMPLATE_NAME!='undefined'?'&template='+TEMPLATE_NAME:''), {
			type: params.getType(),
			addons: getAddons(),
			calendar: params.getCalendar(),
			month: month,
			timezone: params.getTimezone(),
			skip: true,
			options: opts,
			ignoreAppointment: params.ignoreAppointment || '',
			appointmentType: appointmentType,
			calendarID: calendarID
		}).done(function (data) {
			$calendar.html(data).find('.calendar').on('click', '.activeday', function (ev) {
				that.loadTimes($(ev.currentTarget).attr('day'))
			});

			if (!$calendar.find('.activeday').length) {
				// no times are available! show them
				if (!isWeeklyView()) {
					$calendar.find('.calendar').append('<div class="no-dates-available">No appointments are available this month</div>');
				}
			}

			if ($calendar.find('.cmd-hide-calendar').length) {
				$calendar.hide();
			}

			var calendarWidth = Math.max(225, $calendar.find('.calendar').width());
			$calendar.find('.calendarHeading').width(calendarWidth);

			$calendar.trigger('acuity:calendar-loaded');

			// If we passed a month, we're clicking in this area so don't need to focus on it
			if (!month && top.frames.length>1 && Acuity.pageLoadTime && (loadCalendarRequestedAt - Acuity.pageLoadTime)>500 ) {
				$('.calendarHeading select').focus();
			}
		}).fail(function () {
			$calendar.html('Failed to get calendar, <a href="#" class="retry">retry</a>?').on('click', '.retry', function () {
				that.loadCalendar(month);
			});
		});
	}


	/**
	 * Load times for a given date, assuming cal and type already selected
	 */
	this.loadTimes = function (date) {
		params.$calendar.find('.selectedday').removeClass('selectedday');
		params.$calendar.find('.scheduleday[day="'+date+'"]').addClass('selectedday');

		params.dateSelected(date);

		// If user clicks multiple times, but out of order
		//	don't let a previous request trigger
		if (_lastTimesRequest) {
			_lastTimesRequest.abort();
		}

		var additionalTimes = [];
		var additionalDates = [];
		// Keep additionalTimes empty, the full date+time is now included in one field
		$('#selected-times:visible [name="time[]"]').each(function(){
			additionalDates.push($(this).val());
		});

		var owner = $('#owner').val();
		_lastTimesRequest = $.post('/schedule.php?action=availableTimes&showSelect=0&fulldate=1&owner='+owner, {
			type: params.getType(),
			addons: getAddons(),
			calendar: params.getCalendar(),
			date: date,
			timezone: params.getTimezone(),
			ignoreAppointment: params.ignoreAppointment || '',
			a_time: additionalTimes,
			a_date: additionalDates
		}).done(function (data) {
			params.timesLoaded(data);
		}).fail(function () {
			params.timesLoaded(undefined);
		});
	}

	this.params = params;

	self.showCalendar = this.loadCalendar;
};


$(function () {
	if (Acuity.Embed.isEmbedded() || !window.console || !window.console.log) return;
	var ua = (window.navigator.userAgent || '');
	if (
		ua.indexOf('Chrome') >= 0 || ua.indexOf('Chromium') >= 0 ||
		ua.indexOf('Firefox') >= 0 || ua.indexOf('Safari') >= 0
	) {
		console.log(
			'\n\n%cAcuity Scheduling, Inc.%c\nWelcome developer!  You can find out more about customizing the client scheduler at %chttps://developers.acuityscheduling.com%c or by contacting developers@acuityscheduling.com\n ',
			'color: #444; font-family: sans-serif; font-size: 32px; line-height: 32px;',
			'color: #555; font-family: sans-serif; font-size: 15px; line-height: 24px;',
			'color: #469E9F; font-family: sans-serif; font-size: 15px; line-height: 24px; text-decoration: underline; font-style: normal;',
			'color: #555; font-family: sans-serif; font-size: 15px; line-height: 24px;'
		);
	}
});

var Acuity = Acuity || {};

Acuity.Focus = (function () {
	/**
	 * Add some styling when focused
	 */
	function init($container)
	{
		$container.on('focus', 'input, select, textarea', function (ev) {
			$('.is-focused').removeClass('is-focused');
			$(ev.target).closest('.form-group').addClass('is-focused');
		});

		$container.on('blur', 'input, select, textarea', function (ev) {
			$(ev.target).closest('.form-group').removeClass('is-focused');
		});
	}

	return {
		init: init
	}
})();
// Namespace
var Acuity = Acuity || {};

Acuity.Config = {
	loadingHtml: '<div class="loading-container"><span class="progress-spinner small"></span> Loading...</div>'
}

Acuity.pageLoadTime = false;
$(function () {
	Acuity.pageLoadTime = new Date();
});

function debounce(func, wait, immediate) {
	var timeout;
	return function() {
		var context = this, args = arguments;
		var later = function() {
			timeout = null;
			if (!immediate) func.apply(context, args);
		};
		var callNow = immediate && !timeout;
		clearTimeout(timeout);
		timeout = setTimeout(later, wait);
		if (callNow) func.apply(context, args);
	};
};

function async(script, cb)
{
	$.ajaxSetup({
		cache: true
	});
	$.getScript(script, cb);
}

AcuityStorage = {
	setItem: function (name, value) {
		try {
			sessionStorage[name] = value;
		} catch (e) {
			return;
		}
	},
	getItem: function (name) {
		try {
			return sessionStorage[name];
		} catch (e) {
			return;
		}
	}
};

function isEmailValid(email) {
	// multiple e-mails can be entered, make sure there's at least the hint of _one_ valid
    var re = /([^@]+)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,20}(?:\.[a-z]{2})?)/i;
    return re.test(email.trim());
}

function normalizeEmail(email)
{
	// Should be similar to CertificateCodeEmail::normalizeEmail
	return $.trim(email).toLowerCase();
}

/**
 * Are we showing just a week at a time, with times below the dates?
 */
function isWeeklyView()
{
	return $('.choose-date-times').length > 0;
}

/**
 * Are we showing all dates times and classes all at once?
 */
function isClassView()
{
	return $('.class-list-container').length > 0;
}


function isOldIE()
{
	return /MSIE [678]/g.test( navigator.userAgent );
}

/**
 * Shim for some backward compatibility with prototype
 */
if (typeof window.$F != 'function') {
	window.$F = function (id) {
		return $('#'+id).val();
	}
}

if(typeof String.prototype.trim !== 'function') {
  String.prototype.trim = function() {
    return this.replace(/^\s+|\s+$/g, ''); 
  }
}

// defaults for jquery
$.fx.speeds._default = 150;

/**
 * For different touch styling
 */
if ('ontouchstart' in document) {
	$('body').removeClass('no-touch');
}

/**
 * Select actions
 */
if (isOldIE()) {
	$(document).on('click', 'label', function(ev){
		// fix for IE8 where clicking label doesn't select
		if ($(this).attr("for") != "") {
			$("#" + $(this).attr("for")).prop('checked', true).click().change();
		}
	});
}

/**
 * Handle appointment type and calendar select.
 *
 * Listen to click event instead.  At the end, send a message to select the item.
 * SamsungBrowser had some issues with the change event.
 *
 * https://trello.com/c/HdYdSGXX/2671-timezone-not-showing-on-android-bug
 */
$('.select').on('click', 'input[type="radio"], .select-label, .reopen-dropdown', function (ev) {
	var $current = $(ev.currentTarget);
	//$current.closest('.select:has(input[type="radio"]:checked)').toggleClass('closed');
	// close it...
	// start from last non-selected non-open and hide
	var $select = $current.closest('.select:has(input[type="radio"]:checked)');

	var animateDuration = $.fx.speeds._default / ($select.find('input').length);

	var $thisLabel = $select.find('input[type="radio"]:checked+label');

	var superLongListDuration = 2.5;
	var longListDuration = 10;
	function hideLast() {
		var $last = $select.find('input[type="radio"]+label, .select-label, .select-item-no-input').not($thisLabel).filter(':visible');

		// If super long list, hide it immediately, otherwise do it one at a time for an animation effect
		if (animateDuration > superLongListDuration) {
			$last = $last.last();
		}

		if ($last.length) {
			if (animateDuration < longListDuration) {
				$last.hide();
				setTimeout(hideLast);
			} else {
				$last.slideUp(animateDuration, hideLast);
			}
		} else {
			// double check everything hidden, in case parent was hidden at time of this
			$select.find('input[type="radio"]+label, .select-label, .select-item-no-input').not($thisLabel).hide();
			$select.addClass('closed');
		}
	}

	function showFirst() {
		$select.removeClass('closed');

		var $last = $select.find('input[type="radio"]+label, .select-label, .select-item-no-input').not($thisLabel).filter(':hidden').first();
		if (animateDuration > superLongListDuration) {
			$last = $last.first();
		}

		if ($last.length) {
			if (animateDuration < longListDuration) {
				$last.show();
				setTimeout(showFirst);
			} else {
				$last.slideDown(animateDuration, showFirst);
			}
		}
	}

	if ($select.hasClass('closed')) {
		showFirst();
	} else {
		Select.selectItem($select);
		hideLast();
	}
});

function adjustLogoPosition() {
	if (!$('body').hasClass('is-embedded')) {
		// Load event doesn't always fire if cached in IE, and grabbing height on dom load returns 0 in IE only
		setTimeout(function() {
			$('.business-logo-container').css({
				marginBottom: -($('.business-logo-container img').height()/2 - 20 /*Padding*/)
			});
		}, 0);
		
	}
}
$('.business-logo-container img').load(adjustLogoPosition);
adjustLogoPosition();

// Init if clicked back button
$('.select input[type="radio"]:checked').prop('checked', false);

// Hide things for babel only if unchanged
$(function () {
	$('.hidden-xs-nobabel').each(function () {
		var $this = $(this);
		var originalText = $this.attr('data-original-text');
		var currentText = $this.text();

		if (!originalText || originalText == currentText) {
			$this.addClass('hidden-xs');
		} else {
			$this.removeClass('hidden-xs');
		}
	});
});

var Select = (function (){
	function reset($select) {
		$select.removeClass('closed');
		$select.find('.select-label').show();
	}

	/**
	 * Select the first item in the list
	 */
	function selectItem($select) {
		var $current = $select.find('input[type="radio"]:checked');
		$current.closest('.select')
			.attr('data-value', $current.val())
			.trigger('acuity:checked', [$current.val()]);
	}

	function selectFirstItem() {
		$('.select-type input[type="radio"]').prop('checked', true).click();
	}

	return {
		selectFirstItem: selectFirstItem,
		selectItem: selectItem,
		reset: reset
	};
})();


// TODO: get a better implementation
JSON.parse = JSON.parse || function (str) {
	if (str === "") str = '""';
	eval("var p=" + str + ";");
	return p;
};

/* jstz.min.js Version: 1.0.6 Build date: 2015-11-04 */
!function(e){var a=function(){"use strict";var e="s",s={DAY:864e5,HOUR:36e5,MINUTE:6e4,SECOND:1e3,BASELINE_YEAR:2014,MAX_SCORE:864e6,AMBIGUITIES:{"America/Denver":["America/Mazatlan"],"Europe/London":["Africa/Casablanca"],"America/Chicago":["America/Mexico_City"],"America/Asuncion":["America/Campo_Grande","America/Santiago"],"America/Montevideo":["America/Sao_Paulo","America/Santiago"],"Asia/Beirut":["Asia/Amman","Asia/Jerusalem","Europe/Helsinki","Asia/Damascus","Africa/Cairo","Asia/Gaza","Europe/Minsk"],"Pacific/Auckland":["Pacific/Fiji"],"America/Los_Angeles":["America/Santa_Isabel"],"America/New_York":["America/Havana"],"America/Halifax":["America/Goose_Bay"],"America/Godthab":["America/Miquelon"],"Asia/Dubai":["Asia/Yerevan"],"Asia/Jakarta":["Asia/Krasnoyarsk"],"Asia/Shanghai":["Asia/Irkutsk","Australia/Perth"],"Australia/Sydney":["Australia/Lord_Howe"],"Asia/Tokyo":["Asia/Yakutsk"],"Asia/Dhaka":["Asia/Omsk"],"Asia/Baku":["Asia/Yerevan"],"Australia/Brisbane":["Asia/Vladivostok"],"Pacific/Noumea":["Asia/Vladivostok"],"Pacific/Majuro":["Asia/Kamchatka","Pacific/Fiji"],"Pacific/Tongatapu":["Pacific/Apia"],"Asia/Baghdad":["Europe/Minsk","Europe/Moscow"],"Asia/Karachi":["Asia/Yekaterinburg"],"Africa/Johannesburg":["Asia/Gaza","Africa/Cairo"]}},i=function(e){var a=-e.getTimezoneOffset();return null!==a?a:0},r=function(){var a=i(new Date(s.BASELINE_YEAR,0,2)),r=i(new Date(s.BASELINE_YEAR,5,2)),n=a-r;return 0>n?a+",1":n>0?r+",1,"+e:a+",0"},n=function(){var e,a;if("undefined"!=typeof Intl&&"undefined"!=typeof Intl.DateTimeFormat&&(e=Intl.DateTimeFormat(),"undefined"!=typeof e&&"undefined"!=typeof e.resolvedOptions))return a=e.resolvedOptions().timeZone,a&&(a.indexOf("/")>-1||"UTC"===a)?a:void 0},o=function(e){for(var a=new Date(e,0,1,0,0,1,0).getTime(),s=new Date(e,12,31,23,59,59).getTime(),i=a,r=new Date(i).getTimezoneOffset(),n=null,o=null;s-864e5>i;){var t=new Date(i),A=t.getTimezoneOffset();A!==r&&(r>A&&(n=t),A>r&&(o=t),r=A),i+=864e5}return n&&o?{s:u(n).getTime(),e:u(o).getTime()}:!1},u=function l(e,a,i){"undefined"==typeof a&&(a=s.DAY,i=s.HOUR);for(var r=new Date(e.getTime()-a).getTime(),n=e.getTime()+a,o=new Date(r).getTimezoneOffset(),u=r,t=null;n-i>u;){var A=new Date(u),c=A.getTimezoneOffset();if(c!==o){t=A;break}u+=i}return a===s.DAY?l(t,s.HOUR,s.MINUTE):a===s.HOUR?l(t,s.MINUTE,s.SECOND):t},t=function(e,a,s,i){if("N/A"!==s)return s;if("Asia/Beirut"===a){if("Africa/Cairo"===i.name&&13983768e5===e[6].s&&14116788e5===e[6].e)return 0;if("Asia/Jerusalem"===i.name&&13959648e5===e[6].s&&14118588e5===e[6].e)return 0}else if("America/Santiago"===a){if("America/Asuncion"===i.name&&14124816e5===e[6].s&&1397358e6===e[6].e)return 0;if("America/Campo_Grande"===i.name&&14136912e5===e[6].s&&13925196e5===e[6].e)return 0}else if("America/Montevideo"===a){if("America/Sao_Paulo"===i.name&&14136876e5===e[6].s&&1392516e6===e[6].e)return 0}else if("Pacific/Auckland"===a&&"Pacific/Fiji"===i.name&&14142456e5===e[6].s&&13961016e5===e[6].e)return 0;return s},A=function(e,i){for(var r=function(a){for(var r=0,n=0;n<e.length;n++)if(a.rules[n]&&e[n]){if(!(e[n].s>=a.rules[n].s&&e[n].e<=a.rules[n].e)){r="N/A";break}if(r=0,r+=Math.abs(e[n].s-a.rules[n].s),r+=Math.abs(a.rules[n].e-e[n].e),r>s.MAX_SCORE){r="N/A";break}}return r=t(e,i,r,a)},n={},o=a.olson.dst_rules.zones,u=o.length,A=s.AMBIGUITIES[i],c=0;u>c;c++){var m=o[c],l=r(o[c]);"N/A"!==l&&(n[m.name]=l)}for(var f in n)if(n.hasOwnProperty(f))for(var d=0;d<A.length;d++)if(A[d]===f)return f;return i},c=function(e){var s=function(){for(var e=[],s=0;s<a.olson.dst_rules.years.length;s++){var i=o(a.olson.dst_rules.years[s]);e.push(i)}return e},i=function(e){for(var a=0;a<e.length;a++)if(e[a]!==!1)return!0;return!1},r=s(),n=i(r);return n?A(r,e):e},m=function(){var e=n();return e||(e=a.olson.timezones[r()],"undefined"!=typeof s.AMBIGUITIES[e]&&(e=c(e))),{name:function(){return e}}};return{determine:m}}();a.olson=a.olson||{},a.olson.timezones={"-720,0":"Etc/GMT+12","-660,0":"Pacific/Pago_Pago","-660,1,s":"Pacific/Apia","-600,1":"America/Adak","-600,0":"Pacific/Honolulu","-570,0":"Pacific/Marquesas","-540,0":"Pacific/Gambier","-540,1":"America/Anchorage","-480,1":"America/Los_Angeles","-480,0":"Pacific/Pitcairn","-420,0":"America/Phoenix","-420,1":"America/Denver","-360,0":"America/Guatemala","-360,1":"America/Chicago","-360,1,s":"Pacific/Easter","-300,0":"America/Bogota","-300,1":"America/New_York","-270,0":"America/Caracas","-240,1":"America/Halifax","-240,0":"America/Santo_Domingo","-240,1,s":"America/Asuncion","-210,1":"America/St_Johns","-180,1":"America/Godthab","-180,0":"America/Argentina/Buenos_Aires","-180,1,s":"America/Montevideo","-120,0":"America/Noronha","-120,1":"America/Noronha","-60,1":"Atlantic/Azores","-60,0":"Atlantic/Cape_Verde","0,0":"UTC","0,1":"Europe/London","60,1":"Europe/Berlin","60,0":"Africa/Lagos","60,1,s":"Africa/Windhoek","120,1":"Asia/Beirut","120,0":"Africa/Johannesburg","180,0":"Asia/Baghdad","180,1":"Europe/Moscow","210,1":"Asia/Tehran","240,0":"Asia/Dubai","240,1":"Asia/Baku","270,0":"Asia/Kabul","300,1":"Asia/Yekaterinburg","300,0":"Asia/Karachi","330,0":"Asia/Kolkata","345,0":"Asia/Kathmandu","360,0":"Asia/Dhaka","360,1":"Asia/Omsk","390,0":"Asia/Rangoon","420,1":"Asia/Krasnoyarsk","420,0":"Asia/Jakarta","480,0":"Asia/Shanghai","480,1":"Asia/Irkutsk","525,0":"Australia/Eucla","525,1,s":"Australia/Eucla","540,1":"Asia/Yakutsk","540,0":"Asia/Tokyo","570,0":"Australia/Darwin","570,1,s":"Australia/Adelaide","600,0":"Australia/Brisbane","600,1":"Asia/Vladivostok","600,1,s":"Australia/Sydney","630,1,s":"Australia/Lord_Howe","660,1":"Asia/Kamchatka","660,0":"Pacific/Noumea","690,0":"Pacific/Norfolk","720,1,s":"Pacific/Auckland","720,0":"Pacific/Majuro","765,1,s":"Pacific/Chatham","780,0":"Pacific/Tongatapu","780,1,s":"Pacific/Apia","840,0":"Pacific/Kiritimati"},a.olson.dst_rules={years:[2008,2009,2010,2011,2012,2013,2014],zones:[{name:"Africa/Cairo",rules:[{e:12199572e5,s:12090744e5},{e:1250802e6,s:1240524e6},{e:12858804e5,s:12840696e5},!1,!1,!1,{e:14116788e5,s:1406844e6}]},{name:"Africa/Casablanca",rules:[{e:12202236e5,s:12122784e5},{e:12508092e5,s:12438144e5},{e:1281222e6,s:12727584e5},{e:13120668e5,s:13017888e5},{e:13489704e5,s:1345428e6},{e:13828392e5,s:13761e8},{e:14142888e5,s:14069448e5}]},{name:"America/Asuncion",rules:[{e:12050316e5,s:12243888e5},{e:12364812e5,s:12558384e5},{e:12709548e5,s:12860784e5},{e:13024044e5,s:1317528e6},{e:1333854e6,s:13495824e5},{e:1364094e6,s:1381032e6},{e:13955436e5,s:14124816e5}]},{name:"America/Campo_Grande",rules:[{e:12032172e5,s:12243888e5},{e:12346668e5,s:12558384e5},{e:12667212e5,s:1287288e6},{e:12981708e5,s:13187376e5},{e:13302252e5,s:1350792e6},{e:136107e7,s:13822416e5},{e:13925196e5,s:14136912e5}]},{name:"America/Goose_Bay",rules:[{e:122559486e4,s:120503526e4},{e:125704446e4,s:123648486e4},{e:128909886e4,s:126853926e4},{e:13205556e5,s:129998886e4},{e:13520052e5,s:13314456e5},{e:13834548e5,s:13628952e5},{e:14149044e5,s:13943448e5}]},{name:"America/Havana",rules:[{e:12249972e5,s:12056436e5},{e:12564468e5,s:12364884e5},{e:12885012e5,s:12685428e5},{e:13211604e5,s:13005972e5},{e:13520052e5,s:13332564e5},{e:13834548e5,s:13628916e5},{e:14149044e5,s:13943412e5}]},{name:"America/Mazatlan",rules:[{e:1225008e6,s:12074724e5},{e:12564576e5,s:1238922e6},{e:1288512e6,s:12703716e5},{e:13199616e5,s:13018212e5},{e:13514112e5,s:13332708e5},{e:13828608e5,s:13653252e5},{e:14143104e5,s:13967748e5}]},{name:"America/Mexico_City",rules:[{e:12250044e5,s:12074688e5},{e:1256454e6,s:12389184e5},{e:12885084e5,s:1270368e6},{e:1319958e6,s:13018176e5},{e:13514076e5,s:13332672e5},{e:13828572e5,s:13653216e5},{e:14143068e5,s:13967712e5}]},{name:"America/Miquelon",rules:[{e:12255984e5,s:12050388e5},{e:1257048e6,s:12364884e5},{e:12891024e5,s:12685428e5},{e:1320552e6,s:12999924e5},{e:13520016e5,s:1331442e6},{e:13834512e5,s:13628916e5},{e:14149008e5,s:13943412e5}]},{name:"America/Santa_Isabel",rules:[{e:12250116e5,s:1207476e6},{e:12564612e5,s:12389256e5},{e:12885156e5,s:12703752e5},{e:13199652e5,s:13018248e5},{e:13514148e5,s:13332744e5},{e:13828644e5,s:13653288e5},{e:1414314e6,s:13967784e5}]},{name:"America/Santiago",rules:[{e:1206846e6,s:1223784e6},{e:1237086e6,s:12552336e5},{e:127035e7,s:12866832e5},{e:13048236e5,s:13138992e5},{e:13356684e5,s:13465584e5},{e:1367118e6,s:13786128e5},{e:13985676e5,s:14100624e5}]},{name:"America/Sao_Paulo",rules:[{e:12032136e5,s:12243852e5},{e:12346632e5,s:12558348e5},{e:12667176e5,s:12872844e5},{e:12981672e5,s:1318734e6},{e:13302216e5,s:13507884e5},{e:13610664e5,s:1382238e6},{e:1392516e6,s:14136876e5}]},{name:"Asia/Amman",rules:[{e:1225404e6,s:12066552e5},{e:12568536e5,s:12381048e5},{e:12883032e5,s:12695544e5},{e:13197528e5,s:13016088e5},!1,!1,{e:14147064e5,s:13959576e5}]},{name:"Asia/Damascus",rules:[{e:12254868e5,s:120726e7},{e:125685e7,s:12381048e5},{e:12882996e5,s:12701592e5},{e:13197492e5,s:13016088e5},{e:13511988e5,s:13330584e5},{e:13826484e5,s:1364508e6},{e:14147028e5,s:13959576e5}]},{name:"Asia/Dubai",rules:[!1,!1,!1,!1,!1,!1,!1]},{name:"Asia/Gaza",rules:[{e:12199572e5,s:12066552e5},{e:12520152e5,s:12381048e5},{e:1281474e6,s:126964086e4},{e:1312146e6,s:130160886e4},{e:13481784e5,s:13330584e5},{e:13802292e5,s:1364508e6},{e:1414098e6,s:13959576e5}]},{name:"Asia/Irkutsk",rules:[{e:12249576e5,s:12068136e5},{e:12564072e5,s:12382632e5},{e:12884616e5,s:12697128e5},!1,!1,!1,!1]},{name:"Asia/Jerusalem",rules:[{e:12231612e5,s:12066624e5},{e:1254006e6,s:1238112e6},{e:1284246e6,s:12695616e5},{e:131751e7,s:1301616e6},{e:13483548e5,s:13330656e5},{e:13828284e5,s:13645152e5},{e:1414278e6,s:13959648e5}]},{name:"Asia/Kamchatka",rules:[{e:12249432e5,s:12067992e5},{e:12563928e5,s:12382488e5},{e:12884508e5,s:12696984e5},!1,!1,!1,!1]},{name:"Asia/Krasnoyarsk",rules:[{e:12249612e5,s:12068172e5},{e:12564108e5,s:12382668e5},{e:12884652e5,s:12697164e5},!1,!1,!1,!1]},{name:"Asia/Omsk",rules:[{e:12249648e5,s:12068208e5},{e:12564144e5,s:12382704e5},{e:12884688e5,s:126972e7},!1,!1,!1,!1]},{name:"Asia/Vladivostok",rules:[{e:12249504e5,s:12068064e5},{e:12564e8,s:1238256e6},{e:12884544e5,s:12697056e5},!1,!1,!1,!1]},{name:"Asia/Yakutsk",rules:[{e:1224954e6,s:120681e7},{e:12564036e5,s:12382596e5},{e:1288458e6,s:12697092e5},!1,!1,!1,!1]},{name:"Asia/Yekaterinburg",rules:[{e:12249684e5,s:12068244e5},{e:1256418e6,s:1238274e6},{e:12884724e5,s:12697236e5},!1,!1,!1,!1]},{name:"Asia/Yerevan",rules:[{e:1224972e6,s:1206828e6},{e:12564216e5,s:12382776e5},{e:1288476e6,s:12697272e5},{e:13199256e5,s:13011768e5},!1,!1,!1]},{name:"Australia/Lord_Howe",rules:[{e:12074076e5,s:12231342e5},{e:12388572e5,s:12545838e5},{e:12703068e5,s:12860334e5},{e:13017564e5,s:1317483e6},{e:1333206e6,s:13495374e5},{e:13652604e5,s:1380987e6},{e:139671e7,s:14124366e5}]},{name:"Australia/Perth",rules:[{e:12068136e5,s:12249576e5},!1,!1,!1,!1,!1,!1]},{name:"Europe/Helsinki",rules:[{e:12249828e5,s:12068388e5},{e:12564324e5,s:12382884e5},{e:12884868e5,s:1269738e6},{e:13199364e5,s:13011876e5},{e:1351386e6,s:13326372e5},{e:13828356e5,s:13646916e5},{e:14142852e5,s:13961412e5}]},{name:"Europe/Minsk",rules:[{e:12249792e5,s:12068352e5},{e:12564288e5,s:12382848e5},{e:12884832e5,s:12697344e5},!1,!1,!1,!1]},{name:"Europe/Moscow",rules:[{e:12249756e5,s:12068316e5},{e:12564252e5,s:12382812e5},{e:12884796e5,s:12697308e5},!1,!1,!1,!1]},{name:"Pacific/Apia",rules:[!1,!1,!1,{e:13017528e5,s:13168728e5},{e:13332024e5,s:13489272e5},{e:13652568e5,s:13803768e5},{e:13967064e5,s:14118264e5}]},{name:"Pacific/Fiji",rules:[!1,!1,{e:12696984e5,s:12878424e5},{e:13271544e5,s:1319292e6},{e:1358604e6,s:13507416e5},{e:139005e7,s:1382796e6},{e:14215032e5,s:14148504e5}]},{name:"Europe/London",rules:[{e:12249828e5,s:12068388e5},{e:12564324e5,s:12382884e5},{e:12884868e5,s:1269738e6},{e:13199364e5,s:13011876e5},{e:1351386e6,s:13326372e5},{e:13828356e5,s:13646916e5},{e:14142852e5,s:13961412e5}]}]},"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=a:"undefined"!=typeof define&&null!==define&&null!=define.amd?define([],function(){return a}):"undefined"==typeof e?window.jstz=a:e.jstz=a}();
Popup = (function(){
	var _lastShownTime;


	function insertHtml(html, $insertBefore)
	{
		// Remove if one exists already
		$('#popup-content.inline-popup').remove();
		$('<div id="popup-content" class="inline-popup" />')
							.html(html)
							.insertBefore($insertBefore);
	}

	function showHtml(html, cb)
	{
		_lastShownTime = new Date();
		$('#popup-content').html(html);
		$('.content').addClass('animating-popup').addClass('showing-popup');
		if ($('.content').is(':visible')) {
			$('#popup').slideDown();
		} else {
			$('#popup').show();
		}

		$('#popup-content a.popup-link').click(function (ev) {
			ev.preventDefault();
			showUrl($(ev.currentTarget).attr('href') + '&popup=1&ajax=1');
		});

		// Go to top
		$('body, html').animate({ scrollTop: '0px' }, 150);
		if (typeof Acuity.Embed != 'undefined') {
			Acuity.Embed.scrollTop();
		}

		if (typeof cb == 'function') {
			setTimeout(function () { cb($('#popup-content')); }, 0);
		}
	}

	function showUrl(url, cb)
	{
		showHtml(Acuity.Config.loadingHtml);
		$.get(url)
			.done(function (data) {
				showHtml(data, cb);
		}).fail(function() {
			showHtml('Error, failed to load. Please try again.');
		});
	}

	function hide(onlyHideBigPopup)
	{
		$('.content').removeClass('showing-popup');
		if (!onlyHideBigPopup) $('#popup-content.inline-popup').remove();
		$('#popup').slideUp(function () {
			$('.content').removeClass('animating-popup');
			$('#popup-content').html('');
		});
	}


	function isVisible()
	{
		// Firefox doesn't set visible immediately for redirect in PayPal, use recent times for that
		return $('.inline-popup').is(':visible') || $('#popup').is(':visible') || (_lastShownTime && (new Date()-_lastShownTime)<500 );
	}


	$('#popup').on('click', '.close-popup', function () {
		hide(true);
	});

	$('a.popup-link').click(function (ev) {
		ev.preventDefault();
		showUrl($(ev.currentTarget).attr('href') + '&popup=1&ajax=1');
	});

	$(document).keyup(function(e) {
		// Escape pressed
		if (e.keyCode == 27) {
			hide(true);
		}
	});

	return {
		insertHtml: insertHtml,
		showHtml: showHtml,
		showUrl: showUrl,
		hide: hide,
		isVisible: isVisible
	}
})();
/**
 * Handle the logic of going between different steps
 */

var StepsHelpers = {
	error: function (msg, goToStep) {
		goToStep('pick-appointment');
		$('.error-flash').html(msg).show();
		$(document).scrollTop(0);
	},

	next: function (getCurrentStepName, goToStep) {
		$('.error-flash').hide();
		var currentStepName = getCurrentStepName();
		var nextStep = currentStepName;

		if (currentStepName == 'pick-appointment') {
			// go to forms
			nextStep = 'forms';
		}

		if (currentStepName == 'forms') {
			nextStep = 'confirmation';
		}

		goToStep(nextStep);
	},

	initNextStep: function (nextStep) {
		var initFunc = null
		if (nextStep == 'forms') {
			// defer init until after all actions complete here
			initFunc = Acuity.Forms.init;
		} else if (nextStep == 'pick-appointment') {
			initFunc = Acuity.PickAppointment.init;
		} else if (nextStep == 'confirmation') {
			initFunc = Acuity.Confirmation.init;
		}

		if (initFunc) setTimeout(initFunc, 0);

		// trigger step changed
		$(window).trigger('acuity:stepChanged', [nextStep]);
	},

	attachDefaultEvents: function (goToStep, getCurrentStepName) {
		$('.steps .step-pick-appointment a, .change-pick-appointment').click(function (ev) {
			// go to it...
			var currentStep = getCurrentStepName();
			goToStep('pick-appointment');
			if (currentStep != 'confirmation') {
				ev.preventDefault();
			}
		});
		$('body').on('click', '.change-pick-appointment', function (ev) {
			// go to it...
			goToStep('pick-appointment');
		});
	}
};

/**
 * This is for something like the weekly view, where all step panes are visible and no breadcrumbs
 */
function stepsVisibleStepper()
{
	function getCurrentStepName() {
		return $('.pane-content:visible').closest('[data-step]').data('step');
	}

	function goToStep(nextStep) {
		$('.pane-content').hide();
		$('.pane-collapsed').show();
		
		StepsHelpers.initNextStep(nextStep);

		$('[data-step="'+nextStep+'"] .pane-content').show();
		$('[data-step="'+nextStep+'"] .pane-collapsed').hide();
	}

	function next() {
		return StepsHelpers.next(getCurrentStepName, goToStep);
	}

	StepsHelpers.attachDefaultEvents(goToStep, getCurrentStepName);
	$('body').on('click', '.btn-next-step', function (ev) {
		ev.preventDefault();
		next();
	});

	return {
		next: next,
		error: function (msg){return StepsHelpers.error(msg, goToStep);}
	};
}

 /**
  * This is for something like the monthly view, where a breadcrumb top is shown and all step pages are hidden
  */
function stepsHiddenStepper()
{
	function goToStep(nextStep) {
		// clear everything...
		$('.step-container').hide();
		$('.steps .active').removeClass('active');

		StepsHelpers.initNextStep(nextStep);

		$('[data-step="'+nextStep+'"]').show();
		$('.steps .step-'+nextStep).addClass('active');
	}

	function getCurrentStepName() {
		var $currentStep = $('.step-container:visible');
		return $currentStep.attr('data-step');
	}

	function next() {
		return StepsHelpers.next(getCurrentStepName, goToStep);
	}

	StepsHelpers.attachDefaultEvents(goToStep, getCurrentStepName);
	$('body').on('click', '.btn-next-step', function (ev) {
		ev.preventDefault();
		$(document).scrollTop(0);
		next();
	});

	return {
		next: next,
		error: function (msg){return StepsHelpers.error(msg, goToStep);}
	};
}

if ($('.all-steps-visible').length) {
	Steps = stepsVisibleStepper();
} else {
	Steps = stepsHiddenStepper();
}

Acuity.Subscription = (function () {
	function initPaymentForm($container)
	{
		Acuity.CreditCard.initPaymentContainer($container);
	}

	$('.btn-set-subscription-billing').click(function (ev) {
		ev.preventDefault();
		Popup.showHtml($('#change-payment-template').html(), initPaymentForm);
	});
})();
Timezone = (function(){
    function getTimezoneName() {
        var tz = jstz.determine();

        if (!tz) {
            return '';
        }

        var name = tz.name();
        if (typeof Intl == 'undefined' || typeof Intl.DateTimeFormat == 'undefined') {
            // No intl support, resolve ambiguous zones in favor of business

            // jstz detects Shanghai, could be Perth or Singapore
            if (name == 'Asia/Shanghai' && (ownerTz == 'Australia/Perth' || ownerTz == 'Asia/Singapore')) {
                return ownerTz;
            }
        }

        return name;
    }

    function shouldDetectTimezone()
    {
        return typeof requireTZ!='undefined' && requireTZ && autodetect_timezone;
    }

    return {
        getTimezoneName: getTimezoneName,
        shouldDetectTimezone: shouldDetectTimezone
    }
})();
var locales = {
	en: {
		weekdays: 'Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday'.split('_'),
		months: 'January_February_March_April_May_June_July_August_September_October_November_December'.split('_'),
		dateEndings: 'th_st_nd_rd_th_th_th_th_th_th_th_th_th_th_th_th_th_th_th_th_th_st_nd_rd_th_th_th_th_th_th_th_st'.split('_'),
		ampm: true
	}
};

function getCurrentLocale() {
	if (typeof LOCALE == 'undefined') return 'en';
	if (LOCALE_SETTINGS && typeof locales[LOCALE]=='undefined') {
		locales[LOCALE] = LOCALE_SETTINGS;
	}
	return (!! locales[LOCALE] ? LOCALE : 'en');
}

function getLocaleDateFormat() {
	if (typeof locales[getCurrentLocale()]['dateFormat'] != 'undefined') {
		return locales[getCurrentLocale()]['dateFormat'];
	} else {
		return '%m %d, %y';
	}
}

var FriendlyDates = (function () {
	var currentLocale = getCurrentLocale();

	return {
		dateEnding: (locales[currentLocale].dateEndings || ['','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','']),
		months: locales[currentLocale].months,
		weekday: locales[currentLocale].weekdays
	}
})();


function formatTimeForHuman(d)
{
	if (!d) return '';
	
	if (typeof d == 'string') {
		if (d.toLowerCase().indexOf('am')>-1 || d.toLowerCase().indexOf('pm')>-1 || d.toLowerCase().indexOf('a.m.')>-1 || d.toLowerCase().indexOf('p.m.')>-1) {
			return d;
		}
		var parts = d.split(/:/);
		if (parts.length != 2) {
			return d;
		}

		d = new Date();
		d.setUTCHours(parts[0]);
		d.setUTCMinutes(parts[1]);
	}
	var ampm = '';
	
	var min = ''+d.getUTCMinutes();
	if (min.length == 1) {
		min = '0' + min;
	}
	var hour = d.getUTCHours();

	if (locales[getCurrentLocale()].ampm) {
		if (hour > 12) {
			hour -= 12;
		}

		ampm = d.getUTCHours()<12 ? 'am' : 'pm';
	}
	
	
	return hour+':'+min+ampm;
}


function newUTCDate(year, month, day)
{
	return new Date(year, month, day, (-(new Date(year, month, day).getTimezoneOffset())/60)+1, 0, 0, 0);
}

function dateObjectFromString(d) {
	if (!d) return d;
	
	var parts = d.split(/-/);
	if (parts.length != 3) {
		return null;
	}
	var d = newUTCDate(parts[0], parts[1]-1, parts[2]);
	return d;
}
function formatDateForHuman(d)
{
	if (typeof d == 'string') {
		var dt = dateObjectFromString(d);
	} else {
		var dt = d;
	}
	
	if (!dt) {
		return d;
	}

	var month = FriendlyDates.months[dt.getUTCMonth()];
	var date = dt.getUTCDate();
	var year = dt.getUTCFullYear();

	return getLocaleDateFormat().replace('%y', year).replace('%d', date).replace('%m', month)
								.replace('%Y', year).replace('%e', date).replace('%B', month);
}


function formatForTimeElement(d)
{
	if (!d) return '';

	var ampm = d.getUTCHours()<12 ? 'am' : 'pm';
	var min = ''+d.getUTCMinutes();
	if (min.length == 1) {
		min = '0' + min;
	}
	var hour = ''+d.getUTCHours();
	if (hour.length == 1) {
		hour = '0' + hour;
	}
	
	return hour+':'+min;
}
var Acuity = Acuity || {};

Acuity.FormUtilities = Acuity.FormUtilities || {};
/**
 * Make sure all required fields filled in
 */
Acuity.FormUtilities.validate = function ($container)
{
	var isValid = true;

	$container.find('.required-field:visible').each(function () {
		// Find the inputs in this form-group
		//	even all of the different types
		var allCompleted = true;
		$(this).find('select, textarea, input[type="email"], input[type="text"], input[type="hidden"]').each(function () {
			if (!$(this).val()) allCompleted = false;
		});

		// If there are radios/checkboxes, but they're not checked, that's a problemo
		if ($(this).find('input[type="checkbox"], input[type="radio"]').length > 0
			&& $(this).find('input[type="checkbox"]:checked, input[type="radio"]:checked').length ==0)
		{
			allCompleted = false;
		}

		// manually marked as error?
		if (allCompleted && !$(this).attr('data-is-manual-error')) {
			// all good
			$(this).removeClass('has-error');
		} else {
			// not all good
			$(this).addClass('has-error');
			isValid = false;
		}
	});

	return isValid;
};
(function (){
	// Just for the loading button
	$('.checkout-container').submit(function (ev) {
		$('.checkout-container .btn-primary[data-loading-text]').button('loading');
	});

	if (!$('#ccnumber').val()) {
		$('#ccnumber').focus();
	}

	var requestCardNonce = function () {};
	var nonceReceivedCallback = function (nonce) {};

	var initSquarePayments = function (applicationId) {
		if (typeof paymentForm != 'undefined') paymentForm.destroy();

		paymentForm = new SqPaymentForm({
			applicationId: applicationId,
			inputClass: 'sq-input',
			inputStyles: [
			  {
			    fontSize: '15px'
			  }
			],
			cardNumber: {
			  elementId: 'ccnumber',
			  placeholder: '•••• •••• •••• ••••'
			},
			cvv: {
			  elementId: 'cvv2',
			  placeholder: 'CVV'
			},
			expirationDate: {
			  elementId: 'sq-expiration-date',
			  placeholder: 'MM/YY'
			},
			postalCode: {
			  elementId: 'billing-zip'
			},
			callbacks: {
			  cardNonceResponseReceived: function(errors, nonce, cardData) {
			    if (errors) {
			      // handle errors
			      var errorMessage = '';
			      errors.forEach(function(error) { errorMessage += error.message + '<br />\n'; });

			      $('#general-credit-card-error').html(errorMessage).show();
			      $('.btn-primary').button('reset');
			      $('[name="ccnumber"]').val('');
			    } else {
			      // handle nonce
			      $('#general-credit-card-error').hide();
			      $('.credit-card-form .has-error').removeClass('has-error');
			      $('[name="ccnumber"]').val(nonce);
			      $('[name="zip"]').val(cardData['billing_postal_code']);
			      nonceReceivedCallback(nonce);
			      
			    }
			  },
			  unsupportedBrowserDetected: function() {
			    $('#general-credit-card-error').html('Cannot enter credit cards through Square, your browser is not supported.').show();
			  },
			  inputEventReceived: function(inputEvent) {
			  	// Something changed? Reset nonce
			  	$('[name="ccnumber"]').val('');
			  	$('#new-credit-card-container .has-error').removeClass('has-error');

			    switch (inputEvent.eventType) {
			      case 'focusClassAdded':
			        // Handle as desired
			        break;
			      case 'focusClassRemoved':
			        // Handle as desired
			        break;
			      case 'errorClassAdded':
			        // Handle as desired
			        break;
			      case 'errorClassRemoved':
			        // Handle as desired
			        break;
			      case 'cardBrandChanged':
			        // Handle as desired
			        break;
			      case 'postalCodeChanged':
			        // Handle as desired
			        break;
			    }
			  }
			}
		});

		paymentForm.build();

		requestCardNonce = function () {
			paymentForm.requestCardNonce();
		}


		// Create the field to accept the nonce...
		if ($('[name="ccnumber"]').length == 0) {
			$('#ccnumber').after('<input type="hidden" name="ccnumber" value="" />');
		}
		if ($('[name="zip"]').length == 0) {
			$('#billing-zip').after('<input type="hidden" name="zip" value="" />');
		}
		if ($('[name="cvv2"]').length == 0) {
			$('#cvv2').after('<input type="hidden" name="cvv2" value="n/a" />');
		}

		$('form.checkout-container').submit(function (ev) {
			// Get nonce if we don't have it, submit when we do
			if (!$('[name="ccnumber"]').val()) {
				ev.preventDefault();
				nonceReceivedCallback = function () {$('form.checkout-container').submit();};
				requestCardNonce();
			}
		});

		$('.square-loading-indicator').hide();
		$('.credit-card-form').show();
	};

	function initSquare() {
		if (typeof squareApplicationId!='undefined') {
			async('https://js.squareup.com/v2/paymentform', function () {
				initSquarePayments(squareApplicationId);
			});
		}
	}

	function isUsingSquare()
	{
		return $('.sq-input').length > 0;
	}

	// This will only init on payment page
	initSquare();
})();

Acuity.Certificate = (function () {
	function showCertificateInput($btn)
	{
		var $group = $btn.closest('div');

		$btn.hide();
		$group.find('.certificate-input').show();
		var $input = $group.find('.certificate-input input').focus();

		if (!getCertificate() && $('.redeem-email-message').is(':visible')) {
			// Default to redeeming email
			$input.val($('#email').val()).change();
		}

		// Load up past codes if logged in...
		if (typeof currentClient != 'undefined') {
			$pastCodes = $group.find('.past-codes').html(Acuity.Config.loadingHtml);
			var params = {
				action: 'getCodes',
				owner: $('#owner').val(),
				email: currentClient.email,
				type: Acuity.PickAppointment.getType()
			};

			if (SID) {
				var sidParts = SID.split('=');
				params[sidParts[0]] = sidParts[1];
			}

			$.get('/schedule.php', params).done(function (data) {
				try {
					var codes = JSON.parse(data);
					var html = '';

					// Show the codes to the user
					for (var i=0; i<codes.length; i++) {
						// Only 1? No need to show it,  it's in the box
						html += '<div class="code-hint-container">';
						if (codes.length > 1) html += '<em>' + codes[i].code + '</em> ';
						html += codes[i].name + '<br />';
						if (codes[i].expires && codes.length > 1) {
							html += '<div class="small"><span class="code-expires">Expires:</span> ' + formatDateForHuman(codes[i].expires) + '</div>';
						}
						html += '</div>';
					}
					$pastCodes.html(html);

					if (!$input.val() && codes.length) {
						$input.val(codes[codes.length-1].code).change();
					}
				} catch (e) {
					$pastCodes.html('');
				}
			}).fail(function () {
				$pastCodes.html('');
			});
		}
	}

	function getCertificate()
	{
		return $('#certificate').val();
	}

	function setCertificate(val)
	{
		showCertificateInput($('.forms-action-container .show-certificate-input'));
		$('.certificate-field').val(val);
		checkCertificateCode($('.forms-action-container .certificate-input'));
	}

	$('#appointment-form').on('click', '.show-certificate-input', function (ev) {
		ev.preventDefault();
		showCertificateInput($(ev.currentTarget));
	});


	$('#appointment-form').on('keyup change', '.certificate-input', function (ev) {
		var $group = $(ev.currentTarget);
		$group.find('.certificate-apply-btn').show();

		// Make sure all other inputs always have the same values
		var $changedField = $group.find('.certificate-field');
		$('.certificate-field').not($changedField).each(function () {
			if ($(this).val() != $changedField.val()) {
				$(this).val($changedField.val());
				// Also make sure the closest button is gone and this is showing
				showCertificateInput($(this).closest('.pane').find('.show-certificate-input'));
			}
		});
	});

	$('.pick-appointment-pane .certificate-field').on('change', function (ev) {
		// Just on the first certificate input, if it is an email make sure that the email address matches and can't be edited
		var val = $(this).val();
		if (isEmailValid(val)) {
			$('#email').val(val);
		}
	});


	function revertToOriginalPrices()
	{
		$('.has-discounted-price')
				.removeClass('has-discounted-price')
				.find('.discounted-price')
				.remove();
	}


	function setDiscountedPrices(typePrices)
	{
		// Show the discounted prices
		for (var id in typePrices) {
			var $priceContainer = $('label[for="appointmentType-'+id+'"]').find('.price');
			var $discountedPrice = $priceContainer.addClass('has-discounted-price').find('.discounted-price');
			if ($discountedPrice.length == 0) {
				var $discountedPrice = $('<span class="discounted-price" />').appendTo($priceContainer);
			}
			$discountedPrice.html(typePrices[id]);
		}

		$(document).trigger('acuity:changeSummary');
	}


	function reloadCustomFormAction($group)
	{
		// Only reload if we just entered on the forms page, and the value set in the HTML is different than the value there now
		//	(if it is, we already submitted it)
		var $certificateField = $group.find('.certificate-field');
		var $container = $group.closest('.forms-action-container');
		if ($container.length == 0 || $certificateField.val() == $certificateField.attr('value')) {
			return;
		}

		// Reload it to apply the pricing!
		Acuity.Forms.reloadFormButtons();
	}


	var lastCheckValue = '';
	var lastCheckType = '';
	function checkCertificateCode ($group) {
		if (typeof $group == 'undefined' || typeof $group.find != 'function') {
			$group = $('.certificate-input').first();
		}
		
		var $certificateInput = $group.find('.certificate-field');

		if ($group.length == 0 || $certificateInput.length == 0) {
			return;
		}

		if (typeof Acuity.PickAppointment == 'undefined' || typeof Acuity.PickAppointment.getType != 'function') {
			return;
		}

		var code = $certificateInput.val().trim();
		if (lastCheckValue == code && lastCheckType == Acuity.PickAppointment.getType() ) {
			return;
		}

		var $help = $group.find('.help-block-generic');
		$group.find('.form-control-feedback').hide();
		$group.removeClass('has-success').removeClass('has-error');
		$help.hide();

		if (!code) {
			// blur with no val? hide it
			$('.show-certificate-input').show();
			$('.certificate-input').hide();
			return;
		}

		revertToOriginalPrices();

		lastCheckValue = code;
		lastCheckType = Acuity.PickAppointment.getType();

		// validate!
		$.get('/schedule.php', {
			action: 'checkCode',
			owner: $('#owner').val(),
			type: Acuity.PickAppointment.getType(),
			code: code
		}).done(function (data) {
			try {
				var result = JSON.parse(data);
				if (result.error) {
					$group.addClass('has-error').addClass('has-feedback');
					$group.find('.feedback-error').show();
					$help.text(result.message).show();
				} else {
					$group.addClass('has-success').addClass('has-feedback');
					$group.find('.feedback-success').show();
					$group.find('.certificate-apply-btn').hide();
					$help.html('<div class="certificate-amount-remaining">'+result.remaining+'</div>').show();
					setDiscountedPrices(result['types']);

					reloadCustomFormAction($group);
				}
			} catch (ex) {
				lastCheckValue = '';
			}
		}).fail(function () {
			lastCheckValue = '';
		});
	}

	$('#appointment-form').on('click', '.certificate-apply-btn', function (ev) {
		ev.preventDefault();
		checkCertificateCode($(ev.currentTarget).closest('.certificate-input'));
	});
	$('#appointment-form').on('blur', '.certificate-field', function (ev) {
		checkCertificateCode($(ev.currentTarget).closest('.certificate-input'));
	});
	$(document).on('acuity:forms-loaded', function () {
		checkCertificateCode($('.forms-action-container .certificate-input'));
	});

	/**
	 * For the user display
	 */
	$('.content').on('click', '.btn-show-certificate-amount-remaining', function (ev) {
		ev.preventDefault();
		var $target = $(ev.currentTarget);
		$target.closest('.show-certificate-amount-remaining-btn-container').hide();
		$target.closest('li').find('.certificate-amount-remaining').show();
	});


	return {
		checkCertificateCode: checkCertificateCode,
		setCertificate: setCertificate,
		getCertificate: getCertificate
	};
})();
Acuity.Confirmation = (function() {
	/**
	 * Show popup to confirm cancellation
	 */
	function confirmCancel(href)
	{
		var html = '<p>Are you sure you want to cancel this appointment?</p><a href="'+href+'" class="btn btn-primary">Yes, cancel appointment</a> <a href="#" class="margin-left btn btn-link close-popup">No, don\'t cancel</a>';
		Popup.showHtml(html);
	}


	/**
	 * Validate registration
	 */
	function initClientRegister($container)
	{
		var $form = $container.find('form');
		$error = $form.find('.error-msg');
		$form.submit(function (ev) {
			$error.html('').hide();

			var error = '';
			if (!$('#username').val().trim()) {
				error += 'Please enter a username<br />';
			}

			if (!$('#password').val().trim()) {
				error += 'Please enter a password<br />';
			}

			if ($('#password').val() != $('#password_confirm').val()) {
				error += 'Passwords do not match<br />';
			}

			if (error) {
				ev.preventDefault();
				$error.html(error).show();
			}
		});
	}


	/**
	 * Validate payments
	 */
	function initPayment($container)
	{
		Acuity.CreditCard.initPaymentContainer($container);
	}


	/**
	 * Handle fancy rescheduling
	 */
	function initReschedule($container)
	{
		function showTimesHtml(html) {
			$container.find('.reschedule-choose-time-container').show();
			$container.find('.reschedule-choose-time').html(html);
		}

		function clearTimes() {
			$container.find('.reschedule-choose-time-container, .reschedule-choose-time-actions').hide();
			$container.find('.reschedule-choose-time').html('');
		}

		function timesLoaded(data) {
			if (typeof data == 'undefined') {
				showTimesHtml('Unable to load times, please try again');
			} else {
				showTimesHtml(data);
			}
		}

		function dateSelected(date) {
			$container.find('#reschedule-date').val(date);
			showTimesHtml(Acuity.Config.loadingHtml);
		}

		/**
		 * Show reschedule button on time select.
		 *
		 * Listen to click event instead.  At the end, send a message to select the item.
		 * SamsungBrowser had some issues with the change event.
		 *
		 * https://trello.com/c/HdYdSGXX/2671-timezone-not-showing-on-android-bug
		 */
		$('.reschedule-choose-time').on('click', 'input, label', function (ev) {
			// allow reschedule
			$container.find('.reschedule-choose-time-actions').show();
		});

		// Or, in the weekly view where times are shown right away...
		$('.reschedule-choose-date-time').on('click', '.choose-time input[type="radio"], .choose-time label', function (ev) {
			// allow reschedule
			$('.reschedule-choose-date-time .choose-time-actions').remove();

			var $target = $(ev.currentTarget);
			if ($target.is('input')) {
				$target = $target.next('label');
			}

			var actions = $('<div class="choose-time-actions" />').html($('.reschedule-choose-time-actions').html())
				.css({
					left: $target.position().left + 'px'
				});
			
			$target.after(actions);
		});

		$container.find('.reschedule-form').submit(function (ev){
			$container.find('.reschedule-btn').button('loading');
		});

		var acuityCalendar = new Acuity.Calendar({
			$calendar: $container.find('.choose-date'),
			clearTimes: clearTimes,
			getType: function () { return currentAppointment.type; },
			getCalendar: function () { return currentAppointment.calendar; },
			timesLoaded: timesLoaded,
			dateSelected: dateSelected,
			getTimezone: function () { return currentAppointment.timezone; },
			ignoreAppointment: currentAppointment.id
		});

		acuityCalendar.loadCalendar(currentAppointment.time);
	}


	/**
	 * Edit forms on appointment
	 */
	function initEditForms($container)
	{
		// TODO: validate required fields completed before enabling submit
		Acuity.Focus.init($container);

		$container.find('form').on('submit', function (ev) {
			if (!Acuity.FormUtilities.validate($container)) {
				ev.preventDefault();

				$firstError = $container.find('.has-error:first');
				$('body, html').animate({ scrollTop: $firstError.offset().top + 'px' }, 150);
				$firstError.find('textarea, input:first').focus();
			}
		});
	}


	/**
	 * Are we on the confirmation step?
	 */
	function isOnConfirmationStep()
	{
		return $('.schedule-confirmation-loaded').length > 0;
	}


	function showPaymentForm()
	{
		var template = $('#payment-template').html();
		if (!template) return;
		Popup.showHtml(template, initPayment);
	}
	

	function init()
	{
		// Start at the top
		var $anchor = $('a[name="completed"]');
		$('body, html').scrollTop($anchor.length>0 ? $anchor.offset().top : 0);

		$('#appt-cancel').click(function (ev) {
			var href = $(ev.currentTarget).attr('data-confirm-href');
			confirmCancel(href);
		});

		$('#client-edit-forms').click(function (ev) {
			Popup.showHtml($('#edit-forms-template').html(), initEditForms);
		});


		$('.client-register-btn').click(function (ev) {
			ev.preventDefault();
			Popup.showUrl($(ev.currentTarget).attr('href'), initClientRegister);
		});

		$('#appt-reschedule').click(function (ev) {
			Popup.showHtml($('#reschedule-template').html(), initReschedule);
		});


		$('#appt-pay').click(showPaymentForm);
		if (document.location.href.indexOf('#payment') > -1) {
			showPaymentForm();
		}

		if (isOnConfirmationStep()) {
			var newText = 'Confirmed!';
			$('.step-confirmation a').attr('data-original-text', newText).text(newText);

			// Once we schedule, don't allow changing the first step via icon (misleading that it is rescheduling, when it is scheduling new)
			//	make it explicit
			$('.pane-collapsed .change-pick-appointment, .pane-collapsed .appt-summary-pane').hide();
			$('#confirm-schedule-new-appointment').show();
		}

		$(document).trigger('acuity:stepLoaded');
	}

	init();

	return {
		init: init,
		isOnConfirmationStep: isOnConfirmationStep
	};
})();

var Acuity = Acuity || {};

(function() {
	function setTip(tipAmount) {
		tipAmount = parseFloat(tipAmount.replace('$', ''));
		if (!tipAmount || tipAmount<=0) {
			tipAmount = 0.00;
		}

		var baseAmount = $('#label-total-amount').attr('data-base-total');
		$('#value-total-amount').text( (parseFloat(baseAmount) + tipAmount).toFixed(2) );
	}

	// Tipping!
	$('body').on('change', 'input[name="tip[choice]"]', function (ev) {
		$current = $(ev.currentTarget);
		if ($current.val() != 'custom') {
			var tipAmount = $current.closest('.btn').find('.tip-value').text();
			$('#tip-amount').val(tipAmount);
			$('#tip-amount-container').hide().closest('.btn').addClass('tip-choice-fixed');
		} else {
			// show form for custom
			var tipAmount = $('#tip-amount').val();
			$('#tip-amount-container').show().closest('.btn').removeClass('tip-choice-fixed');
			$('#tip-amount').focus();
		}
		
		setTip(tipAmount);
	});

	// Did they choose a different source?
	$('body').on('change', 'input[name="paymentSource"]', function (ev) {
		if ($(ev.currentTarget).val() == 'new') {
			$('#new-credit-card-container').slideDown(200).find('input[value=""]').first().focus();
		} else {
			$('#new-credit-card-container').slideUp(200);
		}
	});

	$('body').on('keyup change', '#tip-amount', function (ev) {
		setTip($('#tip-amount').val());
	});

	$('body').on('click', '.show-what-is-cvv2', function (ev) {
		$('#what-is-cvv2').toggle();
		ev.preventDefault();
	});

	$('body').on('click', '.show-transaction-secure', function (ev) {
		$('#transaction-secure').toggle();
		ev.preventDefault();
	});


	/**
	 * Handle Square payments
	 */
	var requestCardNonce = function () {};

	var initSquarePayments = function (applicationId) {
		if (typeof paymentForm != 'undefined') paymentForm.destroy();

		paymentForm = new SqPaymentForm({
			applicationId: applicationId,
			inputClass: 'sq-input',
			inputStyles: [
			  {
			    fontSize: '15px'
			  }
			],
			cardNumber: {
			  elementId: 'ccnumber',
			  placeholder: '•••• •••• •••• ••••'
			},
			cvv: {
			  elementId: 'cvv2',
			  placeholder: 'CVV'
			},
			expirationDate: {
			  elementId: 'sq-expiration-date',
			  placeholder: 'MM/YY'
			},
			postalCode: {
			  elementId: 'billing-zip'
			},
			callbacks: {
			  cardNonceResponseReceived: function(errors, nonce, cardData) {
			    if (errors) {
			      // handle errors
			      var errorMessage = '';
			      errors.forEach(function(error) { errorMessage += error.message + '<br />\n'; });
			      // TODO: show error
			      $('#general-credit-card-error').html(errorMessage).show();
			      $('#popup .btn-primary, .payment-container .btn-primary').button('reset');
			      $('[name="ccnumber"]').val('');
			    } else {
			      // handle nonce
			      $('#general-credit-card-error').hide();
			      $('.credit-card-form .has-error').removeClass('has-error');
			      $('[name="ccnumber"]').val(nonce);
			      $('[name="zip"]').val(cardData['billing_postal_code']);
			      Acuity.CreditCard.nonceReceivedCallback(nonce);
			    }
			  },
			  unsupportedBrowserDetected: function() {
			    $('#general-credit-card-error').html('Cannot enter credit cards through Square, your browser is not supported.').show();
			  },
			  inputEventReceived: function(inputEvent) {
			  	// Something changed? Reset nonce
			  	$('[name="ccnumber"]').val('');
			  	$('#new-credit-card-container .has-error').removeClass('has-error');

			    switch (inputEvent.eventType) {
			      case 'focusClassAdded':
			        // Handle as desired
			        break;
			      case 'focusClassRemoved':
			        // Handle as desired
			        break;
			      case 'errorClassAdded':
			        // Handle as desired
			        break;
			      case 'errorClassRemoved':
			        // Handle as desired
			        break;
			      case 'cardBrandChanged':
			        // Handle as desired
			        break;
			      case 'postalCodeChanged':
			        // Handle as desired
			        break;
			    }
			  }
			}
		});

		paymentForm.build();

		requestCardNonce = function () {
			paymentForm.requestCardNonce();
		}


		// Create the field to accept the nonce...
		if ($('[name="ccnumber"]').length == 0) {
			$('#ccnumber').after('<input type="hidden" name="ccnumber" value="" />');
		}
		if ($('[name="zip"]').length == 0) {
			$('#billing-zip').after('<input type="hidden" name="zip" value="" />');
		}

		$('.square-loading-indicator').hide();
		$('.credit-card-form, .square-new-cc-container').show();
	};

	function initSquare($container) {
		var squareApplicationId = $('#squareApplicationId').val();
		if (typeof squareApplicationId!='undefined') {
			async('https://js.squareup.com/v2/paymentform', function () {
				initSquarePayments(squareApplicationId);
				$('#ccnumber').closest('.required-field').removeClass('required-field');
			});
		}
	}

	function isUsingSquare()
	{
		return $('.sq-input').length > 0;
	}


	Acuity.CreditCard = {
		nonceReceivedCallback: function (nonce) {},
		initSquare: initSquare,
		isUsingSquare: isUsingSquare,
		requestCardNonce: function () {
			requestCardNonce();
		},
		isNewCard: function () {
			return ($('[name="paymentSource"]:checked').val() == 'new' || $('[name="paymentSource"]').length==0);
		},
		validateCustomForm: function () {
			var $paymentSource = $('input[name="paymentSource"]');
			if ($paymentSource.length && !$paymentSource.filter(':checked').length) {
				$('.payment-source-list').addClass('has-error');
				$('#has-credit-card-error').show();
				return false;
			} else {
				$('.payment-source-list').removeClass('has-error');
				$('#has-credit-card-error').hide();
				return true;
			}
		},
		initPaymentContainer: function ($container) {
			Acuity.CreditCard.initSquare();

			$container.find('input[value=""]:first').focus();
			$container.find('form').submit(function (ev) {
				var $this = $(this);
				if (Acuity.CreditCard.validateCustomForm() && Acuity.FormUtilities.validate($container)) {
					// All good so far...
					if (!$('[name="ccnumber"]').val() && Acuity.CreditCard.isUsingSquare() && Acuity.CreditCard.isNewCard()) {
						ev.preventDefault();
						$container.find('input[type="submit"]').button('loading');
						Acuity.CreditCard.nonceReceivedCallback = function () {
							// Resubmit this once we have the nonce...
							$this.submit();
						};

						Acuity.CreditCard.requestCardNonce();
					} else {
						$container.find('input[type="submit"]').button('loading');
					}
				} else {
					$container.find('.has-error input').first().focus();
					ev.preventDefault();
				}
			});
		}
	};
})();
Acuity.Embed = (function () {
	function sendMessage(type, val)
	{
		window.parent.postMessage(type+':'+val, '*');
	}

	function isEmbedded() {
		try {
			var userAgent = window.navigator.userAgent.toLowerCase();
			var ios = /iphone|ipod|ipad/.test(userAgent);
			var safari = /safari/.test(userAgent);
			if (document.location.href.indexOf('notembedded=1') > 0) {
				return false;
			}

			return (
				(window.self !== window.top) || // Browser embedded
				(ios && !safari && !window.navigator.standalone) // iOS app embedded
				// I haven't seen a reliable way to detect android webviews
			);
		} catch (e) {
			return true;
		}
	}

	function watchHeightChange()
	{
		var lastHeight = 0;
		var lastUrl = document.location.href;

		function checkHeightChange(){
			var newHeight = Math.max(document.body.clientHeight, 200);

			var heightElements = ['.choose-time-container:visible', '#popup-content:visible'];
			for (var i=0; i<heightElements.length; i++) {
				var $el = $(heightElements[i]);

				if ($el.length) {
					newHeight = Math.max(newHeight, $el.height() + $el.offset().top);
				}
			}

			var heightDifference = newHeight-lastHeight;
			if( heightDifference>20 || heightDifference<-50 ) {
				sendMessage('sizing', (newHeight+38));
				lastHeight = newHeight;
			}

			if (lastUrl != document.location.href) {
				lastUrl = document.location.href;
				sendMessage('load', '');
			}
		}
		if (window.parent && typeof window.parent.postMessage == 'function') {
			setInterval(checkHeightChange, 300);
		}
	}

	$(window).on("message", function(ev) {
		var data = ev.originalEvent.data;
		if (data == 'acuity:init') {
			// We have communication with the parent!
			// Remove scrollbars, on resize the iframe can cause flickering
			$('html').css({
				overflow: 'hidden'
			});
		}
		if (data == 'acuity:modal') {
			// Modal embedding, go!
			$('body').addClass('is-modal');
		}
	});

	function scrollTop() {
		sendMessage('load', '');
	}

	function scrollTo($el) {
		sendMessage('scrollTo', $el.offset().top);
	}

	var exports = {
		scrollTop: scrollTop,
		scrollTo: scrollTo,
		isEmbedded: isEmbedded
	};

	// Collapsing the appt type list can change the height quite a bit, this should really scroll to that element, but instead just scroll to top
	$('.select-type').on('acuity:checked', function () {
		if ($('.select-type').height()*($('.select-type input[type="radio"]').length-1) > 400/*tall-ish, roughly 2 calendar heights*/) {
			sendMessage('scrollTo', $('.select-type').offset().top);
		}
	});

	// Not framed? Stop right here.
	if (!isEmbedded()) {
		return exports;
	}

	// All frames beyond this point...

	// watch for height changes and alert on that
	watchHeightChange();

	// change the style when embedded...
	$('body').addClass('is-embedded');

	return exports;
})();
Acuity.Forms = (function(){
	// style focus
	Acuity.Focus.init($('#step-forms'));

	/**
	 * Watch for submit of payment form
	 */
	function initPaymentForm($container)
	{
		// For authorize.net focus on address first
		if ($('textarea[name="address"]').focus().length == 0) {
			$('#ccnumber').focus();
		}

		var $form = $container.find('form');
		var $button = $container.find('.btn-primary');

		Acuity.CreditCard.initSquare($container);

		$container.find('.btn-cancel-payment').click(function (ev) {
			ev.preventDefault();
			hidePaymentForm();
		});

		$form.submit(function (ev) {
			var action = $form.attr('action');
			if (action.indexOf('https://') != -1) {
				// external submit, like paypal? handle normally
				return;
			}

			function doSubmit() {
				$.post(action+'&ajax=1&template='+TEMPLATE_NAME, $form.serialize())
					.done(function (data, textStatus, jqXHR) {
						handleSubmitResult(data, jqXHR);
					}).error(function () {
						$button.button('reset');
				});
			}

			ev.preventDefault();
			$button.button('loading');

			// If entering a new card, get the nonce before submitting (this validates too)
			if (Acuity.CreditCard.isUsingSquare() && Acuity.CreditCard.isNewCard()) {
				Acuity.CreditCard.nonceReceivedCallback = doSubmit;
				Acuity.CreditCard.requestCardNonce();
			} else {
				doSubmit();
			}
			
		});
	}


	/**
	 * Show the payment form
	 */
	function showPaymentForm(data, initPaymentForm)
	{
		$paymentContainer = $('.payment-container');

		if ($paymentContainer.length) {
			$paymentContainer
				.show()
				.find('.pane-content').html(data);

			$('.forms-action-container').hide();

			// Payment form showing, old actions hidden, scroll to it

			$('body, html').animate({ scrollTop: $paymentContainer.offset().top+"px" }, 200);

			initPaymentForm($paymentContainer);
		} else {
			return Popup.showHtml(data, initPaymentForm);
		}
	}

	function hidePaymentForm()
	{
		$paymentContainer = $('.payment-container');

		if ($paymentContainer.length) {
			$paymentContainer.hide();
			$('.forms-action-container').show();
		} else {
			return Popup.hide();
		}
	}

	function isPaying()
	{
		return Popup.isVisible() || $('.payment-container:visible').length>0;
	}


	/**
	 * Handle parsing result and setting next state
	 */
	function handleSubmitResult(data, jqXHR)
	{
		try {
			var result = JSON.parse(data);
			if (result.success) {
				hidePaymentForm();
				if (jqXHR && jqXHR.getResponseHeader('X-PJAX-URL') && typeof window.history!='undefined' && typeof window.history.pushState == 'function') {
					window.history.pushState({"html":data,"pageTitle": 'Appointment Confirmed'}, "", jqXHR.getResponseHeader('X-PJAX-URL'));
				}
				$('#step-confirmation').html(result.success);
				Steps.next();

				// Set up client information preview in collapsed pane for forms step
				$('#step-forms').closest('.step-pane').find('.pane-collapsed').text($('#first-name').val() + ' ' + $('#last-name').val() + ' ('+$('#email').val()+')');
			} else if(result.error) {
				hidePaymentForm();
				Steps.error(result.error);
			} else {
				hidePaymentForm();
				Steps.error('Failed to confirm appointment, unknown error, please try again.');
			}
		} catch (ex) {
			// Just for curiosity, is this ever _not_ a payment form?
			if (data.indexOf('action=complete_payment')>-1 || data.indexOf('paypal-redirect-identifier')>-1) {
				// Not json?
				//	more HTML for us to complete in this step for payment...
				showPaymentForm(data, initPaymentForm);
			} else {
				if (typeof trackJs=='function') {
					trackJs('Non-Payment showing popup, success index:' + data.indexOf('{"success"') + ' location:' + document.location.href);
				}
				window.location.reload();
			}
		}
	}

	/**
	 * Reload custom forms request, returns jquery xhr
	 */
	function requestCustomForms()
	{
		var serializedForms = $('#appointment-form').serialize();
		return $.post('/schedule.php?action=getForms&owner='+$('#owner').val()+'&template='+TEMPLATE_NAME+'&'+SID, serializedForms);
	}


	/**
	 * Just replace the forms-actions-container based on the current content, like if a certificate code was reapplied
	 */
	function reloadFormButtons()
	{
		requestCustomForms().done(function (data) {
			// data is all the forms, pluck out just the forms actions
			var $customForms = $('<div />').html(data);
			$('.forms-action-button-container').html($customForms.find('.forms-action-button-container'));
			initCustomForms();
		});
	}
	$(window).on('acuity:addons-changed', function (ev) {
		// Are buttons showing, and also add-ons showing that we can change? (Like on classes page)
		if ($('.forms-action-button-container').is(':visible')) {
			reloadFormButtons();
		}
	});

	/**
	 * Init everything, load the dynamic forms
	 */
	function init()
	{
		// Hide the "Upcoming Appointments" or other leftover alerts from first page
		$('.alert-success.dynamic-alert').hide();

		
		$('#custom-forms').html(Acuity.Config.loadingHtml);

		var loadingMessageTimer = setInterval(function () {
			// Did they fill in all the required fields?
			//	let 'em know the submit is coming
			if ($('#first-name, #last-name, #email').filter(function() {return $(this).val().trim()=='';} ).length == 0) {
				$('#custom-forms').html(Acuity.Config.loadingHtml + ' Still loading, you\'ll be able to confirm your appointment after this loads...');
			}		
		}, 5000);

		// Get any custom forms...
		requestCustomForms().done(function (data) {
			// Doing the clear here to avoid any potential race between this and always being called, is that even possible?
			clearInterval(loadingMessageTimer);
			$('#custom-forms').html(data);
			initCustomForms();
		}).fail(function (data) {
			$('#custom-forms').html('Failed to get custom forms. <a href="#" class="retry">Retry?</a>').on('click', '.retry', function () {
				init();
			});
		}).always(function () {
			clearInterval(loadingMessageTimer);
		});

		// Scroll embed to the step container
		Acuity.Embed.scrollTo($('#first-name').closest('[data-step]'));
		$('#first-name').focus();

		// Show the appointment summary at the top...
		$('#forms-appt-summary').html(Acuity.PickAppointment.getSummary());
		$(document).on('acuity:changeSummary', function () {
			if (!Acuity.PickAppointment.areTimesAvailable()) {
				$('#forms-appt-summary').html('No times are available. Please go back and choose a different time.');
				if ($('#forms-appt-summary').is(':visible')) {
					// are we on the forms page? go back...
					Steps.error('Your times are no longer available, please choose a new appointment time.');
				}
			} else {
				$('#forms-appt-summary').html(Acuity.PickAppointment.getSummary());
			}
		});

		$(document).trigger('acuity:stepLoaded');
	}


	

	/**
	 * Initialize form validation for custom stuff
	 */
	function initCustomForms()
	{
		// No submitting form directly!
		$('#appointment-form').submit(function (ev) {
			ev.preventDefault();
		});

		// Only submit through buttons
		var paymentButtonSelector = '.submit-forms-nopay, .submit-forms-payment, .submit-forms-deposit';
		$(paymentButtonSelector).click(function (ev) {
			if (Acuity.FormUtilities.validate($('#step-forms'))) {
				if (!quickValidateEmail()
					|| !validateCertificateCodeByEmail()
					) {
					ev.preventDefault();
					return;
				}

				// cool, send it!
				var $target = $(ev.currentTarget);
				$('.error-message-submit-failed').hide();
				$submitButton = $target.button('loading');

				var serializedForms = $('#appointment-form').serialize();

				// If they hit enter the first button, even if hidden, will be clicked
				//	instead default to first visible
				var $clickedTarget = ($target.is(':visible') ? $target : $(paymentButtonSelector).filter(':visible').first());

				// Include payment option picked
				if ($clickedTarget.hasClass('submit-forms-nopay')) {
					serializedForms += '&pay_later=1';
				} else if ($clickedTarget.hasClass('submit-forms-deposit')) {
					serializedForms += '&pay_deposit=1';
				} else if ($clickedTarget.hasClass('submit-forms-payment')) {
					serializedForms += '&payment=1';
				}

				if ($(ev.currentTarget).hasClass('pay-paypal')) {
					serializedForms += '&payment_paypal=1';
				}



				$.post('/schedule.php?action=confirm&ajax=1&owner='+$('#owner').val()+'&'+SID+'&template='+TEMPLATE_NAME, serializedForms
					)
				.done(function (data, textStatus, jqXHR) {
					handleSubmitResult(data, jqXHR);
				}).error(function () {
					$('.error-message-submit-failed').show();
				}).always(function () {
					$submitButton.button('reset');
				});
			} else {
				// err!
				$firstError = $('.has-error:first');
				$('body, html').animate({ scrollTop: $firstError.offset().top + 'px' }, 150);
				var $input = $firstError.find('textarea, input, select');
				if ($input.length == 1) {
					$input.focus();
				} else {
					$input.filter(function() { return this.value == ""; }).first().focus();
				}
			}
			ev.preventDefault();
		});

		$(document).trigger('acuity:forms-loaded');
	}


	/**
	 * Validate e-mail quickly, just a regex and some basics
	 */
	function quickValidateEmail()
	{
		var email = $('#email').val().toLowerCase();
		var $formGroup = $('#email').closest('.form-group');

		// If they renamed the label, then don't validate
		if ($formGroup.find('label').text().indexOf('mail') < 0) {
			return true;
		}

		if (email=='none' || email=='n/a' || email=='na' || isEmailValid(email)) {
			// It's valid!
			return true;
		} else {
			// it's invalid, show the error
			$formGroup.addClass('has-error')
					  .attr('data-is-manual-error', 'true')
					  .find('input').focus();
			$('#email-error-domain').hide();
			return false;
		}
	}

	/**
	 * Show the errors for an invalid e-mail, this does some fancy server side checking
	 */
	function handleValidateEmailResponse(data)
	{
		// only invalid if returned 0
		var result = false;
		try {
			result = JSON.parse(data);
		} catch (e) {
			// ...
			return;
		}

		if (!result.emailValid) {
			var email = $('#email').val();
			var $formGroup = $('#email').closest('.form-group');

			// it's invalid, show the error
			$formGroup.addClass('has-error');
			$formGroup.attr('data-is-manual-error', 'true');
			$('#email-error-help').show();

			// if they typed an @ then it's probably their domain that's incorrect
			if (email.indexOf('@')>-1) {
				$('#email-error-domain').show();
			} else {
				$('#email-error-domain').hide();
			}
		}

		if (result.codes && !Acuity.Certificate.getCertificate()) {
			// Let 'em know they can redeem something if they want
			$('.redeem-email-message').html(result.codes.message).show();
		} else {
			$('.redeem-email-message').hide();
		}

		$('.already-registered-warning').remove();
		if (result.timesValid === false && result.timesErrorMessage) {
			// Show the error message
			$('<div class="alert alert-warning already-registered-warning">'+result.timesErrorMessage+'</div>').insertBefore('.forms-action-container');
		}
	}


	/**
	 * If we're redeeming a certificate code by email,
	 * it _must_ match the email on the appt or it won't be able to be applied
	 */
	function validateCertificateCodeByEmail()
	{
		var $container = $('.forms-action-container .certificate-input');
		$container.removeClass('has-error');
		$container.find('.help-block-certificate-email').hide();

		var code = Acuity.Certificate.getCertificate();
		code = normalizeEmail(code);
		if (!isEmailValid(code) || !code) {
			return true;
		}

		// Ok, code is an email, does it match?
		var apptEmail = normalizeEmail($('#email').val());
		if (code == apptEmail) {
			return true;
		}

		// Code is an email and doesn't match, show our error and stop
		$container.removeClass('has-success').addClass('has-error');
		$container.find('.help-block-certificate-email').show();
		$container.find('.help-block-certificate-email .certificate-email-now').text(apptEmail);
		$container.find('.help-block-certificate-email .certificate-email-intended').text(code);
		return false;
	}


	var clickingReload = false;
	$('#custom-forms').on('click', '.reload-page', function (ev) {
		clickingReload = true;
		document.location.reload();
	});


	$('#appointment-form #email').blur(function (ev) {
		// Validate certificate if needed
		validateCertificateCodeByEmail();

		// Validate they entered a good e-mail
		var $formGroup = $(ev.currentTarget).closest('.form-group');

		var emailLabel = $formGroup.find('label').text();
		if (emailLabel.indexOf('mail') > -1 || emailLabel.indexOf('Mail') > -1) {
			// ok, it is still labeled as e-mail not renamed through babel
			//	validate it
			$formGroup.removeClass('has-error');
			$formGroup.attr('data-is-manual-error', '');
			$('#email-error-help').hide();

			var email = $('#email').val();
			$.post('/schedule.php?action=validateEmail&owner='+$('#owner').val(), $('#appointment-form').serialize(), handleValidateEmailResponse);
		}
	});

	window.onbeforeunload = function() {
		// If popup visible could be payment
		if ($('.step-forms.active').length > 0 && !isPaying() && !clickingReload) {
			return "Your appointment has *not* been completed";
		}
	}

	return {
		reloadFormButtons: reloadFormButtons,
		init: init
	};
})();
Acuity.Login = (function (){
	function reloadAfterLogin()
	{
		if (Acuity.Confirmation.isOnConfirmationStep() || Acuity.PickAppointment.isOnPickStep()) {
			if (document.location.href.indexOf(SID) == -1) {
				// Add SID
				var newHref = document.location.href;
				newHref = newHref + (newHref.indexOf('?') == -1 ? '?' : '&') + SID;
				document.location.href = newHref;
			} else {
				// Already has SID, just reload
				document.location.reload();
			}
			return;
		}

		var beforeLoginHtml = $('.login-container').html();

		$('.login-container').html(Acuity.Config.loadingHtml);
		// reload login prompt
		$.get('/schedule.php?action=getLogin&owner='+$('#owner').val()+'&'+SID,
			function (data) {
				$('.login-container').html(data);
				if (typeof currentClient == 'undefined') {
					currentClient = {};
				}

				$('#first-name').val(currentClient.firstName || '');
				$('#last-name').val(currentClient.lastName || '');
				$('#phone').val(currentClient.phone || '');
				$('#email').val(currentClient.email || '');
			}).fail(function () {
				// revert back...
				$('.login-container').html(beforeLoginHtml);
			});

		// Also re-init forms
		Acuity.Forms.init();
	}


	function initLoginForm($container)
	{
		if ($container.find('#username').val()) {
			$container.find('#password').focus();
		} else {
			$container.find('#username').focus();
		}

		// form loaded, do stuff
		if ($container.attr('data-form-init')) {
			return;
		}

		$container.attr('data-form-init', true);
		$container.on('submit', 'form.client-login-form', function (ev) {
			ev.preventDefault();

			// submit it ajaxy!
			$form = $(ev.currentTarget);
			var action = $form.attr('action');
			var data = $form.serialize();

			Popup.showHtml(Acuity.Config.loadingHtml);

			$.post(action, data)
				.done(function (data) {
					// ... error? success?
					// On error, it's the login form again
					try {
						var results = JSON.parse(data);

						if (results.error) {
							Popup.showHtml(results.error, initLoginForm);
						} else if (results.success) {
							reloadAfterLogin();
							Popup.hide();
						}
					} catch (ex) {
						Popup.showHtml('Error, failed to log in. Please refresh the page and try again.');
						trackJs.track('client login failed');
						trackJs.track(ex);
					}
					
				}).fail(function () {
					Popup.showHtml('Error, failed to log in. Please check your internet connection, then refresh the page and try again.');
					trackJs.track('client login failed to post');
				});
		});
	}


	/**
	 * Validate form
	 */
	function initChangePassword($container)
	{
		$container.find('input[type="password"]:first').focus();
		$error = $container.find('.error-msg').hide();

		$container.on('submit', 'form', function (ev) {
			// validate
			var error = '';
			if (!$('#password1').val()) {
				error = 'Password cannot be blank';
			} else if ($('#password1').val() != $('#password2').val()) {
				error = 'Passwords do not match';
			}

			if (error) {
				ev.preventDefault();
				$error.html(error).show();
				$container.find('input[type="password"]:first').focus();
			}
		});
	}


	$('body').on('click', '.client-login-btn', function (ev) {
		ev.preventDefault();
		var url = $(ev.currentTarget).attr('href') + '&ajax=1';
		$.get(url, function (data) {
			try {
				var result = JSON.parse(data);
				// Logged in from somewhere else
				if (result.success) {
					reloadAfterLogin();
					Popup.hide();
				}
			} catch (ex) {
				// Good, not json!
				Popup.showHtml(data);
			}
		}).fail(function () {
			Popup.showHtml('Failed to load login, please check your internet connection and try again.');
		});
		Popup.showUrl(url, initLoginForm);
	});

	$('.client-login, #appointment-form').on('click', '.change-password-btn', function (ev){
		ev.preventDefault();
		var url = $(ev.currentTarget).attr('href') + '&ajax=1';
		Popup.showUrl(url, initChangePassword);
	});

	$(function (ev) {
		if (document.location.href.indexOf('#login') > -1) {
			$('.client-login-btn').first().click();
		}
	});

	return {
		// ...
	}
})();
/* Modernizr 2.7.1 (Custom Build) | MIT & BSD
 * Build: http://modernizr.com/download/#-csstransforms-input-inputtypes-testprop-testallprops-domprefixes-load
 */
;window.Modernizr=function(a,b,c){function x(a){i.cssText=a}function y(a,b){return x(prefixes.join(a+";")+(b||""))}function z(a,b){return typeof a===b}function A(a,b){return!!~(""+a).indexOf(b)}function B(a,b){for(var d in a){var e=a[d];if(!A(e,"-")&&i[e]!==c)return b=="pfx"?e:!0}return!1}function C(a,b,d){for(var e in a){var f=b[a[e]];if(f!==c)return d===!1?a[e]:z(f,"function")?f.bind(d||b):f}return!1}function D(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),e=(a+" "+n.join(d+" ")+d).split(" ");return z(b,"string")||z(b,"undefined")?B(e,b):(e=(a+" "+o.join(d+" ")+d).split(" "),C(e,b,c))}function E(){e.input=function(c){for(var d=0,e=c.length;d<e;d++)r[c[d]]=c[d]in j;return r.list&&(r.list=!!b.createElement("datalist")&&!!a.HTMLDataListElement),r}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),e.inputtypes=function(a){for(var d=0,e,g,h,i=a.length;d<i;d++)j.setAttribute("type",g=a[d]),e=j.type!=="text",e&&(j.value=k,j.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(g)&&j.style.WebkitAppearance!==c?(f.appendChild(j),h=b.defaultView,e=h.getComputedStyle&&h.getComputedStyle(j,null).WebkitAppearance!=="textfield"&&j.offsetHeight!==0,f.removeChild(j)):/^(search|tel)$/.test(g)||(/^(url|email)$/.test(g)?e=j.checkValidity&&j.checkValidity()===!1:e=j.value!=k)),q[a[d]]=!!e;return q}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var d="2.7.1",e={},f=b.documentElement,g="modernizr",h=b.createElement(g),i=h.style,j=b.createElement("input"),k=":)",l={}.toString,m="Webkit Moz O ms",n=m.split(" "),o=m.toLowerCase().split(" "),p={},q={},r={},s=[],t=s.slice,u,v={}.hasOwnProperty,w;!z(v,"undefined")&&!z(v.call,"undefined")?w=function(a,b){return v.call(a,b)}:w=function(a,b){return b in a&&z(a.constructor.prototype[b],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(b){var c=this;if(typeof c!="function")throw new TypeError;var d=t.call(arguments,1),e=function(){if(this instanceof e){var a=function(){};a.prototype=c.prototype;var f=new a,g=c.apply(f,d.concat(t.call(arguments)));return Object(g)===g?g:f}return c.apply(b,d.concat(t.call(arguments)))};return e}),p.csstransforms=function(){return!!D("transform")};for(var F in p)w(p,F)&&(u=F.toLowerCase(),e[u]=p[F](),s.push((e[u]?"":"no-")+u));return e.input||E(),e.addTest=function(a,b){if(typeof a=="object")for(var d in a)w(a,d)&&e.addTest(d,a[d]);else{a=a.toLowerCase();if(e[a]!==c)return e;b=typeof b=="function"?b():b,typeof enableClasses!="undefined"&&enableClasses&&(f.className+=" "+(b?"":"no-")+a),e[a]=b}return e},x(""),h=j=null,e._version=d,e._domPrefixes=o,e._cssomPrefixes=n,e.testProp=function(a){return B([a])},e.testAllProps=D,e}(this,this.document),function(a,b,c){function d(a){return"[object Function]"==o.call(a)}function e(a){return"string"==typeof a}function f(){}function g(a){return!a||"loaded"==a||"complete"==a||"uninitialized"==a}function h(){var a=p.shift();q=1,a?a.t?m(function(){("c"==a.t?B.injectCss:B.injectJs)(a.s,0,a.a,a.x,a.e,1)},0):(a(),h()):q=0}function i(a,c,d,e,f,i,j){function k(b){if(!o&&g(l.readyState)&&(u.r=o=1,!q&&h(),l.onload=l.onreadystatechange=null,b)){"img"!=a&&m(function(){t.removeChild(l)},50);for(var d in y[c])y[c].hasOwnProperty(d)&&y[c][d].onload()}}var j=j||B.errorTimeout,l=b.createElement(a),o=0,r=0,u={t:d,s:c,e:f,a:i,x:j};1===y[c]&&(r=1,y[c]=[]),"object"==a?l.data=c:(l.src=c,l.type=a),l.width=l.height="0",l.onerror=l.onload=l.onreadystatechange=function(){k.call(this,r)},p.splice(e,0,u),"img"!=a&&(r||2===y[c]?(t.insertBefore(l,s?null:n),m(k,j)):y[c].push(l))}function j(a,b,c,d,f){return q=0,b=b||"j",e(a)?i("c"==b?v:u,a,b,this.i++,c,d,f):(p.splice(this.i++,0,a),1==p.length&&h()),this}function k(){var a=B;return a.loader={load:j,i:0},a}var l=b.documentElement,m=a.setTimeout,n=b.getElementsByTagName("script")[0],o={}.toString,p=[],q=0,r="MozAppearance"in l.style,s=r&&!!b.createRange().compareNode,t=s?l:n.parentNode,l=a.opera&&"[object Opera]"==o.call(a.opera),l=!!b.attachEvent&&!l,u=r?"object":l?"script":"img",v=l?"script":u,w=Array.isArray||function(a){return"[object Array]"==o.call(a)},x=[],y={},z={timeout:function(a,b){return b.length&&(a.timeout=b[0]),a}},A,B;B=function(a){function b(a){var a=a.split("!"),b=x.length,c=a.pop(),d=a.length,c={url:c,origUrl:c,prefixes:a},e,f,g;for(f=0;f<d;f++)g=a[f].split("="),(e=z[g.shift()])&&(c=e(c,g));for(f=0;f<b;f++)c=x[f](c);return c}function g(a,e,f,g,h){var i=b(a),j=i.autoCallback;i.url.split(".").pop().split("?").shift(),i.bypass||(e&&(e=d(e)?e:e[a]||e[g]||e[a.split("/").pop().split("?")[0]]),i.instead?i.instead(a,e,f,g,h):(y[i.url]?i.noexec=!0:y[i.url]=1,f.load(i.url,i.forceCSS||!i.forceJS&&"css"==i.url.split(".").pop().split("?").shift()?"c":c,i.noexec,i.attrs,i.timeout),(d(e)||d(j))&&f.load(function(){k(),e&&e(i.origUrl,h,g),j&&j(i.origUrl,h,g),y[i.url]=2})))}function h(a,b){function c(a,c){if(a){if(e(a))c||(j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}),g(a,j,b,0,h);else if(Object(a)===a)for(n in m=function(){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b}(),a)a.hasOwnProperty(n)&&(!c&&!--m&&(d(j)?j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}:j[n]=function(a){return function(){var b=[].slice.call(arguments);a&&a.apply(this,b),l()}}(k[n])),g(a[n],j,b,n,h))}else!c&&l()}var h=!!a.test,i=a.load||a.both,j=a.callback||f,k=j,l=a.complete||f,m,n;c(h?a.yep:a.nope,!!i),i&&c(i)}var i,j,l=this.yepnope.loader;if(e(a))g(a,0,l,0);else if(w(a))for(i=0;i<a.length;i++)j=a[i],e(j)?g(j,0,l,0):w(j)?B(j):Object(j)===j&&h(j,l);else Object(a)===a&&h(a,l)},B.addPrefix=function(a,b){z[a]=b},B.addFilter=function(a){x.push(a)},B.errorTimeout=1e4,null==b.readyState&&b.addEventListener&&(b.readyState="loading",b.addEventListener("DOMContentLoaded",A=function(){b.removeEventListener("DOMContentLoaded",A,0),b.readyState="complete"},0)),a.yepnope=k(),a.yepnope.executeStack=h,a.yepnope.injectJs=function(a,c,d,e,i,j){var k=b.createElement("script"),l,o,e=e||B.errorTimeout;k.src=a;for(o in d)k.setAttribute(o,d[o]);c=j?h:c||f,k.onreadystatechange=k.onload=function(){!l&&g(k.readyState)&&(l=1,c(),k.onload=k.onreadystatechange=null)},m(function(){l||(l=1,c(1))},e),i?k.onload():n.parentNode.insertBefore(k,n)},a.yepnope.injectCss=function(a,c,d,e,g,i){var e=b.createElement("link"),j,c=i?h:c||f;e.href=a,e.rel="stylesheet",e.type="text/css";for(j in d)e.setAttribute(j,d[j]);g||(n.parentNode.insertBefore(e,n),m(c,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))};

$(function () {
	// downgrade navs if needed
	if (!Modernizr.csstransforms) {
		$('body').addClass('no-transforms');
	} else {
		$('body').addClass('has-transforms');
	}

	// enable labels if no placeholders
	if (!Modernizr.input.placeholder) {
		$('body').addClass('no-placeholder');
	}
});

/**
 * Acuity namespace for helper functions that still interact with DOM
 */
Acuity.PickAppointment = (function () {
	var _lastTimesRequest = null;
	var acuityCalendar = new Acuity.Calendar({
		$calendar: $('.choose-date'),
		clearTimes: clearTimes,
		getType: getType,
		getAddons: getAddons,
		getCalendar: getCalendar,
		timesLoaded: timesLoaded,
		dateSelected: dateSelected,
		getTimezone: function () {
			return $('#timezone').val();
		}
	});

	function getType() {
		return $('.select-type').attr('data-value');
	}

	function getAddons() {
		return $('.addon-option:checked').map(function(){
			return $(this).val();
		}).get();
	}

	function getCalendar() {
		return $('.select-calendar').attr('data-value');
	}

	function clearSelectedTimes(forceClear) {
		// Only clear out the times if we can choose another one, if the calendar is available
		if (forceClear || $('.choose-date-time:visible').length == 0 || $('.calendar').length) {
			$('#selected-times').html('');
			$('#selected-times-container').hide();
		}
	}

	function isSuperNarrow() {
		return $('body').width() <= 400;
	}

	/**
	 * Is a group appointment type selected?
	 */
	function isGroupTypeSelected() {
		return $('.select-type input[name="appointmentType"][value="'+getType()+'"], input.select-type[value="'+getType()+'"]').attr('data-is-group') == 1;
	}

	function getGroupQuantity() {
		if (!isGroupTypeSelected()) {
			return 1;
		}
		var $qty = $('#group-quantity');

		var qtyVal = parseInt($qty.val());
		if ($qty.length != 1 || !qtyVal) {
			return 1;
		} else {
			return Math.max(1, qtyVal);
		}
	}

	$('#group-quantity').on('keyup change', function (ev) {
		$(this).closest('.group-quantity-container').removeClass('has-error');
	});

	/**
	 * In some cases group quantity is required, 
	 */
	function groupQuantityError()
	{
		var $qty = $('#group-quantity');
		if ($qty.is(':visible') && $qty.val()==='0') {
			$('.group-quantity-container').addClass('has-error');
			$qty.focus();
			return true;
		} else {
			return false;
		}
	}

	/**
	 * Clear the calendar date and time
	 */
	function clearDate(dontHideContainer) {
		// Hide the time zone selection if we're changing this
		Popup.hide();

		clearTimes();
		$('.choose-date').html('');
		$('.choose-date-time').hide();
		// Clearing selected times makes sure its hidden
		clearSelectedTimes();
		if (dontHideContainer) $('.choose-date-time').show();
	}


	function isSelectedTimeOnDifferentDay()
	{
		// Parenthesis means time is on a different day, like:
		//	January 21, 2015  4:00am (January 22)
		return $('#selected-times').text().indexOf('(') >= 0;
	}

	function normalizeTimes()
	{
		// go through, find anything that's not right
		var times = [];
		var elementsInOrder = [];
		
		$('#selected-times .selected-time').each(function () {
			var time = $(this).find('[name="time[]"]').val();
			times.push(time);
			elementsInOrder.push(this);
		});

		$.getJSON('/schedule.php', {
			owner: $('#owner').val(),
			action: 'normalizeTimes',
			timezone: $('#timezone').val(),
			'times': times
		}, function (data) {
			// Anything amiss from when we sent?
			if (typeof data.length=='undefined' || data.length != elementsInOrder.length) {
				return;
			}

			for (var i=0; i<data.length; i++) {
				$(elementsInOrder[i]).find('.selected-time-description').text(data[i]);
			}
			$(document).trigger('acuity:changeSummary');
		});
	}


	var normalizeTimesDebounced = debounce(function () {
		normalizeTimes();
	}, 50);


	/**
	 * Generate the calendar list based on appt type
	 */
	function loadCalendarSelect(typeId)
	{
		var calendars = typeToCalendars[typeId];
		$('#select-calendar-options').html('');
		if (!calendars) {
			return;
		}

		// ok build the list...
		var html = '';

		function addCalendarOption(id, label, thumb) {
			if (typeof thumb == 'undefined' || thumb == '') {
				var calendarImg = '';
			} else {
				var calendarImg = '<img src="'+thumb+'"><div class="clearfix"></div>';
			}
			if (!label) label = 'Blank Name';
			html += '<input type="radio" name="calendar" id="calendar-'+id+'" value="'+id+'" /><label class="select-item '+(id!='any'?'babel-ignore':'')+'" for="calendar-'+id+'">'+label+calendarImg+'</label>';
		}

		if (calendars.length > 1 && !self.alwaysChooseAnyAvailable) {
			if (!self.hideAnyAvailable) addCalendarOption('any', 'Any available');

			for (var i=0; i<calendars.length; i++) {
				if (typeof calendars[i][2] != 'undefined') {
                    addCalendarOption(calendars[i][0], calendars[i][1], calendars[i][2]);
				} else {
                    addCalendarOption(calendars[i][0], calendars[i][1]);
				}
			}
		} else {
			// only one option, don't even show it just pick it
			var calendarId = 'any';
			if (calendars.length == 1) {
				calendarId = calendars[0][0];
			}

			html = '<input type="radio" name="calendar" value="'+calendarId+'" checked="checked" />';
			$('.select-calendar').attr('data-value', calendarId);
			$('.select-calendar').hide(0);
			showDateTimePicker();
		}

		$('#select-calendar-options').html(html);
		// Focus on a non-visible input to jump to top
		//	even if
		if (Acuity.pageLoadTime && top.frames.length>1) {
			setTimeout(function () {
				$('#jump-to-top').show().focus();
			}, 10);
			setTimeout(function () {
				$('#jump-to-top').focus();
			}, 250);
			setTimeout(function () {
				$('#jump-to-top').blur();
			}, 300);
		}
		Select.reset( $('.select-calendar') );
	}

	/**
	 * Invalidate current time selection and hide it
	 */
	function clearTimes() {
		$('.choose-time').html('');
		$('.choose-time-container, .choose-time-actions').hide();
	}



	/**
	 * Position the time container depending on widths of everything
	 */
	function positionTimeContainer()
	{
		// Border size on .choose-time-container
		var borderWidth = 2;
		var timeMinWidth = 140;
		var buttonWidth = 102;

		var dayWidth = $('.selectedday').outerWidth() + borderWidth*2;
		var chooseDatePosition = $('.choose-date').position();
		var dayPosition = $('.selectedday').position();

		var chooseTimeWidth = Math.max(dayWidth, timeMinWidth);

		// If our min is bigger than the date offset it slightly to center
		var offsetWidth = 0;
		if (timeMinWidth > dayWidth) {
			offsetWidth = (timeMinWidth - dayWidth)/2;
		}

		var chooseTimeLeft = dayPosition.left + chooseDatePosition.left - borderWidth - offsetWidth;

		// Make sure it's far enough from right so that choose button shows
		var bodyWidth = $('html, body').width();
		var spaceForButton = bodyWidth - (chooseTimeLeft+chooseTimeWidth);

		// Super narrow is show inline so this wouldn't matter then
		if ( !isSuperNarrow() && spaceForButton < buttonWidth ) {
			chooseTimeLeft -= Math.min(60, buttonWidth-spaceForButton);
		}

		$('.choose-time-container')
			.css({
					top: dayPosition.top + chooseDatePosition.top - 1,
					left: Math.max(0, chooseTimeLeft),
					width: chooseTimeWidth
				})
	}


	/**
	 * Called after a date is selected, before times loaded
	 */
	function dateSelected(date)
	{
		var $time = $('.choose-time');
		$('.choose-time-actions').hide();

		// select the date...
		$('#date').val(date);
		
		$(document).trigger('acuity:selected-date', [date]);

		$time.html(Acuity.Config.loadingHtml).show();
		$('.choose-time-container')
			.show()
			.find('h1').text($('.selectedday').text());

		positionTimeContainer();
	}


	function initChooseTime()
	{
		var $time = $('.choose-time');
		if (!$time.length) {
			return;
		}

		// Cross out any times if they don't have enough spots free
		if (groupQuantityError()) {
			$time.html('Please set a quantity and then choose a date again');
			$('#group-quantity').focus();
		} else {
			var numSpotsRequested = getGroupQuantity();
			$time.find('input[data-available]').each(function () {
				var numAvailable = $(this).attr('data-available');
				if (numAvailable && numAvailable < numSpotsRequested) {
					$(this).next('label').addClass('not-enough-spots');
				}
			});
		}

		// only one? select it
		var $times = $time.find('label');
		if ($times.length == 1) {
			// Select the input and trigger change so button shows
			$times.click();
		}
	}

	/**
	 * Calendar was loaded, if there are times init them
	 */
	$(window).on('acuity:calendar-loaded', function () {
		initChooseTime();
	});

	/**
	 * Load times for a given date, assuming cal and type already selected
	 */
	function timesLoaded(data) {
		var $time = $('.choose-time');

		// TODO: fail nicer
		if (typeof data == 'undefined') {
			$time.html('Failed to load times');
			return;
		}

		$time.hide().html(data).slideDown(150, function () {
			$('body, html').animate({ scrollTop: $time.offset().top + 'px' }, 150);

			// reposition times, if scrollbar appeared it will change width
			positionTimeContainer();
		});

		initChooseTime();
	}

	/**
	 * Were any date/times passed in as an argument to us?
	 *	set them if they were
	 */
	function loadDefaultDateTimes()
	{
		// Do we have any default times to choose?
		if (typeof defaultTimes != 'undefined' && defaultTimes) {
			clearDate(true/*dont hide date time container*/);

			for (var i=0; i<defaultTimes.length; i++) {
				addSelectedTime(defaultTimes[i].date, defaultTimes[i].time, defaultTimes[i].readableTime, true, defaultTimes[i].readableDate);
			}
			normalizeTimes();

			return true;
		} else {
			return false;
		}
	}


	/**
	 * Load the calendar, or whatever is passed in
	 */
	function loadCalendar()
	{
		if (loadDefaultDateTimes()) {
				// next step if there is nothing to fill out at all
				$('.choose-date').hide();
				if ($('#addons-container input').length==0
					&& !isGroupTypeSelected()
					) {
					setTimeout(Steps.next, 0);
				}
			} else {
				// Nothing passed in, let the client choose
				acuityCalendar.loadCalendar();
			}
	}


	/**
	 * Show calendar
	 */
	function showDateTimePicker()
	{
		clearDate();
		if (timezonePopupShouldShow) {
			showTimezonePopup(function () {
				timezonePopupShouldShow = false;
				// Actually load it
				showDateTimePicker();
			});
		} else {
			$('.choose-date-time').show();
			loadCalendar();
		}
	}

	/**
	 * If the date/time picker is already showing, refresh it
	 */
	function refreshDateTimePicker()
	{
		if ($('.choose-date-time').is(':visible')) {
			// If there's no calendar visible, but there are times selected, clear those out
			if ($('.choose-date-time .calendar').length == 0 && $('#selected-times .selected-time').length > 0) {
				clearSelectedTimes(true); // force clear it out
			}
			loadCalendar();
		}
	}


	/**
	 * Deselect the current date/time options
	 */
	function deselectDateTime()
	{
		$('.pick-appointment-pane .selectedday').removeClass('selectedday');
		$('#date').val('');

		$('.pick-appointment-pane .choose-time').slideUp(function () {
			clearTimes();
		});

		// Deselect the combined date/time selector
		$('.choose-date-time').find('input:checked').prop('checked', false);
		$('.choose-time .choose-time-actions').remove();
	}


	function getReadableDate() {
		if (isWeeklyView()) {
			return $('.choose-time input:checked').data('readable-date');
		} else {
			return $('#date').val();
		}
	}

	function getBusinessDate() {
		var val = $('.choose-time input:checked').val();
		if (!val) return;
		return val.split(' ')[0];
	}

	/**
	 * Get the value for the current time
	 */
	function getBusinessTime() {
		var val = $('.choose-time input:checked').val();
		if (!val) return;
		return val.split(' ')[1];
	}

	/**
	 * Get the time, but client's time zone
	 */
	function getReadableTime() {
		var text = $($('.choose-time input:checked+label').contents()[0]).text();
		return text;
	}


	/**
	 * Are there still times available that the client picked?
	 */
	function areTimesAvailable()
	{
		return $('#selected-times .selected-time').not('.time-conflict').length > 0;
	}

	/**
	 * Get the readable appointment type name
	 */
	function getReadableAppointmentType(typeId)
	{
		return $('label[for="appointmentType-'+typeId+'"]').html();
	}

	/**
	 * Get an HTML summary of the appointments selected
	 */
	function getSummary()
	{
		var typeTimeSeparator = ' on ';
		if (typeof LOCALE!='undefined' && LOCALE && LOCALE!='en') {
			typeTimeSeparator = ' ';
		}

		// Name of type
		var typeId = getType();
		var typeName = getReadableAppointmentType(typeId);

		typeName = typeName.replace('<div class="clearfix"></div>', '');

		// Addons text
		var addonsText = $('#addons-container label:has(.addon-option:checked)').map(function() {
			return $(this).find('.addon-name').text() + ' ' + ($(this).find('.addon-attributes').html()||'');
		}).get().join(', ');

		if (addonsText) {
			typeName = typeName + ', ' + addonsText;
		}

		var numTimes = $('#selected-times .selected-time').length;
		var times = '';
		var timesCounts = {};

		// Find all the distinct times and count how many of each
		$('#selected-times .selected-time').not('.time-conflict').each(function(){
			var text = $(this).find('.selected-time-description').text();
			timesCounts[text] = 1 + (timesCounts[text] || 0)
		});

		// Show all the times with the quantity next to them
		for (var k in timesCounts) {
			var text = k;
			if (timesCounts[k] > 1) {
				text += ' <span class="appt-quantity">(x' + timesCounts[k] + ')</span>';
			}

			if (numTimes <= 1) {
				times += text;
			} else {
				times += '<div class="selected-time-summary">' + text + '</div>';
			}
		}

		if (!times) {
			return '';
		}

		var clearFix = '<div class="clearfix"></div>';

		return typeName + typeTimeSeparator + times + clearFix;
	}



	/**
	 * Handle changing the time zone label
	 */
	function timezoneChanged()
	{
		// okie dokie, change it and get the friendly name
		var tzValue = $('#timezone').val();
		var tzName = $('#timezone option[value="'+tzValue+'"]').text();
		$('#timezone-label').text(tzName);
		$('#timezone').addClass('timezone-select-inactive');

		// Someone might set this but not do a request
		AcuityStorage.setItem('TZ', tzValue);

		// and clear out any times that were previously selected...
		clearSelectedTimes();
		// and re-show the date picker
		refreshDateTimePicker();		
	}


	/**
	 * Show/hide the continue button at the top of the list of times
	 * 	if there are alot of them we want it on both top and bottom
	 */
	function toggleTopContinue() {
		var numSelectedTimes = $('#selected-times .selected-time').length;
		if (numSelectedTimes > 8) {
			$('.btn-next-step-top').show();
		} else {
			$('.btn-next-step-top').hide();
		}
	}


	/**
	 * Add the individual selected time to the list
	 */
	var _lastSelectedTimeId = 0;
	function addSelectedTimeToList(date, time, readableTime, dontShowRemove, readableDate) {
		if (!readableDate) {
			readableDate = date;
		}

		var dateTimeSeparator = ' at ';
		if (typeof LOCALE!='undefined' && LOCALE && LOCALE!='en') {
			dateTimeSeparator = ' ';
		}

		var form = '<input type="hidden" name="date[]" value="'+readableDate+'" />';
		form += '<input type="hidden" name="time[]" value="'+date+' '+time+'" />';

		var description = formatDateForHuman(readableDate);
		description += dateTimeSeparator + readableTime;

		var removeLink = '<a href="#" class="remove"><i class="fa fa-trash" title="Remove"></i></a>';
		if (dontShowRemove) {
			removeLink = '';
		}

		var $div = $('<div class="selected-time" id="selected-time-'+(_lastSelectedTimeId++)+'"></div>');
		$div.html(form + '<span class="selected-time-description">' + description + '</span>' + removeLink).on('click', '.remove', function (ev) {
			ev.preventDefault();
			$div.slideUp(function () {
				$div.remove();

				// Removing this emptied out last time? No more continue button...
				if (!$('.selected-time').length) {
					clearSelectedTimes();
				}

				toggleTopContinue();
			});
		});

		$('#selected-times').append($div);
		$('#selected-times-container').show();

		toggleTopContinue();

		normalizeTimesDebounced();

		queueCheckConflict(date, time, $div.attr('id'));
	}


	function checkConflict(times) {
		$.post('/schedule.php?action=checkConflict&owner='+$('#owner').val(), {
			times: times,
			calendarID: getCalendar(),
			type: getType()
		}, function (data) {
			var result = [];
			try {
				result = JSON.parse(data);
			} catch (ex) {
				return;
			}

			for (var i=0; i<result.length; i++) {
				var why = result[i]['why'];
				if (why) {
					var title = why;
					if (why == 'conflicts') {
						title = 'This conflicts with another appointment or is outside business hours';
					} else if (why == 'past' || why == 'reallypast') {
						title = 'This time is in the past';
					} else if (why == 'advance') {
						title = 'This time is too far in advance';
					}

					var $div = $('#'+result[i]['id']);
					$div.attr('title', title)
						.tooltip({placement: 'top'})
						.addClass('time-conflict')
						.find('input').remove();
				}
			}
			

			if (result) {
				// Show that it's not available, and remove the input so it won't be scheduled
				$(document).trigger('acuity:changeSummary');
			}
		});
	}

	var checkConflictTimes = [];
	var checkConflictTimer = null;
	function queueCheckConflict(date, time, id)
	{
		checkConflictTimes.push({id:id, date:date, time:time});

		if (checkConflictTimer) {
			clearTimeout(checkConflictTimer);
		}

		checkConflictTimer = setTimeout(function () {
			var times = jQuery.extend(true, {}, checkConflictTimes);
			checkConflictTimes = [];
			checkConflict(times);
		}, 50);
	}


	/**
	 * Add selected time to table and form
	 */
	function addSelectedTime(date, time, readableTime, dontShowRemove, readableDate) {
		if (!date || !time) {
			return;
		}

		var qty = getGroupQuantity();
		for (var i=0; i<qty; i++) {
			addSelectedTimeToList(date, time, readableTime, dontShowRemove, readableDate);
		}
	}


	/**
	 * Show and load the addons
	 */
	function loadAddons()
	{
		$('#addons-container').html(Acuity.Config.loadingHtml);
		$.get('/schedule.php', {
			owner: $('#owner').val(),
			type: getType(),
			action: 'getAddonsPartial'
		}, function (data) {
			if (data) {
				$('#addons-container').html('<div id="addons-prompt">Add to your appointment...</div>' + data + ($('#addons-container').data('footer')||'') ).addClass('has-addons');
			} else {
				$('#addons-container').html('').removeClass('has-addons');
			}
		});
	}


	/**
	 * Show the popup to select timezone, or continue on if we trust the autodetect
	 */
	function showTimezonePopup(cb)
	{
		var currentTz = $('#timezone').val();

		// Do we have a time zone set already, and trust it? If so, skip past forcing verification
		if (currentTz && $('#timezone-container').attr('data-trust-autodetect')) {
			return cb();
		}

		var popupContent = '<div id="timezone-prompt" data-original-text="Confirm your time zone:">Set your time zone to continue:</div>';
		var newTz = $('#timezone').clone();
		newTz.attr('id', 'verify-timezone');
		newTz.show();

		popupContent += '<div class="margin-top-small">'+$('<div />').append(newTz).html()+'</div>';
		popupContent += '<input type="button" id="popup-set-timezone" class="btn btn-primary margin-top-small" value="Set time zone" />';
		Popup.insertHtml(popupContent, $('.choose-date-time'));

		$('#verify-timezone').val($('#timezone').val());

		$('#popup-set-timezone').click(function (ev) {
			$('#timezone').val($('#verify-timezone').val());
			Popup.hide();
			timezoneChanged();

			if (typeof cb == 'function') {
				cb();
			}
		});
	}


	/**
	 * Is this step active?
	 */
	function isOnPickStep()
	{
		return $('#step-pick-appointment:visible').length > 0;
	}

	/**
	 * Init, this is called when coming to this page for the first time or returning from a step
	 *	if returning, clear out old times, that way if recurring is disabled they can't add another
	 *	and when people go back to this step it's usually because a time isn't available, or want to change times
	 */
  var loadedAtLeastOnce = false;
	function init()
	{
		clearSelectedTimes();
		// Refresh weekly view when reloading, ie. kicked back because a spot is no longer available.
		if (loadedAtLeastOnce && isWeeklyView()) {
			showCalendar();
		}
		$(document).trigger('acuity:stepLoaded');
		loadedAtLeastOnce = true;
	}

	var leftOffset = 2; // border radius

	/**
	 * Handle time select.
	 *
	 * Listen to click event instead.  At the end, send a message to select the item.
	 * SamsungBrowser had some issues with the change event.
	 *
	 * https://trello.com/c/HdYdSGXX/2671-timezone-not-showing-on-android-bug
	 */
	$('.choose-time, .choose-date-times').on('click', 'label', function (ev) {
		$('.choose-time .choose-time-actions').remove();

		var $current = $(ev.currentTarget).prev('input[type="radio"]');
		if (!$current.size()) console.error('expected to have input.');

		// Make *sure* if the label is clicked that the checkbox is checked
		//	possible problem with Samsung browser where faking a click when a single time
		//	is in the list isn't actually checking this
		$current.prop('checked', true);

		// selected a time
		// slide out
		$('.choose-time .checked').removeClass('checked');
		var lblPosition = $(ev.currentTarget).addClass('checked').position();
		var boxPosition = $('.choose-time').position();
		$('.choose-time-actions').css({
			top: lblPosition.top + boxPosition.top + 'px',
			left: leftOffset + 'px'
		});

		var numSlotsAvailable = $current.attr('data-available');
		$('.error-not-enough-slots').remove();

		// Error out if not enough spots are available
		if (numSlotsAvailable && numSlotsAvailable < getGroupQuantity()) {
			$('<div class="error small error-not-enough-slots">Not enough spots are available</div>').insertAfter($('.choose-time .checked'));
			$('.choose-time-actions .btn').attr('disabled', true);
		} else {
			$('.choose-time-actions .btn').attr('disabled', false);
		}

		// Copy the buttons to below the selected time
		if (isWeeklyView()) {
			// Inline the actions with the time
			var $target = $(ev.currentTarget);
			var actions = $('<div class="choose-time-actions" />').html($('.choose-time-actions').html())
				.css({
					left: $target.position().left + 'px'
				});
			$target.after(actions);
		} else if (isSuperNarrow()) {
			var actions = $('<div class="choose-time-actions" />').html($('.choose-time-actions').html());
			$(ev.currentTarget).after(actions);

			// If needed, scroll to show the actions so they aren't hidden
			var amountOff = Math.max(0, $('.choose-time .choose-time-actions').position().top+$('.choose-time .choose-time-actions').height()-$('.choose-time').height());
			if (amountOff) {
				$('.choose-time').scrollTop( $('.choose-time').scrollTop() + amountOff);
			}
		} else {
			$('.choose-time-actions').show().animate({left: $('.choose-time-container').width()+leftOffset})
		}
		
		var time = $current.val();
		$(document).trigger('acuity:selected-time', [time]);
	});

	
	/**
	 * Changing group quantity changes the default times if there are any
	 */
	$('#group-quantity').on('change keyup', function (ev) {
		if (!Popup.isVisible()) {
			loadDefaultDateTimes();
		}
	});


	/**
	 * Clicking next from the add-ons list
	 */
	$('#addons-container').on('click', '.btn-addons-next', function (ev) {
		ev.preventDefault();
		$('#first-name').focus();
		$('body').scrollTop($('#step-forms-pane').position().top);
	});


	/**
	 * Show next option only after choosing one...
	 */
	var lastTypeValue = null;
	$('.select-type').on('acuity:checked', function (ev, val) {
		if (lastTypeValue != val) {
			lastTypeValue = val;

			if (isGroupTypeSelected()) {
				$('.group-quantity-container').addClass('showing');
				// Focus after the input has hidden all other options
				//	but only focus if standalone or it isn't initial page load
				if (!Acuity.Embed.isEmbedded() || Acuity.pageLoadTime) {
					setTimeout(function() {
						$('.group-quantity-container.showing input').focus();
					}, 200);
				}
			} else {
				$('.group-quantity-container').removeClass('showing');
			}

			// Reload calendar selection
			$('.select-calendar').show();
			lastCalendarValue = null;
			clearDate();
			loadCalendarSelect(lastTypeValue);

			// And also the addons...
			if (hasAddons) loadAddons();
		}
	});

	var lastCalendarValue = null;
	$('.select-calendar').on('acuity:checked', function (ev, val) {
		// on handle change
		if (lastCalendarValue != val) {
			lastCalendarValue = val;

			showDateTimePicker();
		}
	});

	
	$('.select-type').on('acuity:checked', function () {
		setTimeout(Acuity.Certificate.checkCertificateCode, 0);
	});

	


	// Change the time zone manually
	$('.change-timezone').click(function (ev){
		$('#timezone').removeClass('timezone-select-inactive');
		ev.preventDefault();
	});

	$('#timezone').change(function (ev) {
		timezoneChanged();
	});


	// Refresh schedule when addons selected
	$('#addons-container').on('change', function () {
		if (isWeeklyView()) {
			refreshDateTimePicker();
		}

		$(window).trigger('acuity:addons-changed');
	});



	/**
	 * Show autodetect popup
	 */
	var timezonePopupShouldShow = false;
	if (Timezone.shouldDetectTimezone()) {
		var rememberedTz = AcuityStorage.getItem('TZ');
		var $rememberedTzOption = $('#timezone option[value="'+rememberedTz+'"]');
		// Always show the time zone option now, it's less annoying these days
		timezonePopupShouldShow = true;
		if (rememberedTz && $rememberedTzOption.length) {
			$('#timezone').val(rememberedTz);
		} else {
			// Try to auto-detect it
			$('#timezone').val(Timezone.getTimezoneName());
		}
		timezoneChanged();
	}

	/**
	 * Show the popup to choose a recurring time
	 */
	$('body').on('click', '.btn-recurring', function (ev) {
		Acuity.Recurring.showPopup();
		deselectDateTime();
	});

	$('.btn-additional').click(function (ev){
		ev.preventDefault();
	});

	$('.class-list-container').on('click', '.btn-show-class-series-extra', function (ev) {
		ev.preventDefault();
		$(this).closest('.class-series-times').addClass('class-series-extra-showing');
	});

	/**
	 * Add time to list when we click continue
	 */
	$('body').on('click', '#step-pick-appointment .choose-date-time .btn-next-step, .btn-additional', function (ev) {
		// add current date/time to list
		var date = getBusinessDate();
		var readableDate = getReadableDate();
		var time = getBusinessTime();
		var readableTime = getReadableTime();

		deselectDateTime();

		// Add this time selection to the list...
		addSelectedTime(date, time, readableTime, false, readableDate);
	});

	/**
	 * Add both time and type when choosing a class
	 */
	$('body').on('click', '#step-pick-appointment .btn-class-signup', function (ev) {
		ev.preventDefault();
		var $this = $(this);

		// First, if we're choosing a quantity is it valid?
		if (groupQuantityError()) {
			return;
		}

		$('[name="appointmentType"]').val($this.data('type')).attr('data-value', $this.data('type'));
		$('[name="calendar"]').val($this.data('calendar')).attr('data-value', $this.data('calendar'));

		var divider = ';';
		var allTimes = $this.data('time').split(divider);
		var allReadableTimes = $this.data('readable-time').split(divider);
		var allReadableDates = $this.data('readable-date').split(divider);

		for (var i=0; i<allTimes.length; i++) {
			var dateTimeParts = allTimes[i].split(' ');
			addSelectedTime(dateTimeParts[0], dateTimeParts[1], allReadableTimes[i], false, allReadableDates[i]);
		}

		loadAddons();
		Steps.next();
	});

	/**
	 * Hide time selection when click anywhere
	 */
	$('html, body').click(function (ev) {
		$current = $(ev.target);

		// time selection is visible, and we clicked outside of it
		//	or we clicked inside one of the empty tds
		if ( ($('.choose-time-container').is(':visible') && $current.closest('.choose-date-time').length == 0)
			||  ($current.closest('.choose-time-container').length==0 && $current.closest('.choose-time').length==0 && $current.text()=='') ) {
			// close it
			deselectDateTime();
		}
	});


	/**
	 * Only one option for appointment type? Select it
	 */
	if ($('.select-type input[type="radio"], .select-item-no-input').length == 1) {
		Select.selectFirstItem();

		// Hide the caret if there's only one
		$('.select-type .reopen-dropdown').hide();
	}

	/**
	 * Class list, all the things in the date picker
	 */
	if ($('.class-list-container').length) {
		showDateTimePicker();
	}

	/**
	 * We're pretty much loaded, show it now
	 */
	$('#page-loading').hide();
	$('#appointment-form').show();


	setTimeout(Acuity.Certificate.checkCertificateCode, 0);
	init();

	Acuity.addSeriesTime = addSelectedTime;

	return {
		isOnPickStep: isOnPickStep,
		getType: getType,
		getAddons: getAddons,
		getCalendar: getCalendar,
		getSummary: getSummary,
		areTimesAvailable: areTimesAvailable,
		init: init,
		/* These are exposed for recurring */
		addSelectedTime: addSelectedTime,
		getTime: getBusinessTime,
		getReadableTime: getReadableTime,
		getReadableDate: getReadableDate,
		getBusinessDate: getBusinessDate
	};
})();

/**
 * Handle highlighting and previews on CSP from admin side
 */
Acuity.Preview = (function () {
	function handleMessage(action, settings)
	{
		if (action == 'highlight' && typeof settings.selector != 'undefined') {
			$('.preview-highlight').removeClass('preview-highlight');
			$(settings.selector).addClass('preview-highlight');
		}

		if (action == 'text') {
			$(settings.selector).text(settings.text);
		}

		if (action == 'html') {
			$(settings.selector).html(settings.html).show();
		}

		if (action == 'toggle') {
			$(settings.selector).toggle(settings.show);
		}

		if (action == 'stophighlight') {
			$('.preview-highlight').removeClass('preview-highlight');
		}

		if (action == 'css') {
			setCss(settings.selector, settings.css);
		}

		if (action == 'noembed') {
			$('body').removeClass('is-embedded');
		}

		if (action == 'watchY') {
			for (var i=0; i<settings.selectors.length; i++) {
				watchYPosition(settings.selectors[i]);
			}
		}
	}


	
	var watchTimers = {};
	function watchYPosition(selector) {
		if (typeof JSON=='undefined' || typeof JSON.stringify != 'function') {
			return;
		}

		if (watchTimers[selector]) {
			// Already watching
			return;
		}

		var checkPosition = function () {
			var offset = $(selector).offset();
			var currentY = 0;
			if (offset) {
				currentY = offset.top;
			}

			if (currentY != lastYPosition) {
				lastYPosition = currentY;
				var val = {
					selector: selector,
					top: currentY
				};
				window.parent.postMessage('acuity:ypos:'+JSON.stringify(val), '*');
			}
		};

		var lastYPosition = -1;
		watchTimers[selector] = setInterval(checkPosition, 200);
		setTimeout(checkPosition, 50);
	}


	function setCss(selector, css)
	{
		// Find the css with this id
		var selector = selector.replace(/"/g, '');
		$style = $('[id="'+selector+'"]');

		if ($style.length) {
			$style.html(css);
		} else {
			$('body').append($('<style type="text/css"></style>').attr('id', selector).html(css));
		}
	}


	$(window).on("message", function(ev) {
		// Remove 127.0.0.1 after testing
		var origin = ev.origin || ev.originalEvent.origin;
		
		if (origin !== "https://secure.acuityscheduling.com" && origin !== "https://staging.acuityscheduling.com" && origin !== 'http://127.0.0.1' && origin !== 'http://10.16.7.11' && origin !== 'http://192.168.1.66') {
			return;
		}

		var data = ev.originalEvent.data;
		if (typeof data.split != 'function') {
			return;
		}
		var parts = data.split(':');

		if (parts.length < 2 || parts[0] != 'acuity') {
			return;
		}

		var action = parts[1];
		var settings = {};
		
		if (parts.length>2) {
			try {
				parts.shift();
				parts.shift();
				settings = JSON.parse(parts.join(':'));
			} catch (ex) {
				// ...
			}
		}

		handleMessage(action, settings);
	});
})();
Acuity.Recurring = (function () {
	var currentDate;
	var currentReadableDate;
	var currentTime;
	var currentReadableTime;

	function incrementDate(d, recurType, weekdayOfMonth)
	{
		var originalDate = d.getUTCDate();

		if (recurType=='daily') {
			d.setUTCDate(d.getUTCDate()+1);
		} else if (recurType=='weekly') {
			d.setUTCDate(d.getUTCDate()+7);
		} else if(recurType=='biweekly') {
			d.setUTCDate(d.getUTCDate()+14);
		} else if(recurType=='triweekly') {
			d.setUTCDate(d.getUTCDate()+21);
		} else if(recurType=='monthly') {
			d.setUTCMonth(d.getUTCMonth()+1);
			if (d.getUTCDate() != originalDate) {
				d.setUTCDate(originalDate);
			}
		} else if(recurType=='quadweekly') {
			d.setUTCDate(d.getUTCDate()+28);
		} else if (recurType=='monthly-day') {
			// i.e. 3rd Saturday of every month
			var weekday = d.getUTCDay();

			// go to the first of next month
			d.setUTCMonth(d.getUTCMonth()+1);
			d.setUTCDate(1);
			var weekdayOfFirst = d.getUTCDay();

			// now go ahead...
			if (weekdayOfFirst>weekday) weekday += 7;
			d.setUTCDate(weekdayOfMonth*7 + (weekday-weekdayOfFirst) + 1);
		}

		return d;
	}


	function addCustomRecurringTime(fnAddDate)
	{
		var d = dateObjectFromString(currentDate);
		var dReadable = dateObjectFromString(currentReadableDate);

		var recurType = $('#recur-type').val();

		var weekdayOfMonth = parseInt( (d.getUTCDate()-1)/7);

		for(var i=0; i<$('#recur-times').val(); ++i) {
			rd = ''+d.getUTCFullYear()+'-'+(d.getUTCMonth()+1)+'-'+d.getUTCDate();
			rdReadble = ''+dReadable.getUTCFullYear()+'-'+(dReadable.getUTCMonth()+1)+'-'+dReadable.getUTCDate();
			fnAddDate(rd, rdReadble);

			d = incrementDate(d, recurType, weekdayOfMonth);
			dReadable = incrementDate(dReadable, recurType, weekdayOfMonth);
		}
	}

	function updateRecurringTime(startDate, startTime) {
		var weekday= FriendlyDates.weekday;
		var months = FriendlyDates.months;
		var dateEnding = FriendlyDates.dateEnding;

		var p = startDate.split('-');
		var date = new Date(p[0], p[1]-1, p[2], (-(new Date().getTimezoneOffset())/60)+1, 0, 0, 0);
		var dow = weekday[date.getUTCDay()];

		var weekdayOfMonth = parseInt( (date.getUTCDate()-1) /7)+1;
		
		$('#recur-weekly').text('Every '+dow);
		$('#recur-biweekly').text('Every other '+dow);
		$('#recur-triweekly').text('Every third '+dow);
		$('#recur-quadweekly').text('Every fourth '+dow);
		$('#recur-monthly').text('The '+date.getUTCDate()+dateEnding[date.getUTCDate()]+' of every month');
		$('#recur-monthly-day').text('The '+weekdayOfMonth+dateEnding[weekdayOfMonth]+' '+dow+' of every month');

		$('.recur-time').text(startTime.toLowerCase());
		$('.recur-start').text(formatDateForHuman(date));
	}

	function initRecurring($container)
	{
		updateRecurringTime(currentReadableDate, currentReadableTime);

		$container.find('.btn-additional').click(function (ev) {
			Acuity.PickAppointment.addSelectedTime(currentDate, currentTime, currentReadableTime, false/*dontShowRemove*/, currentReadableDate);
			Popup.hide();
		});

		$('#add-recur-times').click(function (ev){
			addCustomRecurringTime(function (date, readableDate){
				// okie dokie, add it to the list!
				Acuity.PickAppointment.addSelectedTime(date, currentTime, currentReadableTime, false/*dontShowRemove*/, readableDate);
			});

			Popup.hide();

			// now scroll to make sure the "Continue >>" button is in view
			var $el = $('#selected-times-container');
			$('body, html').animate({ scrollTop: $el.offset().top+'px' }, 150);
		});

		// Focus on an input so that wierd nested scrolling works ok
		$('#recur-type').focus();
	}


	function showPopup()
	{
		// First part of the system time is the system date
		currentDate = Acuity.PickAppointment.getBusinessDate();
		currentReadableDate = Acuity.PickAppointment.getReadableDate();
		currentTime = Acuity.PickAppointment.getTime();
		currentReadableTime = Acuity.PickAppointment.getReadableTime();

		Popup.showHtml($('#recurring-template').html(), initRecurring);
	}

	return {
		showPopup: showPopup
	}
})();

(function ($) {
	if (!window.hasAttachedCalendarScroll) {
		window.hasAttachedCalendarScroll = true;

		function destroyStickyHeadings()
		{
			$('.date-heading.sticky-cloned').remove();
			$('.sticky-more-times').removeClass('sticky-more-times');
		}

		$(window).on('acuity:stepChanged', function () {
			// Destroy scrolled sticky
			destroyStickyHeadings();
		});

		$(window).on('scroll', function (ev) {
			// watch date heading
			if ($('.date-heading').length == 0) return;

			var scrollTop = $(window).scrollTop();

			// Make days of week sticky at the top of the list of times
			if ($('.date-heading').not('.sticky-cloned').offset().top <= scrollTop) {
				if ($('.date-heading.sticky-cloned').length == 0) {
					$('.date-heading').each(function () {
						var $this = $(this);
						var $sticky = $this.clone().addClass('sticky-cloned').css({
							width: $this.outerWidth()+1 // Fix rounding errors of 1px with 33.33-% width
						});
						$sticky.insertAfter($this);
					});
				}
			} else {
				destroyStickyHeadings();
			}

			// Show if more times are available after we scroll past the last time
			$('.date').each(function () {
				var $this = $(this);
				var thisBottom = $this.offset().top+$this.height() - $('.date-heading').outerHeight() - 20/*a little early wiggle room for fixed header, etc.*/;
				var $moreTimes = $this.find('.more-times-available');

				if (thisBottom <= scrollTop) {
					$moreTimes.addClass('sticky-more-times');

					// Set an opacity to fade it in over 50px...
					$moreTimes.css({
						opacity: Math.min(50, scrollTop-thisBottom)/50
					});

				} else if ($moreTimes.hasClass('sticky-more-times')) {
					$moreTimes.removeClass('sticky-more-times');
				}
			});
		});
	}
})(jQuery);
